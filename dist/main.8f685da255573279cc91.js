/*! For license information please see main.8f685da255573279cc91.js.LICENSE.txt */
(()=>{"use strict";var t,e,i,n={529:(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function o(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}i.d(e,{A:()=>a});const a=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events={}},(e=[{key:"on",value:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}},{key:"off",value:function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(function(t){return t!==e}))}},{key:"emit",value:function(t,e){this.events[t]&&this.events[t].forEach(function(t){return t(e)})}}])&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}())},612:(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function o(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var a=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.originalText=e.innerText,this.chars="!<>-_\\/[]{}—=+*^?#",this.animationFrameId=null,this.isGlitching=!1},e=[{key:"startGlitch",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.3;if(!this.isGlitching){this.isGlitching=!0;var i=function(){if(t.isGlitching){for(var n="",r=0;r<t.originalText.length;r++){var o=t.originalText[r];Math.random()<e&&" "!==o?n+=t.chars[Math.floor(Math.random()*t.chars.length)]:n+=o}t.el.innerHTML=n,t.animationFrameId=requestAnimationFrame(i)}};this.animationFrameId=requestAnimationFrame(i)}}},{key:"stopGlitch",value:function(){this.isGlitching&&(this.isGlitching=!1,cancelAnimationFrame(this.animationFrameId),this.el.innerText=this.originalText)}},{key:"setText",value:function(t){var e=this;return new Promise(function(i){e.stopGlitch();var n=e.el.innerText,r=Math.max(n.length,t.length),o=0,a=function(){for(var s="",c=0,l=0;l<r;l++){n[l];var u=t[l]||"";o/35>=l/r?(s+=u,c++):s+=e.chars[Math.floor(Math.random()*e.chars.length)]}e.el.innerHTML=s,c===r?(e.originalText=t,i()):(o++,e.animationFrameId=requestAnimationFrame(a))};e.animationFrameId=requestAnimationFrame(a)})}}],e&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var u=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.activeCursor=null,this.scrambleEffects=new Map,this.magneticTargets=new Set,this.glitchTargets=new Set,this.handleMagneticEnter=this.handleMagneticEnter.bind(this),this.handleMagneticLeave=this.handleMagneticLeave.bind(this),this.handleGlitchEnter=this.handleGlitchEnter.bind(this),this.handleGlitchLeave=this.handleGlitchLeave.bind(this)},(e=[{key:"setActiveCursor",value:function(t){this.activeCursor=t}},{key:"initGlobalInteractions",value:function(){this.initMagneticTargets(),this.initGlitchText()}},{key:"handleMagneticEnter",value:function(t){this.activeCursor&&"function"==typeof this.activeCursor.enterMagneticMode&&this.activeCursor.enterMagneticMode(t.currentTarget)}},{key:"handleMagneticLeave",value:function(){this.activeCursor&&"function"==typeof this.activeCursor.exitMagneticMode&&this.activeCursor.exitMagneticMode()}},{key:"handleGlitchEnter",value:function(t){var e=this.scrambleEffects.get(t.currentTarget);e&&e.startGlitch(.4)}},{key:"handleGlitchLeave",value:function(t){var e=this.scrambleEffects.get(t.currentTarget);e&&e.stopGlitch()}},{key:"initMagneticTargets",value:function(){var t=this;document.querySelectorAll(".magnetic-target").forEach(function(e){e.addEventListener("mouseenter",t.handleMagneticEnter),e.addEventListener("mouseleave",t.handleMagneticLeave),t.magneticTargets.add(e)})}},{key:"initGlitchText",value:function(){var t=this;document.querySelectorAll(".glitch-hover, .nav-link, .page-link").forEach(function(e){if(!e.closest("#chimera-navbar")&&!t.scrambleEffects.has(e)){var i=new a(e);t.scrambleEffects.set(e,i),e.addEventListener("mouseenter",t.handleGlitchEnter),e.addEventListener("mouseleave",t.handleGlitchLeave),t.glitchTargets.add(e)}})}},{key:"destroy",value:function(){var t=this;this.scrambleEffects.forEach(function(t){return t.stopGlitch()}),this.scrambleEffects.clear(),this.magneticTargets.forEach(function(e){e.removeEventListener("mouseenter",t.handleMagneticEnter),e.removeEventListener("mouseleave",t.handleMagneticLeave)}),this.magneticTargets.clear(),this.glitchTargets.forEach(function(e){e.removeEventListener("mouseenter",t.handleGlitchEnter),e.removeEventListener("mouseleave",t.handleGlitchLeave)}),this.glitchTargets.clear()}}])&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function h(t){document.querySelectorAll(".page-view.active").forEach(function(t){t.classList.remove("active"),t.classList.add("is-leaving")});var e=document.getElementById(t);e?(e.classList.remove("is-leaving"),e.classList.add("active"),window.scrollTo(0,0)):console.error("Vista non trovata: ".concat(t))}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function y(t){var e=t.target.closest(".hotspot"),i=document.getElementById("case-history-view");if((i?i.querySelectorAll(".hotspot-content.visible"):[]).forEach(function(t){return t.classList.remove("visible")}),e){var n=e.dataset.hotspot,r=document.getElementById("hotspot-content-".concat(n));r&&(r.style.left="".concat(e.offsetLeft+30,"px"),r.style.top="".concat(e.offsetTop,"px"),r.classList.add("visible"))}}function d(t,e){var i=e.find(function(e){return String(e.id)===String(t)});if(i){var n,r,o=document.getElementById("case-history-title"),a=document.getElementById("case-history-subtitle"),s=document.getElementById("case-history-content"),c=document.getElementById("case-history-view");o&&(o.textContent=i.title),a&&i.case_history&&(a.textContent=i.case_history.subtitle),s&&i.case_history&&(s.innerHTML=window.HTMLSanitizer.sanitize(i.case_history.content_html),n=s,r=i.case_history.hotspots,n&&(n.querySelectorAll(".hotspot-content").forEach(function(t){return t.remove()}),r&&(Object.entries(r).forEach(function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),i=e[0],r=e[1],o=document.createElement("div");o.className="hotspot-content",o.id="hotspot-content-".concat(i),o.innerHTML="<h4>".concat(r.title,"</h4><p>").concat(r.text,"</p>"),n.appendChild(o)}),n.removeEventListener("click",y),n.addEventListener("click",y)))),document.body.classList.add("case-history-active"),c&&c.scrollTo(0,0)}else console.error("Progetto non trovato:",t)}function p(){document.body.classList.remove("case-history-active")}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return b(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(b(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,b(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,b(h,"constructor",l),b(l,"constructor",c),c.displayName="GeneratorFunction",b(l,r,"GeneratorFunction"),b(h),b(h,r,"Generator"),b(h,n,function(){return this}),b(h,"toString",function(){return"[object Generator]"}),(m=function(){return{w:o,m:f}})()}function b(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}b=function(t,e,i,n){function o(e,i){b(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},b(t,e,i,n)}function g(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function w(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){g(o,n,r,a,s,"next",t)}function s(t){g(o,n,r,a,s,"throw",t)}a(void 0)})}}function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,M(n.key),n)}}function M(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=v(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}var T=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webglManager=e,this.projectData=[],this.isNavigating=!1},e=[{key:"setProjectData",value:function(t){this.projectData=t}},{key:"navigateToCaseHistory",value:(n=w(m().m(function t(e){var i,n,r;return m().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isNavigating){t.n=1;break}return t.a(2);case 1:return this.isNavigating=!0,t.p=2,i=this.webglManager.createTransition(),n=i.play(),t.n=3,i.halfway;case 3:return d(e,this.projectData),h("case-history-view"),t.n=4,n;case 4:t.n=6;break;case 5:t.p=5,r=t.v,console.error("Navigation to case history failed:",r),h("case-history-view");case 6:return t.p=6,this.isNavigating=!1,t.f(6);case 7:return t.a(2)}},t,this,[[2,5,6,7]])})),function(t){return n.apply(this,arguments)})},{key:"navigateHome",value:(i=w(m().m(function t(){var e,i,n;return m().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isNavigating){t.n=1;break}return t.a(2);case 1:return this.isNavigating=!0,t.p=2,e=this.webglManager.createTransition(),i=e.play(),t.n=3,e.halfway;case 3:return p(),h("main-content"),t.n=4,i;case 4:t.n=6;break;case 5:t.p=5,n=t.v,console.error("Navigation to home failed:",n),h("main-content");case 6:return t.p=6,this.isNavigating=!1,t.f(6);case 7:return t.a(2)}},t,this,[[2,5,6,7]])})),function(){return i.apply(this,arguments)})}],e&&S(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i,n}(),E=i(922),x=i(437),A=i(264),k=i(385),O=i(439),P=i(804),C=i(383),I=i(185),_=i(529);function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function R(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function L(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?R(Object(i),!0).forEach(function(e){D(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function D(t,e,i){return(e=W(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function G(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return B(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?B(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function N(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return H(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(H(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,H(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,H(h,"constructor",l),H(l,"constructor",c),c.displayName="GeneratorFunction",H(l,r,"GeneratorFunction"),H(h),H(h,r,"Generator"),H(h,n,function(){return this}),H(h,"toString",function(){return"[object Generator]"}),(N=function(){return{w:o,m:f}})()}function H(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}H=function(t,e,i,n){function o(e,i){H(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},H(t,e,i,n)}function F(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function z(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){F(o,n,r,a,s,"next",t)}function s(t){F(o,n,r,a,s,"throw",t)}a(void 0)})}}function U(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,W(n.key),n)}}function W(t){var e=function(t){if("object"!=j(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=j(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}var V=function(){return t=function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.loadingManager=e,this.terminalCursor=i,this.resolvePromise=n,this.cursorName=r,this.preloaderElement=document.getElementById("preloader"),this.sceneContainer=document.getElementById("preloader-3d-scene"),this.hoverSound=document.getElementById("preloader-hover-sound"),this.clickSound=document.getElementById("preloader-click-sound"),this.shutdownSound=document.getElementById("preloader-shutdown-sound"),this.isTutorialVisible=!1,this.isHoveringInteractiveMesh=!1,this.currentHoverTarget=null,this.isInteractionAllowed=!1,this.isBootAnimationStarted=!1,this.easterEggActive=!1,this.glitchesActive=!0,this.raveMode=!1,this.raveTween=null,this.userInput="",this.isTyping=!1,this.activeColor=new E.Q1f(3800852),this.scene=new E.Z58,this.camera=new E.ubm(75,1,.1,1e3),this.renderer=new x.WebGLRenderer({antialias:!0,alpha:!0}),this.composer=new O.s(this.renderer),this.clock=new E.zD7,this.raycaster=new E.tBo,this.mouseVec=new E.I9Y,this.contextLost=!1,this.boundOnContextLost=this.onContextLost.bind(this),this.boundOnContextRestored=this.onContextRestored.bind(this),this.sceneGroup=new E.YJl,this.tutorialGroup=new E.YJl,this.allMeshes=[],this.bootLineMeshes=[],this.tutorialLineMeshes=[],this.matrixGroup=new E.YJl,this.matrixParticles=[],this.matrixActive=!1,this.parallaxFactor=.02,this.fontAlien=null,this.fontVT323=null,this.fontShareTech=null,this.boundOnMouseMove=this.onMouseMove.bind(this),this.boundOnWindowResize=this.onWindowResize.bind(this),this.boundOnPreloaderClick=this.onPreloaderClick.bind(this),this.boundHandleSystemCommands=this.handleSystemCommands.bind(this),this.boundOnDeviceOrientation=this.onDeviceOrientation.bind(this),this.bootTimeout=null,this.animationFrameId=null,this.currentHoverGlitchTarget=null},e=[{key:"init",value:(r=z(N().m(function t(){var e,n,r;return N().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.sceneContainer){t.n=1;break}return console.error("Elemento '#preloader-3d-scene' non trovato."),this.resolvePromise(),t.a(2);case 1:return this.camera.position.z=window.innerWidth<768?8:15,this.camera.fov=window.innerWidth<768?85:75,this.camera.updateProjectionMatrix(),e=window.innerWidth<768?2:window.devicePixelRatio,this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,e)),this.sceneContainer.appendChild(this.renderer.domElement),t.p=2,t.n=3,i.e(254).then(i.bind(i,712));case 3:n=t.v,this._removeContextGuards=n.attachContextGuards(this.renderer,{onLost:this.boundOnContextLost,onRestored:this.boundOnContextRestored}),t.n=5;break;case 4:t.p=4,t.v;case 5:return this.scene.add(this.sceneGroup),this.scene.add(this.matrixGroup),this.tutorialGroup.visible=!1,this.scene.add(this.tutorialGroup),t.p=6,this.startBootProcess(),t.n=7,this.loadFonts();case 7:this.createMeshes(),this.setupPostProcessing(),this.addEventListeners(),this.onWindowResize(),this.animate(),t.n=9;break;case 8:t.p=8,r=t.v,console.error("Errore critico durante l'inizializzazione del preloader:",r),this.resolvePromise();case 9:return t.a(2)}},t,this,[[6,8],[2,4]])})),function(){return r.apply(this,arguments)})},{key:"loadFonts",value:(n=z(N().m(function t(){var e,i,n;return N().w(function(t){for(;;)switch(t.n){case 0:return e=new A.J(this.loadingManager),t.n=1,Promise.all([e.loadAsync("assets/fonts/Orbitron.json"),e.loadAsync("assets/fonts/VT323_Regular.json"),e.loadAsync("assets/fonts/Share_Tech_Mono_Regular.json")]);case 1:i=t.v,n=G(i,3),this.fontAlien=n[0],this.fontVT323=n[1],this.fontShareTech=n[2];case 2:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"createMeshes",value:function(){var t=this,e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new E._4j({color:3800852,emissive:3800852,emissiveIntensity:1.5,transparent:!0,opacity:t})},i=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4;e.geometry.computeBoundingBox();var n=e.geometry.boundingBox,r=new E.Pq0;n.getSize(r);var o=new E.iNn(r.x+2*i,r.y+2*i,r.z+.2),a=new E.V9B({visible:!1}),s=new E.eaF(o,a);return s.position.copy(e.position),t.allMeshes.push(s),s},n=0,r=new k._("A.P.I.S. TERMINAL",{font:this.fontAlien,size:1.5,height:.05});r.center(),this.titleMesh=new E.eaF(r,e()),this.sceneGroup.add(this.titleMesh),this.allMeshes.push(this.titleMesh),n-=1.5;var o=new k._("Alessandro Portfolio Interactive System",{font:this.fontShareTech,size:.5,height:.02});o.center(),this.subtitleMesh=new E.eaF(o,e()),this.subtitleMesh.position.y=n,this.sceneGroup.add(this.subtitleMesh),this.allMeshes.push(this.subtitleMesh),n-=1.5,["Ottimizzando il caffè","Esportazione pazienza in .fbx","Rendering dello stress","Compilando shader emotivi"].sort(function(){return.5-Math.random()}).slice(0,3).forEach(function(i){n-=.8;var r=Math.random()<.3,o="> ".concat(i,"..."),a=new k._(o,{font:t.fontShareTech,size:.4,height:.02});a.computeBoundingBox();var s=a.boundingBox.max.x-a.boundingBox.min.x,c=new E.eaF(a,e()),l=new E.eaF(new E.LoY,e()),u=new E.YJl;u.add(c),u.add(l),l.position.x=s+.3,u.position.x=-8,u.position.y=n,t.bootLineMeshes.push({phrase:c,status:l,lineGroup:u,text:o,isError:r}),t.sceneGroup.add(u),t.allMeshes.push(c,l)}),n-=.8;var a="> SYSTEM CHECK COMPLETE. AWAITING INPUT ",s=new k._(a,{font:this.fontShareTech,size:.4,height:.02});this.finalLineMesh=new E.eaF(s,e()),this.finalLineMesh.position.x=-8,this.finalLineMesh.position.y=n,this.finalLineMesh.userData.baseText=a,this.sceneGroup.add(this.finalLineMesh),this.allMeshes.push(this.finalLineMesh),s.computeBoundingBox();var c=s.boundingBox.max.x-s.boundingBox.min.x,l=new k._("_",{font:this.fontShareTech,size:.4,height:.02});this.blinkingCursorMesh=new E.eaF(l,e()),this.blinkingCursorMesh.position.copy(this.finalLineMesh.position),this.blinkingCursorMesh.position.x+=c+.1,this.sceneGroup.add(this.blinkingCursorMesh),this.allMeshes.push(this.blinkingCursorMesh),n-=1.5;var u=new k._("CLICK TO PROCEED _",{font:this.fontVT323,size:1,height:.05});u.center(),this.pressStartMesh=new E.eaF(u,e()),this.pressStartMesh.position.y=n,this.sceneGroup.add(this.pressStartMesh),this.pressStartHitbox=i(this.pressStartMesh,1),this.sceneGroup.add(this.pressStartHitbox),this.allMeshes.push(this.pressStartMesh),n-=1.5;var h=new k._("[ ISTRUZIONI ]",{font:this.fontShareTech,size:.5,height:.02});h.center(),this.instructionsMesh=new E.eaF(h,e()),this.instructionsMesh.position.y=n,this.sceneGroup.add(this.instructionsMesh),this.instructionsHitbox=i(this.instructionsMesh,.8),this.sceneGroup.add(this.instructionsHitbox),this.allMeshes.push(this.instructionsMesh);var f=Math.abs(n);this.sceneGroup.position.y=f/2;var y=new k._(">",{font:this.fontShareTech,size:.5,height:.02});y.center(),this.arrowMesh=new E.eaF(y,e()),this.arrowMesh.material.opacity=0,this.sceneGroup.add(this.arrowMesh),this.allMeshes.push(this.arrowMesh);var d,p,v=new k._("A.P.I.S. TERMINAL",{font:this.fontAlien,size:1.5,height:.05});v.center(),this.tutorialTitleMesh=new E.eaF(v,e()),this.tutorialTitleMesh.position.y=4,this.tutorialGroup.add(this.tutorialTitleMesh),this.allMeshes.push(this.tutorialTitleMesh),"Pacman"===this.cursorName?(d="SYSTEM STATUS: [HUNTER/HUNTED PARADIGM]",p=["> ABILITÀ: ONLINE",">   MUOVI MOUSE -> GUIDA L'ENTITÀ",">   CLICK SX -> SCATTO D'ATTACCO (DISTRUGGE I CACCIATORI)","> ","> ANALISI BERSAGLI:",">   ECHI (BLU) -> CONSUMALI PER PUNTEGGIO. SI AUTODISTRUGGONO.",">   CACCIATORI (COLORATI) -> EVITALI O DISTRUGGILI CON LO SCATTO.","> ","> ... LA SOPRAVVIVENZA È LA PRIORITÀ."]):"Glitch"===this.cursorName?(d="SYSTEM STATUS: [MATRIX RAIN PROTOCOL]",p=["> EFFETTO: ATTIVO",">   MUOVI MOUSE -> NAVIGA NELLA MATRICE",">   TRASCINAMENTO -> TRACCIA DIGITALE","> ","> PROTOCOLLO:",">   OSSERVA LA PIOGGIA DI CODICE.",">   IL CURSORE È LA TUA GUIDA NEL SISTEMA.","> ","> ... BENVENUTO NELLA MATRICE."]):(d="SYSTEM STATUS: [VOIDBREAKER PROTOCOL]",p=["> ARMAMENTI: ONLINE",">   MUOVI MOUSE -> PILOTA NAVICELLA",">   CLICK SX -> SPARA PROIETTILI","> ","> DIRETTIVA:",">   SOPRAVVIVI A TUTTE LE ONDATE.",">   RACCOGLI I MODULI DI POTENZIAMENTO RILASCIATI DAI NEMICI.","> ","> ... BUONA CACCIA, PILOTA."]);var m=new k._(d,{font:this.fontShareTech,size:.5,height:.02});m.center(),this.tutorialSubtitleMesh=new E.eaF(m,e()),this.tutorialSubtitleMesh.position.y=2.5,this.tutorialGroup.add(this.tutorialSubtitleMesh),this.allMeshes.push(this.tutorialSubtitleMesh),p.forEach(function(i,n){var r=new k._(i,{font:t.fontShareTech,size:.4,height:.02}),o=new E.eaF(r,e());o.position.x=-10,o.position.y=1-.8*n,t.tutorialLineMeshes.push({mesh:o,text:i}),t.tutorialGroup.add(o),t.allMeshes.push(o)});var b=new k._("[ HO CAPITO ]",{font:this.fontVT323,size:1,height:.05});b.center(),this.closeTutorialMesh=new E.eaF(b,e()),this.closeTutorialMesh.position.y=-7,this.tutorialGroup.add(this.closeTutorialMesh),this.closeTutorialHitbox=i(this.closeTutorialMesh,1),this.tutorialGroup.add(this.closeTutorialHitbox),this.allMeshes.push(this.closeTutorialMesh),this.tutorialGroup.children.forEach(function(t){t.material&&(t.material.opacity=0)})}},{key:"startMatrixEffect",value:function(){this.createMatrixParticles(),this.matrixActive=!0}},{key:"createMatrixParticles",value:function(){for(var t=0;t<60;t++)for(var e=0;e<30;e++){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(36*Math.random())],n=new k._(i,{font:this.fontAlien,size:.6,height:.02}),r=new E._4j({color:65280,emissive:17408,emissiveIntensity:.5,transparent:!0,opacity:1}),o=new E.eaF(n,r),a=2*t-59+.3*(Math.random()-.5),s=80*(e/29-.5)+1*(Math.random()-.5),c=3*Math.random()-15;o.position.set(a,s,c),o.userData.speed=.07,o.userData.glitchTimer=1e3*Math.random(),o.userData.originalChar=i,o.userData.opacity=.6,o.userData.column=t,this.matrixGroup.add(o),this.matrixParticles.push(o)}}},{key:"setupPostProcessing",value:function(){this.composer.addPass(new P.A(this.scene,this.camera)),this.bloomPass=new C.C(new E.I9Y(this.sceneContainer.clientWidth,this.sceneContainer.clientHeight),1.2,.2,.1),this.composer.addPass(this.bloomPass),this.crtPass=new I.p({uniforms:{tDiffuse:{value:null},u_time:{value:0}},vertexShader:"varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",fragmentShader:"\n                uniform sampler2D tDiffuse; uniform float u_time; varying vec2 vUv;\n                float random(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453); }\n                void main() {\n                    vec2 barrel_uv = vUv - 0.5; float r = dot(barrel_uv, barrel_uv); vec2 uv = 0.5 + barrel_uv * (1.0 - 0.1 * r);\n                    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) { discard; }\n                    vec2 offset_r = vec2(0.001, 0.0); vec2 offset_b = vec2(-0.001, 0.0);\n                    float red = texture2D(tDiffuse, uv + offset_r).r; float green = texture2D(tDiffuse, uv).g; float blue = texture2D(tDiffuse, uv + offset_b).b;\n                    vec4 color = vec4(red, green, blue, 1.0);\n                    float scanline = sin(vUv.y * 800.0) * 0.1 + 0.9; float noise = (random(vUv + u_time * 0.2) - 0.5) * 0.15;\n                    color.rgb *= scanline; color.rgb += noise; float vignette = 1.0 - length(vUv - 0.5) * 0.8; color.rgb *= vignette;\n                    gl_FragColor = color;\n                }"}),this.composer.addPass(this.crtPass)}},{key:"addEventListeners",value:function(){_.A.on("global:mousemove",this.boundOnMouseMove),_.A.on("global:resize",this.boundOnWindowResize),this.preloaderElement.addEventListener("click",this.boundOnPreloaderClick),_.A.on("global:keydown",this.boundHandleSystemCommands),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",this.boundOnDeviceOrientation)}},{key:"startBootProcess",value:function(){var t=this;this.loadingManager.onLoad=function(){t.bootTimeout&&clearTimeout(t.bootTimeout),t.runPowerUpSequence()},this.bootTimeout=setTimeout(function(){t.isBootAnimationStarted||(console.warn("Preloader: Avvio forzato causa timeout del LoadingManager."),t.runPowerUpSequence())},3e3)}},{key:"playSound",value:function(t){t&&(t.currentTime=0,t.play().catch(function(t){}))}},{key:"runPowerUpSequence",value:function(){var t=this;if(!this.isBootAnimationStarted){this.isBootAnimationStarted=!0;var e=new E.bdM(50,.1),i=new E.V9B({color:3800852,transparent:!0,opacity:.8}),n=new E.eaF(e,i);n.position.z=1,n.position.y=15,this.scene.add(n),gsap.to(n.position,{y:-15,duration:1,ease:"power2.inOut"}),gsap.to(n.material,{opacity:0,duration:.5,delay:.5,onComplete:function(){t.scene.remove(n),e.dispose(),i.dispose()}}),gsap.delayedCall(.7,function(){t.startMatrixEffect(),t.runBootAnimation()})}}},{key:"runBootAnimation",value:function(){var t=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.isInteractionAllowed=!1,gsap.killTweensOf(this.allMeshes.map(function(t){return t.material}).filter(Boolean)),this.bootLineMeshes.forEach(function(t){t.phrase.geometry.setDrawRange(0,0),t.status.geometry&&t.status.geometry.dispose(),t.status.geometry=new E.LoY,gsap.set([t.phrase.material,t.status.material],{opacity:0})}),gsap.set([this.finalLineMesh.material,this.blinkingCursorMesh.material,this.pressStartMesh.material,this.instructionsMesh.material],{opacity:0}));var e=new E._4j({color:this.activeColor,emissive:this.activeColor,emissiveIntensity:1.5,transparent:!0,opacity:1}),i=new E._4j({color:16728374,emissive:16728374,emissiveIntensity:1.8,transparent:!0,opacity:1}),n=gsap.timeline(),r=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.geometry&&n.geometry.dispose(),n.geometry=new k._(r,{font:t.fontShareTech,size:.4,height:.02}),n.material=o?i:e,n.material.color.set(t.activeColor),n.material.emissive.set(t.activeColor)};n.to([this.titleMesh.material,this.subtitleMesh.material],{opacity:1,duration:1,stagger:.2}),this.bootLineMeshes.forEach(function(t){var e=t.phrase,i=t.status,o=t.lineGroup,a=t.text,s=t.isError;e.geometry.setDrawRange(0,0);var c={count:0},l=e.geometry.attributes.position.count;n.to([e.material,i.material],{opacity:1,duration:.01},"+=0.2"),n.to(c,{count:l,duration:.03*a.length,ease:"none",onUpdate:function(){e.geometry.setDrawRange(0,Math.ceil(c.count))}});var u={val:0};n.to(u,{val:100,duration:.5,ease:"none",onUpdate:function(){r(i,"[ ".concat(Math.floor(u.val),"% ]"))},onComplete:function(){r(i,s?"[ ERR ]":"[ OK ]",s),s&&gsap.fromTo(o.position,{x:o.position.x-.1},{x:o.position.x,duration:.2,ease:"elastic.out(1, 0.3)"})}})}),n.to([this.finalLineMesh.material,this.blinkingCursorMesh.material],{opacity:1,duration:1}),n.to([this.pressStartMesh.material,this.instructionsMesh.material],{opacity:1,duration:1},"-=1.0"),gsap.to(this.pressStartMesh.material,{emissiveIntensity:.2,duration:1,repeat:-1,yoyo:!0,ease:"none"}),n.call(function(){t.glitchEffect3D(t.titleMesh,"A.P.I.S. TERMINAL",{font:t.fontAlien,size:1.5,height:.05},!0),t.glitchEffect3D(t.subtitleMesh,"Alessandro Portfolio Interactive System",{font:t.fontShareTech,size:.5,height:.02},!0),t.bootLineMeshes.forEach(function(e){return t.glitchEffect3D(e.phrase,e.text,{font:t.fontShareTech,size:.4,height:.02},!1)}),t.glitchEffect3D(t.finalLineMesh,t.finalLineMesh.userData.baseText,{font:t.fontShareTech,size:.4,height:.02},!1,"input_line_glitch"),t.glitchEffect3D(t.pressStartMesh,"CLICK TO PROCEED _",{font:t.fontVT323,size:1,height:.05},!0),t.glitchEffect3D(t.instructionsMesh,"[ ISTRUZIONI ]",{font:t.fontShareTech,size:.5,height:.02},!0),t.isInteractionAllowed=!0})}},{key:"showTutorial",value:function(){var t=this;this.isTutorialVisible=!0,this.isInteractionAllowed=!1;var e=gsap.timeline(),i=this.sceneGroup.children.map(function(t){return t.material||(t.children?t.children.map(function(t){return t.material}):[])}).flat().filter(Boolean);e.to(i,{opacity:0,duration:.5,stagger:.05,onComplete:function(){t.sceneGroup.visible=!1,t.tutorialGroup.visible=!0}}),e.to([this.tutorialTitleMesh.material,this.tutorialSubtitleMesh.material],{opacity:1,duration:.5,stagger:.2}),this.tutorialLineMeshes.forEach(function(t){var i=t.mesh,n=t.text;i.geometry.setDrawRange(0,0);var r={count:0},o=i.geometry.attributes.position.count;e.to(i.material,{opacity:1,duration:.01},"-=0.2"),e.to(r,{count:o,duration:.03*n.length,ease:"none",onUpdate:function(){return i.geometry.setDrawRange(0,Math.ceil(r.count))}})}),e.to(this.closeTutorialMesh.material,{opacity:1,duration:.5},"+=0.5").call(function(){gsap.to(t.closeTutorialMesh.material,{emissiveIntensity:.2,duration:1,repeat:-1,yoyo:!0,ease:"none"}),t.glitchEffect3D(t.tutorialTitleMesh,"A.P.I.S. TERMINAL",{font:t.fontAlien,size:1.5,height:.05},!0),t.glitchEffect3D(t.tutorialSubtitleMesh,t.tutorialSubtitleMesh.geometry.parameters.options.text,{font:t.fontShareTech,size:.5,height:.02},!0),t.tutorialLineMeshes.forEach(function(e){t.glitchEffect3D(e.mesh,e.text,{font:t.fontShareTech,size:.4,height:.02},!1)}),t.glitchEffect3D(t.closeTutorialMesh,"[ HO CAPITO ]",{font:t.fontVT323,size:1,height:.05},!0),t.isInteractionAllowed=!0})}},{key:"hideTutorial",value:function(){var t=this;this.isTutorialVisible=!1,this.isInteractionAllowed=!1,gsap.killTweensOf(this.closeTutorialMesh.material);var e=gsap.timeline(),i=this.tutorialGroup.children.map(function(t){return t.material}).filter(Boolean);e.to(i,{opacity:0,duration:.5,stagger:.05,onComplete:function(){t.sceneGroup.visible=!0,t.tutorialGroup.visible=!1}});var n=this.sceneGroup.children.map(function(t){return t.material||(t.children?t.children.map(function(t){return t.material}):[])}).flat().filter(Boolean);e.to(n,{opacity:1,duration:.5,stagger:.1,onComplete:function(){t.isInteractionAllowed=!0}})}},{key:"handleSystemCommands",value:function(t){if(!this.isTutorialVisible&&this.isInteractionAllowed){var e=t.key;if("Enter"===e){t.preventDefault(),this.isTyping=!1;var i=this.userInput.trim().toLowerCase();this.stopAllAnimations();var n={green:"#39ff14",blue:"#00ffff",amber:"#ffb000"};if(n[i]){var r=new E.Q1f(n[i]);this.activeColor.set(r),this.changeTextColor(this.activeColor)}else{if("reboot"===i)return void location.reload();"rave"===i?(this.raveMode=!0,this.toggleRaveMode(!0)):"help"===i?this.displayTemporaryText(["> COMANDI DISPONIBILI:","  green / blue / amber","  reboot","  rave"]):this.displayTemporaryText(["> COMANDO NON RICONOSCIUTO.",'> Digitare "help" per la lista.'])}this.userInput="",this.updateInputMesh(),this.glitchEffect3D(this.finalLineMesh,this.finalLineMesh.userData.baseText,{font:this.fontShareTech,size:.4,height:.02},!1,"input_line_glitch")}else"Backspace"!==e&&1!==e.length||(this.isTyping=!0,this.finalLineMesh.glitchInterval&&(clearInterval(this.finalLineMesh.glitchInterval),this.finalLineMesh.glitchInterval=null),"Backspace"===e?(t.preventDefault(),this.userInput=this.userInput.slice(0,-1)):1===e.length&&this.userInput.length<40&&(t.preventDefault(),this.userInput+=e),this.updateInputMesh())}}},{key:"stopAllAnimations",value:function(){this.raveMode&&(this.raveMode=!1,this.toggleRaveMode(!1)),this.allMeshes.forEach(function(t){t.material&&t.material.color&&gsap.killTweensOf([t.material.color,t.material.emissive])})}},{key:"changeTextColor",value:function(t){this.allMeshes.forEach(function(e){e.material&&e.material.color&&gsap.to([e.material.color,e.material.emissive],{r:t.r,g:t.g,b:t.b,duration:.5})})}},{key:"displayTemporaryText",value:function(t){var e=this;this.isInteractionAllowed=!1;var i=[],n=this.sceneGroup.children.filter(function(t){return t!==e.titleMesh&&t!==e.subtitleMesh}),r=gsap.timeline({onComplete:function(){i.forEach(function(t){e.sceneGroup.remove(t),t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}),e.isInteractionAllowed=!0}});r.to(n,{duration:.3,onStart:function(){n.forEach(function(t){var e=t.material?[t.material]:t.children.map(function(t){return t.material}).flat();gsap.to(e,{opacity:0,duration:.3})})},onComplete:function(){return n.forEach(function(t){return t.visible=!1})}},"start"),t.forEach(function(t,n){var r=new k._(t,{font:e.fontShareTech,size:.4,height:.02}),o=new E._4j({color:e.activeColor,emissive:e.activeColor,emissiveIntensity:1.5,transparent:!0,opacity:0}),a=new E.eaF(r,o);a.position.set(-8,-6-.8*n,0),e.sceneGroup.add(a),i.push(a)}),r.to(i.map(function(t){return t.material}),{opacity:1,duration:.5,stagger:.1},"start+=0.3"),r.addLabel("hideTemp","+=2.0"),r.to(i.map(function(t){return t.material}),{opacity:0,duration:.5,stagger:.1},"hideTemp"),r.call(function(){return n.forEach(function(t){return t.visible=!0})},null,"hideTemp+=0.5"),r.to(n,{duration:.3,onStart:function(){n.forEach(function(t){var e=t.material?[t.material]:t.children.map(function(t){return t.material}).flat();gsap.to(e.filter(Boolean),{opacity:1,duration:.3})})}},"hideTemp+=0.5")}},{key:"updateInputMesh",value:function(){var t=this.finalLineMesh.userData.baseText+this.userInput;this.finalLineMesh.geometry&&this.finalLineMesh.geometry.dispose(),this.finalLineMesh.geometry=new k._(t,{font:this.fontShareTech,size:.4,height:.02}),this.finalLineMesh.userData.glitchData&&(this.finalLineMesh.userData.glitchData.originalText=t),this.finalLineMesh.geometry.computeBoundingBox();var e=this.finalLineMesh.geometry.boundingBox.max.x-this.finalLineMesh.geometry.boundingBox.min.x;this.blinkingCursorMesh.position.x=this.finalLineMesh.position.x+e+.1}},{key:"glitchEffect3D",value:function(t,e,i,n){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("string"==typeof e){t.userData.glitchData={originalText:e,params:i,centered:n,id:o},t.glitchInterval&&clearInterval(t.glitchInterval),t.glitchInterval=null;var a=function(){if(("input_line_glitch"!==t.userData.glitchData.id||!r.isTyping)&&!t.hoverGlitchInterval&&r.glitchesActive&&!t.glitchInterval){var o=0,s=Math.floor(4*Math.random())+2;t.glitchInterval=setInterval(function(){if(o<s){var r=e.split("").map(function(t){return" "!==t&&Math.random()>.7?"`¡™£¢∞§¶•ªº–≠åß∂ƒ©˙∆˚¬…æ«Ω≈ç√∫˜µ≤≥÷!?@#$%^&*()".charAt(Math.floor(46*Math.random())):t}).join("");t.geometry&&t.geometry.dispose(),t.geometry=new k._(r,L({},i)),n&&t.geometry.center(),o++}else clearInterval(t.glitchInterval),t.glitchInterval=null,t.geometry&&t.geometry.dispose(),t.geometry=new k._(e,L({},i)),n&&t.geometry.center(),setTimeout(a,5e3*Math.random()+3e3)},100)}};setTimeout(a,5e3*Math.random()+2e3)}else console.warn("glitchEffect3D ha ricevuto un testo non valido e verrà saltato.",t)}},{key:"startHoverGlitch",value:function(t){if(t.userData.glitchData&&this.glitchesActive){t.glitchInterval&&clearInterval(t.glitchInterval),t.hoverGlitchInterval&&clearInterval(t.hoverGlitchInterval);var e=t.userData.glitchData,i=e.originalText,n=e.params,r=e.centered;t.hoverGlitchInterval=setInterval(function(){var e=i.split("").map(function(t){return" "!==t?"`¡™£¢∞§¶•ªº–≠åß∂ƒ©˙∆˚¬…æ«Ω≈ç√∫˜µ≤≥÷!?@#$%^&*()".charAt(Math.floor(46*Math.random())):t}).join("");t.geometry&&t.geometry.dispose(),t.geometry=new k._(e,L({},n)),r&&t.geometry.center()},40)}}},{key:"stopHoverGlitch",value:function(t){if(t.userData.glitchData){t.hoverGlitchInterval&&clearInterval(t.hoverGlitchInterval),t.hoverGlitchInterval=null;var e=t.userData.glitchData,i=e.originalText,n=e.params,r=e.centered;t.geometry&&t.geometry.dispose(),t.geometry=new k._(i,L({},n)),r&&t.geometry.center(),this.glitchEffect3D(t,i,n,r,t.userData.glitchData.id)}}},{key:"toggleRaveMode",value:function(t){var e=this;t?(this.raveTween&&this.raveTween.kill(),this.raveTween=gsap.to({},{duration:.5,repeat:-1,onRepeat:function(){var t=new E.Q1f(16777215*Math.random());e.changeTextColor(t)}})):this.raveTween&&(this.raveTween.kill(),this.raveTween=null)}},{key:"onPreloaderClick",value:function(t){var e=this;if(this.mouseVec.x=t.clientX/this.sceneContainer.clientWidth*2-1,this.mouseVec.y=-t.clientY/this.sceneContainer.clientHeight*2+1,this.raycaster.setFromCamera(this.mouseVec,this.camera),this.isTutorialVisible)this.raycaster.intersectObject(this.closeTutorialHitbox).length>0&&(this.playSound(this.clickSound),this.hideTutorial());else{if(!this.isInteractionAllowed)return;var i=this.raycaster.intersectObjects([this.pressStartHitbox,this.instructionsHitbox]);if(i.length>0){this.playSound(this.clickSound);var n=i[0].object;if(n===this.instructionsHitbox)this.showTutorial();else if(n===this.pressStartHitbox){this.isInteractionAllowed=!1,this.terminalCursor&&this.terminalCursor.destroy(),this.playSound(this.shutdownSound);var r=gsap.timeline({onComplete:function(){e.preloaderElement.style.display="none",e.destroy(),e.resolvePromise()}});r.to(this.sceneGroup.scale,{duration:.3,y:.01,x:1.2,ease:"power2.in"}),r.to(this.sceneGroup.scale,{duration:.15,x:.01}),r.to(this.allMeshes.map(function(t){return t.material}).filter(function(t){return t&&void 0!==t.emissiveIntensity}),{emissiveIntensity:0,duration:.2},"-=0.1"),r.to(this.preloaderElement,{opacity:0,duration:.5},"+=0.2")}}}}},{key:"onMouseMove",value:function(t){this.mouseVec.x=t.clientX/this.sceneContainer.clientWidth*2-1,this.mouseVec.y=-t.clientY/this.sceneContainer.clientHeight*2+1}},{key:"onWindowResize",value:function(){this.camera.aspect=this.sceneContainer.clientWidth/this.sceneContainer.clientHeight,this.camera.fov=this.sceneContainer.clientWidth<768?85:75,this.camera.position.z=this.sceneContainer.clientWidth<768?8:15,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.sceneContainer.clientWidth,this.sceneContainer.clientHeight),this.composer.setSize(this.sceneContainer.clientWidth,this.sceneContainer.clientHeight);var t=Math.min(this.sceneContainer.clientWidth/1920,this.sceneContainer.clientHeight/1080,1);this.sceneGroup.scale.setScalar(t),this.tutorialGroup.scale.setScalar(t)}},{key:"onDeviceOrientation",value:function(t){if(t.beta&&t.gamma){var e=(t.beta-90)*Math.PI/180*.05,i=t.gamma*Math.PI/180*.05;this.sceneGroup.rotation.x=e,this.sceneGroup.rotation.y=i}}},{key:"animate",value:function(){var t=this;this.animationFrameId=requestAnimationFrame(this.animate.bind(this));var e=this.clock.getElapsedTime();if(this.raycaster.setFromCamera(this.mouseVec,this.camera),this.isInteractionAllowed){var i=this.isTutorialVisible?this.tutorialGroup:this.sceneGroup,n=this.raycaster.intersectObjects(i.children,!0).filter(function(t){return t.object.userData.glitchData}),r=n.length>0?n[0].object:null;r!==this.currentHoverGlitchTarget&&(this.currentHoverGlitchTarget&&this.stopHoverGlitch(this.currentHoverGlitchTarget),r&&this.startHoverGlitch(r),this.currentHoverGlitchTarget=r)}this.blinkingCursorMesh&&this.blinkingCursorMesh.material.opacity>0&&(this.blinkingCursorMesh.material.opacity=.5+.5*Math.sin(10*e)),this.bloomPass&&(this.bloomPass.strength=1.2+.1*Math.sin(.5*e));var o=this.isTutorialVisible?this.tutorialGroup:this.sceneGroup,a=.08*-this.mouseVec.y,s=.08*-this.mouseVec.x;if(o.rotation.x+=.05*(a-o.rotation.x),o.rotation.y+=.05*(s-o.rotation.y),this.terminalCursor&&this.isInteractionAllowed){var c,l=null;c=this.isTutorialVisible?[this.closeTutorialHitbox]:[this.pressStartHitbox,this.instructionsHitbox];var u=this.raycaster.intersectObjects(c);if(u.length>0?(l=u[0].object,this.isHoveringInteractiveMesh||(this.isHoveringInteractiveMesh=!0,this.terminalCursor.handleMouseEnter())):this.isHoveringInteractiveMesh&&(this.isHoveringInteractiveMesh=!1,this.terminalCursor.handleMouseLeave()),l!==this.currentHoverTarget)if(l&&this.playSound(this.hoverSound),this.currentHoverTarget=l,gsap.killTweensOf(this.arrowMesh.material),this.currentHoverTarget){var h=this.currentHoverTarget===this.instructionsHitbox?this.instructionsMesh:this.currentHoverTarget===this.closeTutorialHitbox?this.closeTutorialMesh:this.pressStartMesh;h.geometry.computeBoundingBox();var f=h.geometry.boundingBox.max.x-h.geometry.boundingBox.min.x,y=h.position.x-f/2-.7,d=h.position.y;this.arrowMesh.position.set(y,d,0),gsap.to(this.arrowMesh.material,{opacity:1,duration:.3,ease:"power2.out"})}else gsap.to(this.arrowMesh.material,{opacity:0,duration:.2})}if(this.titleMesh&&this.titleMesh.material&&(this.titleMesh.material.emissiveIntensity=1.5+.5*Math.sin(2*e)),this.crtPass&&this.crtPass.uniforms.u_time&&(this.crtPass.uniforms.u_time.value=e),this.matrixActive){this.matrixParticles.forEach(function(e){if(e.position.y-=e.userData.speed,e.rotation.set(0,0,0),e.userData.glitchTimer-=16,e.userData.glitchTimer<0){e.userData.glitchTimer=1e3+2e3*Math.random();var i=Math.random()>.7?"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(36*Math.random())]:e.userData.originalChar;e.geometry&&e.geometry.dispose(),e.geometry=new k._(i,{font:t.fontAlien,size:.6,height:.02}),e.geometry.center()}var n=1+.2*Math.sin(.005*Date.now()+e.position.x);e.scale.setScalar(n),Math.random()>.95?(e.material.color.setHex(16777215*Math.random()),e.material.emissive.setHex(4473924*Math.random())):(e.material.color.setHex(65280),e.material.emissive.setHex(17408)),e.position.y<-45&&(e.position.y+=90,e.rotation.z=Math.random()*Math.PI*2,e.scale.setScalar(1),e.geometry&&e.geometry.dispose(),e.geometry=new k._(e.userData.originalChar,{font:t.fontAlien,size:.6,height:.02}),e.geometry.center())});var p=.08*-this.mouseVec.y,v=.08*-this.mouseVec.x;this.matrixGroup.rotation.x+=.05*(p-this.matrixGroup.rotation.x),this.matrixGroup.rotation.y+=.05*(v-this.matrixGroup.rotation.y)}if(!this.contextLost)try{this.composer.render()}catch(t){console.warn("Preloader composer.render() failed:",t)}}},{key:"destroy",value:function(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),_.A.off("global:mousemove",this.boundOnMouseMove),_.A.off("global:resize",this.boundOnWindowResize),this.preloaderElement.removeEventListener("click",this.boundOnPreloaderClick),_.A.off("global:keydown",this.boundHandleSystemCommands),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.boundOnDeviceOrientation);try{this._removeContextGuards&&this._removeContextGuards()}catch(t){}this.allMeshes.forEach(function(t){t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(function(t){return t.dispose()}):t.material.dispose())});try{this.composer&&Array.isArray(this.composer.passes)&&this.composer.passes.forEach(function(t){try{t&&t.dispose&&t.dispose()}catch(t){}})}catch(t){}try{this.renderer&&this.renderer.dispose()}catch(t){}try{this.sceneContainer&&this.renderer&&this.renderer.domElement&&this.sceneContainer.removeChild(this.renderer.domElement)}catch(t){}clearTimeout(this.bootTimeout)}},{key:"onContextLost",value:function(t){try{t.preventDefault()}catch(t){}console.warn("Preloader WebGL context lost"),this.contextLost=!0}},{key:"onContextRestored",value:function(){console.info("Preloader WebGL context restored — recreating renderer/composer"),this.contextLost=!1;try{this.recreateRenderer()}catch(t){console.error("Failed to recreate Preloader renderer on context restore",t)}}},{key:"recreateRenderer",value:function(){try{this.composer&&Array.isArray(this.composer.passes)&&this.composer.passes.forEach(function(t){try{t&&t.dispose&&t.dispose()}catch(t){}})}catch(t){}try{this.renderer&&this.renderer.dispose()}catch(t){}try{this.sceneContainer&&this.renderer&&this.renderer.domElement&&this.sceneContainer.removeChild(this.renderer.domElement)}catch(t){}this.renderer=new x.WebGLRenderer({antialias:!0,alpha:!0});var t=window.innerWidth<768?2:window.devicePixelRatio;this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,t));var e=this.sceneContainer.getBoundingClientRect?this.sceneContainer.getBoundingClientRect():{width:window.innerWidth,height:window.innerHeight},i=Math.max(1,Math.round(e.width)||window.innerWidth),n=Math.max(1,Math.round(e.height)||window.innerHeight);this.renderer.setSize(i,n),this.sceneContainer.appendChild(this.renderer.domElement);try{this.renderer.domElement.addEventListener("webglcontextlost",this.boundOnContextLost,!1),this.renderer.domElement.addEventListener("webglcontextrestored",this.boundOnContextRestored,!1)}catch(t){}this.composer=new O.s(this.renderer);try{this.setupPostProcessing()}catch(t){console.warn("[Preloader] setupPostProcessing failed during recreateRenderer",t)}}}],e&&U(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function Y(t,e,i,n){var r=document.getElementById("preloader");return r&&e?(r.style.display="block",r.style.opacity="1",new Promise(function(){var e=z(N().m(function e(o){var a;return N().w(function(e){for(;;)switch(e.n){case 0:return a=new V(t,i,o,n),e.n=1,a.init();case 1:setTimeout(function(){"none"!==r.style.display&&(console.warn("Preloader safety timeout triggered - closing automatically"),r.style.display="none",a.destroy(),o())},3e4);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}())):(r&&(r.style.display="none"),Promise.resolve())}function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function K(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,X(n.key),n)}}function X(t){var e=function(t){if("object"!=q(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=q(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==q(e)?e:e+""}var $=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cursor=null,this.aura=null,this.scopeElement=null,this.interactiveElements=[],this.forceShowTimeout=null,this.isVisible=!1,this.isSuppressed=!1,this.bodyClassObserver=null,this.options={scope:document,interactiveSelector:"a, button, .clickable",enableAura:!0,activeAreaOnly:!1,cursorColor:"#39ff14",auraColor:"#39ff14"},Object.assign(this.options,e),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleBodyClassMutation=this.handleBodyClassMutation.bind(this)},e=[{key:"isMobileDevice",value:function(){return window.innerWidth<768||"ontouchstart"in window||navigator.maxTouchPoints>0}},{key:"resolveScope",value:function(t){return t?t===document||t===window?document:"string"==typeof t?document.querySelector(t)||document:t instanceof Element?t:document:document}},{key:"init",value:function(){var t=this;this.isMobileDevice()||(this.cursor=document.getElementById("terminal-cursor"),this.aura=document.getElementById("terminal-aura"),this.scopeElement=this.resolveScope(this.options.scope),this.cursor?(!this.aura&&this.options.enableAura&&(console.warn("[TerminalCursor] Elemento #terminal-aura non trovato. Disabilito aura."),this.options.enableAura=!1),this.interactiveElements=Array.from(this.scopeElement.querySelectorAll(this.options.interactiveSelector)),this.cursor.style.display="block",this.cursor.style.opacity="0",this.cursor.style.backgroundColor=this.options.cursorColor,this.cursor.classList.add("is-hidden"),this.options.enableAura&&this.aura?(this.aura.style.display="block",this.aura.style.opacity="0",this.aura.style.borderColor=this.options.auraColor,this.aura.style.boxShadow="0 0 10px ".concat(this.options.auraColor,", inset 0 0 10px ").concat(this.options.auraColor),this.aura.classList.add("is-hidden")):this.aura&&(this.aura.style.display="none"),this.isVisible=!1,_.A.on("global:mousemove",this.handleMouseMove),this.interactiveElements.forEach(function(e){e.addEventListener("mouseenter",t.handleMouseEnter),e.addEventListener("mouseleave",t.handleMouseLeave)}),this.observeBodyClassChanges(),this.updateSuppressionState(),requestAnimationFrame(function(){if(t.updateSuppressionState(),t.cursor&&!t.isSuppressed){var e=.5*window.innerWidth,i=.5*window.innerHeight;t.moveCursor(e,i,0),t.setVisibility(!0,!0)}})):console.warn("[TerminalCursor] Elemento #terminal-cursor non trovato."))}},{key:"observeBodyClassChanges",value:function(){var t;"undefined"!=typeof MutationObserver&&null!==(t=document)&&void 0!==t&&t.body&&(this.bodyClassObserver=new MutationObserver(this.handleBodyClassMutation),this.bodyClassObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]}))}},{key:"handleBodyClassMutation",value:function(){this.updateSuppressionState()}},{key:"updateSuppressionState",value:function(){var t=document.body;if(t){var e=t.classList.contains("js-pacman-cursor-active")||t.classList.contains("js-glitch-cursor-active")||t.classList.contains("js-simple-cursor-active")||t.classList.contains("custom-cursor-active");e!==this.isSuppressed&&(this.isSuppressed=e,this.isSuppressed?this.setVisibility(!1,!0):this.isVisible=!1)}}},{key:"pointInsideScope",value:function(t,e){if(!this.scopeElement||this.scopeElement===document)return!0;var i=this.scopeElement.getBoundingClientRect();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom}},{key:"setVisibility",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.cursor&&(!this.isSuppressed||!t)&&(this.isVisible!==t||e)){this.isVisible=t;var i=t?"1":"0";this.cursor.style.opacity=i,this.options.enableAura&&this.aura&&(this.aura.style.opacity=i)}}},{key:"moveCursor",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.18;if(this.cursor){if("undefined"==typeof gsap||n<=0)return i.cursor.style.left="".concat(t,"px"),i.cursor.style.top="".concat(e,"px"),void(i.options.enableAura&&i.aura&&(i.aura.style.left="".concat(t,"px"),i.aura.style.top="".concat(e,"px")));var r="power3.out";gsap.to(this.cursor,{duration:n,left:t,top:e,ease:r,overwrite:"auto"}),this.options.enableAura&&this.aura&&gsap.to(this.aura,{duration:Math.max(n,.28),left:t,top:e,ease:r,overwrite:"auto"})}}},{key:"handleMouseMove",value:function(t){if(this.cursor&&!this.isSuppressed){this.isVisible||this.setVisibility(!0);var e=t.clientX,i=t.clientY;!this.options.activeAreaOnly||this.pointInsideScope(e,i)?this.moveCursor(e,i):this.forceShowTimeout||this.setVisibility(!1)}}},{key:"handleMouseEnter",value:function(){this.cursor&&!this.isSuppressed&&(this.cursor.classList.add("cursor-hover"),this.options.enableAura&&this.aura&&this.aura.classList.add("cursor-hover"))}},{key:"handleMouseLeave",value:function(){this.cursor&&(this.cursor.classList.remove("cursor-hover"),this.options.enableAura&&this.aura&&this.aura.classList.remove("cursor-hover"))}},{key:"primeAt",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,o=void 0===r?.25:r,a=n.persistFor,s=void 0===a?900:a;this.cursor&&(this.setVisibility(!0,!0),this.moveCursor(t,e,o),this.forceShowTimeout&&clearTimeout(this.forceShowTimeout),this.options.activeAreaOnly&&(this.forceShowTimeout=setTimeout(function(){i.forceShowTimeout=null,i.setVisibility(!1)},s)))}},{key:"destroy",value:function(){var t=this;this.cursor&&(_.A.off("global:mousemove",this.handleMouseMove),this.interactiveElements.forEach(function(e){e.removeEventListener("mouseenter",t.handleMouseEnter),e.removeEventListener("mouseleave",t.handleMouseLeave)}),this.bodyClassObserver&&(this.bodyClassObserver.disconnect(),this.bodyClassObserver=null),this.forceShowTimeout&&(clearTimeout(this.forceShowTimeout),this.forceShowTimeout=null),this.cursor.classList.add("is-hidden"),this.cursor.style.display="none",this.options.enableAura&&this.aura&&(this.aura.classList.add("is-hidden"),this.aura.style.display="none"))}}],e&&K(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tt(n.key),n)}}function tt(t){var e=function(t){if("object"!=Z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Z(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z(e)?e:e+""}var et=function(){return t=function t(e){var i=e.x,n=e.y,r=e.vx,o=e.vy,a=e.radius,s=e.color,c=e.owner,l=void 0===c?"player":c,u=e.bounces,h=void 0===u?0:u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=n,this.vx=r,this.vy=o,this.radius=a,this.color=s,this.owner=l,this.bounces=h,this.shouldBeRemoved=!1,this.hitBoundary=!1},(e=[{key:"update",value:function(t,e){if(this.x+=this.vx,this.y+=this.vy,e){var i,n=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return J(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?J(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;if(this.x>r.left&&this.x<r.right&&this.y>r.top&&this.y<r.bottom)return this.shouldBeRemoved=!0,void(this.hitBoundary=!0)}}catch(t){n.e(t)}finally{n.f()}}var o=window.scrollY,a=window.innerHeight;this.bounces>0?((this.x<0||this.x>window.innerWidth)&&(this.vx*=-1,this.bounces--),(this.y<o||this.y>o+a)&&(this.vy*=-1,this.bounces--)):(this.x<-10||this.x>window.innerWidth+10||this.y<o-10||this.y>o+a+10)&&(this.shouldBeRemoved=!0)}},{key:"draw",value:function(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}}])&&Q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function it(t){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function nt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function rt(t){var e=function(t){if("object"!=it(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=it(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==it(e)?e:e+""}var ot=function(){return t=function t(e,i){var n,r,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:80,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.maxLife=s*(.8+.4*Math.random()),this.life=this.maxLife,this.color=a;var l=Math.random()*Math.PI*2,u=3*Math.random()+1;this.vx=null!==(n=c.vx)&&void 0!==n?n:Math.cos(l)*u,this.vy=null!==(r=c.vy)&&void 0!==r?r:Math.sin(l)*u,this.size=null!==(o=c.size)&&void 0!==o?o:3*Math.random()+1,this.drag=.98},(e=[{key:"update",value:function(){this.life--,this.x+=this.vx,this.y+=this.vy,this.vx*=this.drag,this.vy*=this.drag}},{key:"draw",value:function(t){t.save(),t.globalAlpha=this.life/this.maxLife,t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size*(this.life/this.maxLife),0,2*Math.PI),t.fill(),t.restore()}}])&&nt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function at(t){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}function st(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ct(n.key),n)}}function ct(t){var e=function(t){if("object"!=at(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=at(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==at(e)?e:e+""}var lt,ut,ht,ft=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()}return e=t,i=[{key:"reset",value:function(){this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.angle=0,this.radius=15,this.lives=3,this.isRespawning=!1,this.respawnTimer=0,this.lastShotTime=0,this.currentShipDesignIndex=0,this.powerUpState={fireRate:{active:!1,timer:0},tripleShot:{active:!1,timer:0},shield:{active:!1,timer:0},bounce:{active:!1,timer:0},laser:{active:!1,timer:0}},this.trailParticles=[]}},{key:"update",value:function(t,e,i){var n=t-this.x,r=e-this.y,o=Math.hypot(n,r),a=i;if(o<150){var s=.4+o/150*.6;a*=Math.min(1,s)}o>1&&(this.x+=n*a,this.y+=r*a),(Math.abs(n)>.1||Math.abs(r)>.1)&&(this.angle=Math.atan2(r,n)),this.isRespawning&&--this.respawnTimer<=0&&(this.isRespawning=!1),this.trailParticles.forEach(function(t){return t.update()}),this.trailParticles=this.trailParticles.filter(function(t){return t.life>0})}},{key:"draw",value:function(e,i,n,r){var o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!(this.isRespawning&&this.respawnTimer%20<10||a<.01)){this.trailParticles.forEach(function(t){return t.draw(e)}),e.save(),e.translate(this.x,this.y),e.rotate(this.angle),e.scale(a,a);var s=t.shipDesigns[this.currentShipDesignIndex];e.beginPath(),s.forEach(function(t,i){e[0===i?"moveTo":"lineTo"](t.x*o.radius,t.y*o.radius)}),e.closePath(),e.strokeStyle="white",e.lineWidth=1.5,e.stroke();var c=Math.min(2*Math.hypot(n.x,n.y),25);if(r&&c>3&&(e.beginPath(),e.moveTo(.7*-this.radius,.4*-this.radius),e.lineTo(-this.radius-c,0),e.lineTo(.7*-this.radius,.4*this.radius),e.closePath(),e.fillStyle="rgba(150, 200, 255, ".concat(.5+.3*Math.random(),")"),e.fill(),Math.random()>.5)){var l=this.angle+Math.PI+.5*(Math.random()-.5),u=1+Math.random();this.trailParticles.push(new ot(this.x-Math.cos(this.angle)*this.radius,this.y-Math.sin(this.angle)*this.radius,"rgba(180, 220, 255, 0.8)",20,{vx:Math.cos(l)*u,vy:Math.sin(l)*u,size:2*Math.random()+1}))}this.powerUpState.shield.active&&(e.beginPath(),e.arc(0,0,1.5*this.radius,0,2*Math.PI),e.strokeStyle="rgba(0, 255, 255, ".concat(.3+.2*Math.sin(.005*i),")"),e.lineWidth=2,e.stroke()),e.restore()}}},{key:"shoot",value:function(t,e,i){var n=this;if(!e||this.isRespawning)return null;var r=t,o=this.powerUpState.fireRate.active?125:250;if(r-this.lastShotTime>o){this.lastShotTime=r;var a=[],s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=n.angle+t,r=n.x+Math.cos(e)*n.radius,o=n.y+Math.sin(e)*n.radius,a=r+window.scrollX,s=o+window.scrollY;return new et({x:a,y:s,vx:10*Math.cos(e)+.5*i.x,vy:10*Math.sin(e)+.5*i.y,radius:2,owner:"player",color:"white",bounces:n.powerUpState.bounce.active?2:0})};return a.push(s()),this.powerUpState.tripleShot.active&&(a.push(s(-.2)),a.push(s(.2))),a}return null}},{key:"takeDamage",value:function(){return this.isRespawning?{playerHit:!1,shieldBroken:!1}:this.powerUpState.shield.active?(this.powerUpState.shield.active=!1,this.powerUpState.shield.timer=0,{shieldBroken:!0,playerHit:!1}):(this.lives--,this.lives>0&&(this.isRespawning=!0,this.respawnTimer=180),{playerHit:!0,shieldBroken:!1})}},{key:"activatePowerUp",value:function(t,e){var i=this.powerUpState[t];if(i){i.active=!0;var n=8e3;"laser"===t&&(n=4e3),"shield"===t&&(n=12e3),i.timer=e+n}}},{key:"updatePowerUps",value:function(t){for(var e in this.powerUpState){var i=this.powerUpState[e];i.active&&i.timer>0&&t>i.timer&&(i.active=!1,i.timer=0)}}}],i&&st(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function dt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pt(n.key),n)}}function pt(t){var e=function(t){if("object"!=yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=yt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yt(e)?e:e+""}lt=ft,ht=[[{x:1,y:0},{x:-.5,y:-.8},{x:-.5,y:.8}]],(ut=ct(ut="shipDesigns"))in lt?Object.defineProperty(lt,ut,{value:ht,enumerable:!0,configurable:!0,writable:!0}):lt[ut]=ht;var vt=function(){return function(t,e){return e&&dt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=["shield","tripleShot","fireRate","bounce","laser"];switch(this.type=n[Math.floor(Math.random()*n.length)],this.x=e,this.y=i,this.radius=10,this.life=400,this.shouldBeRemoved=!1,this.type){case"fireRate":this.displayText="F",this.color="#FFD700";break;case"tripleShot":this.displayText="T",this.color="#FFA500";break;case"shield":this.displayText="S",this.color="#00FFFF";break;case"bounce":this.displayText="B",this.color="#33FF33";break;case"laser":this.displayText="L",this.color="#FF0000"}},[{key:"update",value:function(){--this.life<=0&&(this.shouldBeRemoved=!0)}},{key:"draw",value:function(t){t.save(),t.translate(this.x,this.y);var e=this.life<60?this.life/60:1;t.globalAlpha=e,t.strokeStyle=this.color,t.lineWidth=1.5,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.stroke(),t.fillStyle=this.color,t.font="bold 12px 'Share Tech Mono', monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(this.displayText,0,1),t.restore()}}])}();function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function bt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return gt(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?gt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function wt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,St(n.key),n)}}function St(t){var e=function(t){if("object"!=mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=mt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}var Mt=function(){function t(e){var i=e.x,n=e.y,r=e.vx,o=e.vy,a=e.type,s=void 0===a?"normal":a;switch(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=n,this.vx=r,this.vy=o,this.type=s,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.02*(Math.random()-.5),this.shape=function(){for(var t=[],e=8+Math.floor(5*Math.random()),i=0;i<e;i++){var n=i/e*Math.PI*2,r=.7+.6*Math.random();t.push({x:Math.cos(n)*r,y:Math.sin(n)*r})}return t}(),this.spawnProgress=0,this.shouldBeRemoved=!1,s){case"fast":this.health=1,this.vx*=2.5,this.vy*=2.5,this.radius=25,this.color="#FFFFFF";break;case"large":this.health=5,this.vx*=.5,this.vy*=.5,this.radius=60,this.color="#FFFFFF";break;case"homing":this.health=2,this.radius=35,this.color="#FF6347";break;case"debris":this.health=1,this.radius=15,this.color="#A9A9A9";break;default:this.health=2,this.radius=35,this.color="#FFFFFF"}}return function(t,e){return e&&wt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"update",value:function(t,e){if("homing"===this.type&&t){var i=Math.atan2(t.y-this.y,t.x-this.x);this.vx+=.02*Math.cos(i),this.vy+=.02*Math.sin(i);var n=Math.hypot(this.vx,this.vy);n>1.2&&(this.vx=this.vx/n*1.2,this.vy=this.vy/n*1.2)}this.x+=this.vx,this.y+=this.vy,this.rotation+=this.rotationSpeed,this.spawnProgress<1&&(this.spawnProgress+=.05),this.handleBoundaries(e)}},{key:"handleBoundaries",value:function(t){var e=!1;if(t&&t.length>0){var i,n=bt(t);try{for(n.s();!(i=n.n()).done;){var r=i.value,o=Math.max(r.left,Math.min(this.x,r.right)),a=Math.max(r.top,Math.min(this.y,r.bottom));if(Math.hypot(this.x-o,this.y-a)<this.radius){var s=this.radius-Math.abs(this.x-o),c=this.radius-Math.abs(this.y-a);s<c?(this.vx*=-1,this.x+=this.vx>0?s:-s):(this.vy*=-1,this.y+=this.vy>0?c:-c),e=!0;break}}}catch(t){n.e(t)}finally{n.f()}}e||this.wrapEntity(t)}},{key:"draw",value:function(t){var e=this;t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.beginPath(),this.shape.forEach(function(i,n){var r=i.x*e.radius*e.spawnProgress,o=i.y*e.radius*e.spawnProgress;t[0===n?"moveTo":"lineTo"](r,o)}),t.closePath(),t.strokeStyle=this.color,t.lineWidth=1.5,t.stroke(),t.restore()}},{key:"takeDamage",value:function(e){if(this.health-=e,this.health<=0&&(this.shouldBeRemoved=!0,"large"===this.type||"normal"===this.type)){for(var i="large"===this.type?3:2,n=[],r=0;r<i;r++){n.push(new t({x:this.x,y:this.y,vx:2*(2*Math.random()-1),vy:2*(2*Math.random()-1),type:"debris"}))}return n}return null}},{key:"wrapEntity",value:function(t){var e=this.radius,i=window.scrollY,n=window.innerHeight;if(this.x,this.y,this.x<-e&&(this.x=window.innerWidth+e),this.x>window.innerWidth+e&&(this.x=-e),this.y<i-e&&(this.y=i+n+e),this.y>i+n+e&&(this.y=i-e),t&&t.length>0){var r,o=bt(t);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=Math.max(a.left,Math.min(this.x,a.right)),c=Math.max(a.top,Math.min(this.y,a.bottom));if(Math.hypot(this.x-s,this.y-c)<this.radius)return void(this.shouldBeRemoved=!0)}}catch(t){o.e(t)}finally{o.f()}}}}])}();function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function Et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xt(n.key),n)}}function xt(t){var e=function(t){if("object"!=Tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Tt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tt(e)?e:e+""}var At=function(){return function(t,e){return e&&Et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ship=e,this.pathTimer=100*Math.random(),this.shootCooldown=120+60*Math.random()},[{key:"update",value:function(t){if(this.pathTimer++,this.ship.y+=.5*Math.sin(.05*this.pathTimer),(this.ship.vx>0&&this.ship.x>window.innerWidth+2*this.ship.radius||this.ship.vx<0&&this.ship.x<2*-this.ship.radius)&&(this.ship.shouldBeRemoved=!0),--this.shootCooldown<=0&&t&&!t.isRespawning){this.shootCooldown=120+60*Math.random();var e=Math.atan2(t.y-this.ship.y,t.x-this.ship.x);return new et({x:this.ship.x,y:this.ship.y,vx:4*Math.cos(e),vy:4*Math.sin(e),radius:3,color:"#33FF33",owner:"enemy"})}return null}}])}();function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Ot(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Pt(n.key),n)}}function Pt(t){var e=function(t){if("object"!=kt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=kt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kt(e)?e:e+""}var Ct=function(){return function(t,e){return e&&Ot(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.radius=20,this.health=3,this.vx=e<window.innerWidth/2?1.5:-1.5,this.vy=0,this.shouldBeRemoved=!1,this.color="#33FF33",this.spawnProgress=0,this.ai=new At(this)},[{key:"update",value:function(t,e){this.spawnProgress<1&&(this.spawnProgress+=.04),this.x+=this.vx,this.y+=this.vy;var i=this.ai.update(t);return this.wrapEntity(),i}},{key:"draw",value:function(t){if(!(this.spawnProgress<.1)){t.save(),t.translate(this.x,this.y);var e=this.spawnProgress;t.scale(e,e);var i=this.radius,n=.5*i,r=.7*i;t.fillStyle=this.color,t.strokeStyle="#FFFFFF",t.lineWidth=1.5,t.beginPath(),t.moveTo(-i,0),t.quadraticCurveTo(0,n,i,0),t.quadraticCurveTo(0,-n,-i,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.5)",t.strokeStyle=this.color,t.beginPath(),t.arc(0,.3*-r,r,Math.PI,0),t.closePath(),t.fill(),t.stroke(),t.restore()}}},{key:"takeDamage",value:function(t){return this.health-=t,this.health<=0&&(this.shouldBeRemoved=!0),null}},{key:"wrapEntity",value:function(){var t=this.radius,e=window.scrollY,i=window.innerHeight;this.x<-t&&(this.x=window.innerWidth+t),this.x>window.innerWidth+t&&(this.x=-t),this.y<e-t&&(this.y=e+i+t),this.y>e+i+t&&(this.y=e-t)}}])}();function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function _t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jt(n.key),n)}}function jt(t){var e=function(t){if("object"!=It(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=It(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==It(e)?e:e+""}var Rt=function(){return function(t,e){return e&&_t(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){var i=e.x,n=e.y,r=e.value,o=void 0===r?1:r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=n,this.value=o,this.radius=10,this.color="#FFD700",this.rotation=0,this.pulse=0,this.shouldBeRemoved=!1,this.life=600,this.sparklePhase=Math.random()*Math.PI*2,this._seed=1e3*Math.random()},[{key:"update",value:function(){this.rotation+=.08,this.pulse+=.16,this.sparklePhase+=.12;var t=.08*Math.sin(this.pulse),e=.06*Math.max(0,(60-Math.min(60,this.life))/60);this.scale=1+t+e,--this.life<=0&&(this.shouldBeRemoved=!0)}},{key:"draw",value:function(t){Math.max(.08,this.life/600),t.save(),t.translate(this.x,this.y),t.rotate(.6*this.rotation),t.scale(this.scale,this.scale),t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.lineWidth=Math.max(2,Math.round(.18*this.radius)),t.strokeStyle="#FFD54A",t.stroke(),t.beginPath(),t.arc(0,0,this.radius-2,0,2*Math.PI),t.lineWidth=1,t.strokeStyle="rgba(30,30,30,0.85)",t.stroke(),t.fillStyle="#FFD54A",t.font="bold ".concat(Math.round(1.2*this.radius),'px "Share Tech Mono", monospace'),t.textAlign="center",t.textBaseline="middle",t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.8)",t.strokeText("C",0,0),t.fillText("C",0,0),t.restore()}},{key:"takeCollected",value:function(){return this.shouldBeRemoved=!0,this.value}}])}();function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Dt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Gt(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function Gt(t,e){if(t){if("string"==typeof t)return Bt(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Bt(t,e):void 0}}function Bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Nt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ht(n.key),n)}}function Ht(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Lt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}var Ft=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()}return function(t,e){return e&&Nt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"reset",value:function(){this.currentWave=-1,this.isTransitioning=!1}},{key:"startNextWave",value:function(e){var i=this;if(this.currentWave>=t.waveConfig.length-1)return{event:"game_win"};this.currentWave++,this.isTransitioning=!0;var n=t.waveConfig[this.currentWave],r=[],o=0;if(n.asteroids&&Object.entries(n.asteroids).forEach(function(t){for(var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||Gt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),a=n[0],s=n[1],c=0;c<s;c++){var l=i._getSpawnPosition(e,a),u=window.innerHeight/2+window.scrollY,h=window.innerWidth/2+window.scrollX,f=Math.atan2(u-l.y,h-l.x),y=Math.cos(f)*(.5+.5*Math.random()),d=Math.sin(f)*(.5+.5*Math.random()),p=2500;r.push({entity:new Mt({x:l.x,y:l.y,vx:y,vy:d,type:a}),delay:p}),p>o&&(o=p)}}),n.alienShips)for(var a=n.alienShipDelay||1500,s=0;s<n.alienShips;s++){var c=Math.random()>.5?-50+window.scrollX:window.innerWidth+50+window.scrollX,l=Math.random()*(.8*window.innerHeight)+.1*window.innerHeight+window.scrollY,u=2500+s*a;r.push({entity:new Ct(c,l),delay:u}),u>o&&(o=u)}return setTimeout(function(){i.isTransitioning=!1},o),{entities:r}}},{key:"_getSpawnRadius",value:function(t){switch(t){case"fast":return 25;case"large":return 60;case"debris":return 15;default:return 35}}},{key:"_isCircleCollidingWithRect",value:function(t,e){var i=Math.max(e.left,Math.min(t.x,e.right)),n=Math.max(e.top,Math.min(t.y,e.bottom)),r=t.x-i,o=t.y-n;return r*r+o*o<t.radius*t.radius}},{key:"_getSpawnPosition",value:function(t,e){var i,n,r,o=0,a=this._getSpawnRadius(e);do{r=!0;var s=Math.floor(4*Math.random()),c=a+50,l=window.innerWidth,u=window.innerHeight;switch(s){case 0:i=-c,n=Math.random()*u;break;case 1:i=l+c,n=Math.random()*u;break;case 2:n=-c,i=Math.random()*l;break;case 3:n=u+c,i=Math.random()*l}var h=i+window.scrollX,f=n+window.scrollY;if(t){var y,d={x:h,y:f,radius:a},p=Dt(t);try{for(p.s();!(y=p.n()).done;){var v=y.value;if(this._isCircleCollidingWithRect(d,v)){r=!1;break}}}catch(t){p.e(t)}finally{p.f()}}i=h,n=f,o++}while(!r&&o<30);if(!r){var m=0;do{r=!0,i=Math.random()*window.innerWidth,n=Math.random()*window.innerHeight;var b=i+window.scrollX,g=n+window.scrollY,w={x:b,y:g,radius:a};if(t){var S,M=Dt(t);try{for(M.s();!(S=M.n()).done;){var T=S.value;if(this._isCircleCollidingWithRect(w,T)){r=!1;break}}}catch(t){M.e(t)}finally{M.f()}}i=b,n=g,m++}while(!r&&m<50)}return{x:i,y:n}}}])}();function zt(t){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt(t)}function Ut(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wt(n.key),n)}}function Wt(t){var e=function(t){if("object"!=zt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=zt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zt(e)?e:e+""}!function(t,e,i){(e=Ht(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(Ft,"waveConfig",[{message:"WAVE 1",asteroids:{normal:5}},{message:"WAVE 2",asteroids:{normal:7,fast:2}},{message:"WAVE 3",asteroids:{normal:5,large:2}},{message:"WAVE 4",alienShips:1,alienShipDelay:1500},{message:"WAVE 5",asteroids:{normal:8,homing:1}},{message:"WAVE 6",asteroids:{fast:10},alienShips:1,alienShipDelay:1500},{message:"WAVE 7",asteroids:{large:4,homing:2}},{message:"WAVE 8",alienShips:3,alienShipDelay:1500},{message:"WAVE 9",asteroids:{normal:10,fast:5,large:3,homing:3},alienShips:2,alienShipDelay:1e3},{message:"FINAL WAVE",asteroids:{large:5,homing:5},alienShips:4,alienShipDelay:800}]);var Vt=function(){return function(t,e){return e&&Ut(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global-score";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scoreEl=document.getElementById(e),this.creditsEl=document.querySelector("#credits-display span"),this._creditsKey="asteroids_credits_v1",this.reset(),this._credits=this._loadCredits(),this._updateCreditsDisplay()},[{key:"reset",value:function(){this.notifications=[],this.scorePopups=[],this.hudNotifications=[],this.hudOpacity=0,this.waveFlashTimer=0,this.scoreEl&&this.scoreEl.classList.remove("score-visible")}},{key:"addNotification",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120;this.notifications.push({text:t,color:e,life:i,maxLife:i})}},{key:"addHudNotification",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120;this.hudNotifications.push({text:t,color:e,life:i,maxLife:i})}},{key:"addScorePopup",value:function(t,e,i){this.scorePopups.push({x:t,y:e,text:i,life:60})}},{key:"triggerWaveFlash",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120;this.waveFlashTimer=t}},{key:"update",value:function(t,e){var i=t&&!e?1:0;this.hudOpacity+=.1*(i-this.hudOpacity),this.waveFlashTimer>0&&this.waveFlashTimer--;for(var n=this.notifications.length-1;n>=0;n--)--this.notifications[n].life<=0&&this.notifications.splice(n,1);for(var r=this.hudNotifications.length-1;r>=0;r--)--this.hudNotifications[r].life<=0&&this.hudNotifications.splice(r,1);for(var o=this.scorePopups.length-1;o>=0;o--){var a=this.scorePopups[o];a.life--,a.y-=.5,a.life<=0&&this.scorePopups.splice(o,1)}}},{key:"draw",value:function(t,e){this.hudOpacity>.01&&this._drawHUD(t,e),this._drawNotifications(t),this._drawScorePopups(t),e.isGameOver&&this._drawGameOver(t,e)}},{key:"showFinalScore",value:function(t){this.scoreEl&&(this.scoreEl.innerHTML="GAME OVER - FINAL SCORE: ".concat(t),this.scoreEl.classList.add("score-visible"))}},{key:"_drawHUD",value:function(t,e){var i=this,n=e.lives,r=e.score,o=e.wave,a=e.playerX,s=e.playerY;t.save(),t.globalAlpha=this.hudOpacity,t.font="bold 12px 'Share Tech Mono', monospace",t.textAlign="right";var c=a+95,l=s+5;t.fillStyle="white",t.fillText("SCORE: ".concat(r),c,l),t.fillText("▲ ".repeat(n).trim(),c,l+15),!(this.waveFlashTimer>0&&this.waveFlashTimer%20<10)&&(t.fillStyle=this.waveFlashTimer>0?"#FFD700":"white",t.fillText("WAVE: ".concat(o),c,l+30)),t.font="bold 11px 'Share Tech Mono', monospace",this.hudNotifications.forEach(function(e,n){var r=e.life<30?e.life/30:1;t.globalAlpha=i.hudOpacity*r,t.fillStyle=e.color,t.fillText(e.text,c,l+50+15*n)}),t.restore()}},{key:"_drawNotifications",value:function(t){this.notifications.forEach(function(e){t.save();var i=e.life<30?e.life/30:1;t.globalAlpha=i,t.font="bold 16px 'Share Tech Mono', monospace",t.fillStyle=e.color,t.textAlign="center";var n=window.innerHeight/2-50-.3*(e.maxLife-e.life);t.fillText(e.text,window.innerWidth/2,n),t.restore()})}},{key:"_drawScorePopups",value:function(t){this.scorePopups.forEach(function(e){t.save(),t.font="bold 14px 'Share Tech Mono', monospace",t.fillStyle="rgba(255, 255, 255, ".concat(e.life/60,")"),t.textAlign="center",t.fillText(e.text,e.x,e.y),t.restore()})}},{key:"_drawGameOver",value:function(t,e){var i=e.mouseX,n=e.mouseY;t.save(),t.font="bold 20px 'Share Tech Mono', monospace",t.fillStyle="white",t.textAlign="center",t.fillText("GAME OVER",i,n-10),t.font="14px 'Share Tech Mono', monospace",t.fillText("(Click to Restart)",i,n+12),t.restore()}},{key:"_loadCredits",value:function(){try{var t=localStorage.getItem(this._creditsKey);return t&&parseInt(t,10)||0}catch(t){return 0}}},{key:"_saveCredits",value:function(t){try{localStorage.setItem(this._creditsKey,String(t))}catch(t){}}},{key:"_updateCreditsDisplay",value:function(){this.creditsEl&&(this.creditsEl.textContent=String(this._credits||0))}},{key:"getCredits",value:function(){return this._credits||0}},{key:"setCredits",value:function(t){this._credits=Math.max(0,Math.floor(t)),this._saveCredits(this._credits),this._updateCreditsDisplay()}},{key:"addCredits",value:function(t){this.setCredits(this.getCredits()+Math.floor(t)),this.addHudNotification("+".concat(t," CREDITS"),"#FFD700",90)}},{key:"spendCredits",value:function(t){return this.getCredits()>=t&&(this.setCredits(this.getCredits()-t),!0)}}])}();function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}function qt(t){return function(t){if(Array.isArray(t))return $t(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Xt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Xt(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function Xt(t,e){if(t){if("string"==typeof t)return $t(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?$t(t,e):void 0}}function $t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Zt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Jt(n.key),n)}}function Jt(t){var e=function(t){if("object"!=Yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Yt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yt(e)?e:e+""}var Qt=function(){return function(t,e){return e&&Zt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},[{key:"checkCollisions",value:function(t,e){var i,n=[],r=e.filter(function(t){return t instanceof Mt||t instanceof Ct}),o=e.filter(function(t){return t instanceof et&&"player"===t.owner}),a=e.filter(function(t){return t instanceof et&&"enemy"===t.owner}),s=e.filter(function(t){return t instanceof vt}),c=e.filter(function(t){return t instanceof Rt}),l=Kt(o);try{for(l.s();!(i=l.n()).done;){var u,h=i.value,f=Kt(r);try{for(f.s();!(u=f.n()).done;){var y=u.value;if(this.isCollidingEntities(h,y)){n.push({type:"bullet_hit_enemy",bullet:h,enemy:y});break}}}catch(t){f.e(t)}finally{f.f()}}}catch(t){l.e(t)}finally{l.f()}if(!t.isRespawning){var d,p=Kt([].concat(qt(r),qt(a)));try{for(p.s();!(d=p.n()).done;){var v=d.value,m=void 0!==v.x?v.x-window.scrollX:v.x,b=void 0!==v.y?v.y-window.scrollY:v.y,g=t.x-m,w=t.y-b;if(Math.hypot(g,w)<(t.radius||0)+(v.radius||0)){n.push({type:"player_hit_enemy",player:t,enemy:v});break}}}catch(t){p.e(t)}finally{p.f()}var S,M=Kt(s);try{for(M.s();!(S=M.n()).done;){var T=S.value,E=T.x-window.scrollX,x=T.y-window.scrollY,A=t.x-E,k=t.y-x;Math.hypot(A,k)<(t.radius||0)+(T.radius||0)&&n.push({type:"player_collect_powerup",player:t,powerUp:T})}}catch(t){M.e(t)}finally{M.f()}var O,P=Kt(c);try{for(P.s();!(O=P.n()).done;){var C=O.value,I=C.x-window.scrollX,_=C.y-window.scrollY,j=t.x-I,R=t.y-_;Math.hypot(j,R)<(t.radius||0)+(C.radius||0)&&n.push({type:"player_collect_coin",player:t,coin:C})}}catch(t){P.e(t)}finally{P.f()}}return n}},{key:"isColliding",value:function(t,e){if(!t||!e)return!1;var i=t.x-e.x,n=t.y-e.y;return Math.hypot(i,n)<(t.radius||0)+(e.radius||0)}},{key:"isCollidingEntities",value:function(t,e){if(!t||!e)return!1;var i=t.x-e.x,n=t.y-e.y;return Math.hypot(i,n)<(t.radius||0)+(e.radius||0)}}])}();function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ie(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,re(n.key),n)}}function ne(t,e,i){return e&&ie(t.prototype,e),i&&ie(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function re(t){var e=function(t){if("object"!=te(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=te(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:e+""}var oe=function(){return ne(function t(e,i,n,r){ee(this,t),this.x=e,this.y=i,this.z=n,this.speed=r},[{key:"update",value:function(t,e){this.x-=t.x*(this.z/e)*this.speed,this.y-=t.y*(this.z/e)*this.speed}},{key:"draw",value:function(t,e){var i=2*(1-this.z/e),n=.8*(1-this.z/e);t.fillStyle="rgba(255, 255, 255, ".concat(n,")"),t.beginPath(),t.arc(this.x,this.y,i,0,2*Math.PI),t.fill()}}])}(),ae=function(){return ne(function t(){ee(this,t),this.stars=[],this.bounds={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight},this.expansionFactor=.5,this.initStars()},[{key:"initStars",value:function(){this.stars=[];for(var t=this.bounds.right,e=(this.bounds.bottom,0);e<200;e++)this.stars.push(this._createStarInBounds(this.bounds,t))}},{key:"_createStarInBounds",value:function(t,e){var i=Math.random()*(t.right-t.left)+t.left,n=Math.random()*(t.bottom-t.top)+t.top,r=Math.random()*e;return new oe(i,n,r,r<e/2?.05:.1)}},{key:"update",value:function(t,e){var i=window.innerWidth;this.stars.forEach(function(e){return e.update(t,i)}),this._expandBounds(e.x,e.y),this._cleanupStars(e.x,e.y)}},{key:"_expandBounds",value:function(t,e){var i=window.innerWidth,n=window.innerHeight,r=i*this.expansionFactor,o=n*this.expansionFactor;if(t>this.bounds.right-r){for(var a={left:this.bounds.right,right:this.bounds.right+i,top:this.bounds.top,bottom:this.bounds.bottom},s=0;s<100;s++)this.stars.push(this._createStarInBounds(a,i));this.bounds.right+=i}if(t<this.bounds.left+r){for(var c={left:this.bounds.left-i,right:this.bounds.left,top:this.bounds.top,bottom:this.bounds.bottom},l=0;l<100;l++)this.stars.push(this._createStarInBounds(c,i));this.bounds.left-=i}if(e>this.bounds.bottom-o){for(var u={left:this.bounds.left,right:this.bounds.right,top:this.bounds.bottom,bottom:this.bounds.bottom+n},h=0;h<100;h++)this.stars.push(this._createStarInBounds(u,i));this.bounds.bottom+=n}if(e<this.bounds.top+o){for(var f={left:this.bounds.left,right:this.bounds.right,top:this.bounds.top-n,bottom:this.bounds.top},y=0;y<100;y++)this.stars.push(this._createStarInBounds(f,i));this.bounds.top-=n}}},{key:"_cleanupStars",value:function(t,e){var i=2*window.innerWidth,n=2*window.innerHeight;this.stars=this.stars.filter(function(r){return Math.abs(r.x-t)<i&&Math.abs(r.y-e)<n})}},{key:"draw",value:function(t){var e=window.innerWidth;t.save(),t.translate(-window.scrollX,-window.scrollY),this.stars.forEach(function(i){return i.draw(t,e)}),t.restore()}},{key:"resize",value:function(){}}])}();function se(t,e){var i,n=this;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];clearTimeout(i),i=setTimeout(function(){return t.apply(n,o)},e)}}function ce(t){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ce(t)}function le(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=he(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function ue(t){return function(t){if(Array.isArray(t))return fe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||he(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(t,e){if(t){if("string"==typeof t)return fe(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?fe(t,e):void 0}}function fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function ye(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,de(n.key),n)}}function de(t){var e=function(t){if("object"!=ce(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ce(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ce(e)?e:e+""}var pe=function(){return function(t,e){return e&&ye(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.isActive=window.matchMedia("(pointer: fine)").matches,this.gameTime=0,this.animationFrameId=null,this.lastTimestamp=null,this.delta=0,this.abortController=new AbortController,this.spawnTimeouts=new Set,this.isGameOver=!1,this.isShipMode=!1,this.isShooting=!1,this.isReturningToCursor=!1,this.isPaused=!1,this.magneticState="none",this.magneticTransition=0,this.score=0,this.shake={intensity:0,duration:0},this.globalAlpha=0,this.isMagnetic=!1,this.attachedTarget=null,this.bounceBoundaries=[],this.mouse={x:-100,y:-100},this.prevMouse={x:-100,y:-100},this.mouseVelocity={x:0,y:0},this.player=new ft,this.entities=[],this.particles=[],this.waveManager=new Ft,this.uiManager=new Vt,this.collisionManager=new Qt,this.background=new ae,this.gameLoop=this.gameLoop.bind(this),this.handleResize=this.handleResize.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleClick=this.handleClick.bind(this),this.debouncedSetBoundaries=se(function(){return i.setBounceBoundaries(".interactive-bounce")},100)):this.isActive=!1},[{key:"setBounceBoundaries",value:function(t){var e=this;this.bounceBoundaries=[],document.querySelectorAll(t).forEach(function(t){var i=t.getBoundingClientRect();e.bounceBoundaries.push({left:i.left+window.scrollX,right:i.right+window.scrollX,top:i.top+window.scrollY,bottom:i.bottom+window.scrollY})})}},{key:"start",value:function(){this.isActive&&(this.addEventListeners(),this.handleResize(),this.setBounceBoundaries(".interactive-bounce"),this.reset(),this.gameLoop())}},{key:"stop",value:function(){this.isActive&&(this.isActive=!1,cancelAnimationFrame(this.animationFrameId),this.removeEventListeners(),this.abortController.abort(),this.clearAllTimeouts(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}},{key:"reset",value:function(){this.clearAllTimeouts(),this.isGameOver=!1,this.isShipMode=!1,this.score=0,this.player.reset(),this.entities=[],this.particles=[],this.waveManager.reset(),this.uiManager.reset()}},{key:"handleResize",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.background.resize(this.canvas.width,this.canvas.height),this.debouncedSetBoundaries()}},{key:"handleScroll",value:function(){this.debouncedSetBoundaries()}},{key:"handleMouseMove",value:function(t){this.mouse.x=t.clientX,this.mouse.y=t.clientY}},{key:"handleMouseDown",value:function(t){t.preventDefault(),0!==t.button||!this.isShipMode||this.isGameOver||this.player.isRespawning||(this.isShooting=!0)}},{key:"handleMouseUp",value:function(t){0===t.button&&(this.isShooting=!1)}},{key:"handleClick",value:function(){this.isGameOver&&this.reset()}},{key:"addEventListeners",value:function(){_.A.on("global:resize",this.handleResize),_.A.on("global:scroll",this.handleScroll),_.A.on("global:mousemove",this.handleMouseMove),_.A.on("global:mousedown",this.handleMouseDown),_.A.on("global:mouseup",this.handleMouseUp),_.A.on("global:click",this.handleClick)}},{key:"removeEventListeners",value:function(){_.A.off("global:resize",this.handleResize),_.A.off("global:scroll",this.handleScroll),_.A.off("global:mousemove",this.handleMouseMove),_.A.off("global:mousedown",this.handleMouseDown),_.A.off("global:mouseup",this.handleMouseUp),_.A.off("global:click",this.handleClick)}},{key:"gameLoop",value:function(t){this.isActive&&(this.delta=this.lastTimestamp?Math.min(.05,(t-this.lastTimestamp)/1e3):0,this.lastTimestamp=t,this.gameTime=t,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.background.draw(this.ctx),this.ctx.save(),this.applyShake(),this.update(),this.draw(),this.ctx.restore(),this.animationFrameId=requestAnimationFrame(this.gameLoop))}},{key:"update",value:function(){var t;this.updateMouseVelocity(),this.background.update(this.mouseVelocity,this.player);var e=this.mouse.x,i=this.mouse.y,n=this.isShipMode?.06:.01;if("entering"===this.magneticState&&this.attachedTarget){var r=this.attachedTarget.getBoundingClientRect();e=r.left+r.width/2,i=r.top+r.height/2,n=.2;var o=e-this.player.x,a=i-this.player.y;Math.hypot(o,a)<10&&(this.magneticTransition+=this.delta/Math.max(1e-4,.25),this.magneticTransition>=1&&(this.magneticTransition=1,this.magneticState="active",this.isPaused=!0,this.attachedTarget.classList.add("is-magnet-locked"),this.canvas.style.pointerEvents="none"))}else{if("active"===this.magneticState){var s=this.attachedTarget.getBoundingClientRect();return this.player.x=s.left+s.width/2,void(this.player.y=s.top+s.height/2)}if("exiting"===this.magneticState&&(this.magneticTransition-=this.delta/Math.max(1e-4,.25),this.magneticTransition<=0&&(this.magneticTransition=0,this.magneticState="none",this.isPaused=!1,this.canvas&&(this.canvas.style.pointerEvents="auto"),this.attachedTarget))){try{this.attachedTarget.classList.remove("is-magnet-locked")}catch(t){}this.attachedTarget=null}}if(!this.isPaused){this.player.update(e,i,n);var c=Math.hypot(this.mouse.x-this.player.x,this.mouse.y-this.player.y),l=this.isShipMode;if(this.isGameOver?this.isShipMode=!1:c>this.player.radius?this.isShipMode=!0:this.isShipMode=!1,this.isShipMode&&!l){var u=this.entities.some(function(t){return t instanceof Mt||t instanceof Ct});u||this.waveManager.isTransitioning||this.startNextWave()}var h=this.isShipMode?1:0;if(this.globalAlpha+=.08*(h-this.globalAlpha),this.uiManager.update(this.isShipMode,this.player.isRespawning),this.globalAlpha<.01&&this.magneticTransition<=0)this.particles=[];else{if(this.player.updatePowerUps(this.gameTime),this.player.powerUpState.laser.active&&this.isShooting)this.applyLaserDamage();else{var f,y=this.player.shoot(this.gameTime,this.isShooting,this.mouseVelocity);y&&(f=this.entities).push.apply(f,ue(y))}var d,p=[],v=le(this.entities);try{for(v.s();!(d=v.n()).done;){var m=d.value,b=m.update(this.player,this.bounceBoundaries);b&&p.push.apply(p,ue(Array.isArray(b)?b:[b])),"Bullet"===m.constructor.name&&m.hitBoundary&&this.createImpactSpark(m.x,m.y)}}catch(t){v.e(t)}finally{v.f()}p.length>0&&(t=this.entities).push.apply(t,p),this.particles.forEach(function(t){return t.update()});var g=this.collisionManager.checkCollisions(this.player,this.entities);g.length>0&&this.handleCollisionEvents(g),this.entities=this.entities.filter(function(t){return!t.shouldBeRemoved}),this.particles=this.particles.filter(function(t){return t.life>0});var w=this.entities.some(function(t){return t instanceof Mt||t instanceof Ct});!this.isShipMode||w||this.waveManager.isTransitioning||this.startNextWave()}}}},{key:"draw",value:function(){var t=this,e=1-this.globalAlpha;if(e>.01&&"none"===this.magneticState){this.ctx.save(),this.ctx.globalAlpha=e,this.ctx.beginPath();var i=this.player.radius*(1-this.globalAlpha);this.ctx.arc(this.player.x,this.player.y,Math.max(.1,i),0,2*Math.PI),this.ctx.strokeStyle="rgba(255, 255, 255, ".concat(.8*e,")"),this.ctx.stroke(),this.ctx.restore()}var n=this.globalAlpha;this.ctx.save(),this.ctx.translate(-window.scrollX,-window.scrollY),this.ctx.globalAlpha=n,n>.01&&(this.entities.forEach(function(e){return e.draw(t.ctx,t.gameTime)}),this.particles.forEach(function(e){return e.draw(t.ctx)}),this.player.powerUpState.laser.active&&this.isShooting&&this.drawLaser()),this.ctx.restore();var r=(1-this.magneticTransition)*this.globalAlpha;r>.01&&this.player.draw(this.ctx,this.gameTime,this.mouseVelocity,this.isShipMode,r),this.uiManager.draw(this.ctx,{lives:this.player.lives,score:this.score,wave:this.waveManager.currentWave+1,isGameOver:this.isGameOver,playerX:this.player.x,playerY:this.player.y,mouseX:this.mouse.x,mouseY:this.mouse.y}),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(this.mouse.x,this.mouse.y,3,0,2*Math.PI),this.ctx.fill()}},{key:"createImpactSpark",value:function(t,e){for(var i=0;i<5;i++)this.particles.push(new ot(t,e,"rgba(255,255,255,0.7)",20,{size:1.5*Math.random()}))}},{key:"createExplosion",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:25,r=0;r<n;r++)this.particles.push(new ot(t,e,i))}},{key:"handleCollisionEvents",value:function(t){var e,i,n=le(t);try{for(n.s();!(i=n.n()).done;){var r=i.value;switch(r.type){case"bullet_hit_enemy":r.bullet.shouldBeRemoved=!0,this.createExplosion(r.bullet.x,r.bullet.y,"rgba(255,255,255,0.5)",5);var o=r.enemy.takeDamage(1);if(o&&(e=this.entities).push.apply(e,ue(o)),r.enemy.shouldBeRemoved){var a=r.enemy instanceof Ct?300:"large"===r.enemy.type?150:"debris"===r.enemy.type?25:100;this.score+=a,this.uiManager.addScorePopup(r.enemy.x-window.scrollX,r.enemy.y-window.scrollY,"+".concat(a)),this.createExplosion(r.enemy.x,r.enemy.y,r.enemy.color);var s=!1;if(Math.random()<.25&&(this.entities.push(new vt(r.enemy.x,r.enemy.y)),s=!0),!s&&Math.random()<.12){this.entities.push(new Rt({x:r.enemy.x,y:r.enemy.y,value:1}))}}break;case"player_hit_enemy":"player"!==r.enemy.owner&&(r.enemy.shouldBeRemoved=!0),this.triggerShake(30,30),this.createExplosion(this.player.x,this.player.y);var c=this.player.takeDamage();c.shieldBroken&&(this.uiManager.addHudNotification("SHIELD LOST!","#00FFFF"),this.createExplosion(this.player.x,this.player.y,"cyan",40)),c.playerHit&&this.player.lives<=0&&(this.isGameOver=!0,this.uiManager.showFinalScore(this.score)),this.isShipMode=!1;break;case"player_collect_powerup":r.powerUp.shouldBeRemoved=!0,this.player.activatePowerUp(r.powerUp.type,this.gameTime),this.uiManager.addHudNotification({fireRate:"FIRE RATE",tripleShot:"TRIPLE SHOT",shield:"SHIELD",bounce:"BOUNCE SHOTS",laser:"LASER"}[r.powerUp.type],r.powerUp.color);break;case"player_collect_coin":if(r.coin){r.coin.shouldBeRemoved=!0;var l=r.coin.value||1;this.uiManager.addCredits(l),this.uiManager.addScorePopup(r.coin.x-window.scrollX,r.coin.y-window.scrollY,"+".concat(l,"C"));var u=document.getElementById("coin-audio");if(u&&"function"==typeof u.play)try{u.currentTime=0;var h="function"!=typeof u.canPlayType||u.canPlayType("audio/mpeg")||u.canPlayType("audio/ogg");""!==h&&"no"!==h||console.warn("[AsteroidsGame] Audio coin-audio potrebbe non essere supportato dal browser:",u);var f=u.play();f&&"function"==typeof f.catch&&f.catch(function(){})}catch(t){}}}}}catch(t){n.e(t)}finally{n.f()}}},{key:"startNextWave",value:function(){var t=this,e=this.waveManager.startNextWave(this.bounceBoundaries);if("game_win"===e.event)return this.uiManager.addNotification("YOU WIN!","#FFD700",300),this.isGameOver=!0,void this.uiManager.showFinalScore(this.score);this.uiManager.triggerWaveFlash(),e.entities&&e.entities.forEach(function(e){var i;i=setTimeout(function(){t.isShipMode&&t.entities.push(e.entity),t.spawnTimeouts.delete(i)},e.delay),t.spawnTimeouts.add(i)})}},{key:"updateMouseVelocity",value:function(){this.mouseVelocity.x=this.mouse.x-this.prevMouse.x,this.mouseVelocity.y=this.mouse.y-this.prevMouse.y,this.prevMouse.x=this.mouse.x,this.prevMouse.y=this.mouse.y}},{key:"clearAllTimeouts",value:function(){this.spawnTimeouts.forEach(clearTimeout),this.spawnTimeouts.clear()}},{key:"triggerShake",value:function(t,e){this.shake.intensity=Math.max(this.shake.intensity,t),this.shake.duration=Math.max(this.shake.duration,e)}},{key:"applyShake",value:function(){if(this.shake.duration>0){this.shake.duration--;var t=(Math.random()-.5)*this.shake.intensity*(this.shake.duration/10),e=(Math.random()-.5)*this.shake.intensity*(this.shake.duration/10);this.ctx.translate(t,e)}else this.shake.intensity=0}},{key:"applyLaserDamage",value:function(){var t,e=this.player.angle,i=this.player.x+Math.cos(e)*this.player.radius,n=this.player.y+Math.sin(e)*this.player.radius,r=this.player.x+2e3*Math.cos(e),o=this.player.y+2e3*Math.sin(e),a=this.entities.filter(function(t){return t instanceof Mt||t instanceof Ct}),s=le(a);try{for(s.s();!(t=s.n()).done;){var c=t.value;if(Math.abs((o-n)*c.x-(r-i)*c.y+r*n-o*i)/Math.hypot(o-n,r-i)<c.radius){var l,u=c.takeDamage(.25);u&&(l=this.entities).push.apply(l,ue(u)),Math.random()<.2&&this.createExplosion(c.x,c.y,"rgba(255,0,0,0.5)",2)}}}catch(t){s.e(t)}finally{s.f()}}},{key:"drawLaser",value:function(){var t=this.player.angle,e=this.player.x+Math.cos(t)*this.player.radius,i=this.player.y+Math.sin(t)*this.player.radius,n=this.player.x+2e3*Math.cos(t),r=this.player.y+2e3*Math.sin(t);this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(n,r),this.ctx.strokeStyle="rgba(255, 0, 0, ".concat(.5+.5*Math.random(),")"),this.ctx.lineWidth=1+4*Math.random(),this.ctx.stroke()}}])}();function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function me(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,be(n.key),n)}}function be(t){var e=function(t){if("object"!=ve(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ve(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ve(e)?e:e+""}var ge=function(){return function(t,e){return e&&me(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas?(this.game=new pe(e),this.isActive=this.game.isActive):this.isActive=!1},[{key:"init",value:function(){this.isActive&&(document.body.classList.add("custom-cursor-active"),this.game.start())}},{key:"activate",value:function(){this.init()}},{key:"destroy",value:function(){document.body.classList.remove("custom-cursor-active"),this.isActive&&this.game.stop()}},{key:"enterMagneticMode",value:function(t){this.isActive&&this.game&&"none"===this.game.magneticState&&(this.game.magneticState="entering",this.game.attachedTarget=t)}},{key:"exitMagneticMode",value:function(){this.isActive&&this.game&&("active"!==this.game.magneticState&&"entering"!==this.game.magneticState||(this.game.magneticState="exiting"))}}])}(),we={LERP_AMOUNT:.09,MAGNETIC_LERP_AMOUNT:.2,PLAYER_DEAD_ZONE_RADIUS:1,FADE_SPEED:.12,AI_STATE_CHASE_DURATION:7,AI_STATE_SCATTER_DURATION:4,AI_OBSTACLE_AVOIDANCE_FORCE:.25,PLAYER_RADIUS:16,CURSOR_DOT_RADIUS:3,MOUTH_ANIMATION_SPEED:4.5,MAX_LIVES:3,RESPAWN_DURATION:3,BOOST_DURATION:.15,BOOST_SPEED:1200,BOOST_COOLDOWN:4.5,MAX_DELTA_TIME:.1,GAME_OVER_LERP_FACTOR:2.4,SCARED_GHOST_SPAWN_INTERVAL:2.5,MAX_SCARED_GHOSTS_ON_SCREEN:5,SCARED_GHOST_LIFETIME:8,SCARED_GHOST_SPAWN_DURATION:.5,SCARED_GHOST_SPAWN_PUSH_SPEED:750,SCARED_GHOST_SPAWN_OFFSET:50,SCARED_GHOST_BASE_SPEED:120,SCARED_GHOST_WANDER_SPEED:40,SCARED_GHOST_EDGE_AVOIDANCE_MARGIN:50,SCARED_GHOST_KAMIKAZE_THRESHOLD:2.5,SCARED_GHOST_KAMIKAZE_FACTOR:3,SCARED_GHOST_EXPLOSION_RADIUS:40,HUNTER_BASE_SPEED:84,HUNTER_MAX_SPEED:228,HUNTER_SCORE_SPEED_BONUS:2500,HUNTER_ENRAGE_FACTOR:1.4,BLINKY_LUNGE_DISTANCE:100,BLINKY_LUNGE_FACTOR:1.5,BLINKY_AIM_PREDICTION:.3,PINKY_AIM_PREDICTION_DISTANCE:80,CLYDE_FEAR_DISTANCE:120,INKY_BLINKY_DEPENDENCY_DISTANCE:40,SPOOKY_MIN_DISTANCE:180,SPOOKY_FIRE_RATE:3.5,SPOOKY_ENRAGED_FIRE_RATE:2,SPOOKY_AIM_TIME:1,SPOOKY_PROJECTILE_SPEED:280,SPOOKY_SEEKING_TURN_RATE:.03,SPOOKY_DASH_SPEED:400,SPOOKY_SNIPER_SHOT_SPEED:450,SCARED_GHOST_SHAPES:[[{x:1,y:1},{x:.5,y:.75},{x:0,y:1},{x:-.5,y:.75},{x:-1,y:1}],[{x:1,y:1},{x:.33,y:.75},{x:-.33,y:1},{x:-1,y:.75}],[{x:1,y:.8},{x:0,y:1},{x:-1,y:.8}]],THEME:{wireframe:"rgba(255, 255, 255, 0.9)",boost:"rgba(0, 255, 255, 1)",magnetic:"white",cursor:"white",popupScore:"rgba(255, 255, 255, 0.9)",effects:{warpRing:"rgba(0, 255, 255, 1)"},ghosts:{blinky:"rgba(255, 100, 100, 0.9)",pinky:"rgba(255, 184, 222, 0.9)",clyde:"rgba(255, 184, 82, 0.9)",spooky:"rgba(173, 255, 47, 0.9)",inky:"rgba(0, 255, 200, 0.9)",kamikazeEnd:"rgba(255, 50, 50, 0.9)"}},DEBUG:!1};function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function Me(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Te(n.key),n)}}function Te(t){var e=function(t){if("object"!=Se(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Se(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Se(e)?e:e+""}var Ee=function(){return function(t,e){return e&&Me(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()},[{key:"reset",value:function(){this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.prevX=this.x,this.prevY=this.y,this.angle=0,this.radius=we.PLAYER_RADIUS,this.lives=we.MAX_LIVES,this.isRespawning=!1,this.respawnTimer=0,this.isBoosting=!1,this.boostTimer=0,this.boostAngle=0,this.boostCooldownTimer=0,this.mouthAnimationTimer=0}},{key:"update",value:function(t,e,i){this.prevX=this.x,this.prevY=this.y,this.isBoosting?this.updateBoost(t):this.isRespawning||this.updateNormalMovement(t,e,i),this.isRespawning?(this.respawnTimer-=t)<=0&&(this.isRespawning=!1):this.boostCooldownTimer>0&&(this.boostCooldownTimer-=t),this.mouthAnimationTimer+=t}},{key:"updateNormalMovement",value:function(t,e,i){var n=e.x,r=e.y,o=we.LERP_AMOUNT;if(i){var a=i.getBoundingClientRect();n=a.left+a.width/2,r=a.top+a.height/2,o=we.MAGNETIC_LERP_AMOUNT}var s=n-this.x,c=r-this.y,l=1-Math.exp(60*-o*t);this.x+=s*l,this.y+=c*l;var u=e.x-this.x,h=e.y-this.y;this.angle=Math.atan2(h,u)}},{key:"updateBoost",value:function(t){if((this.boostTimer-=t)<=0)this.isBoosting=!1;else{var e=we.BOOST_SPEED*t;this.x+=Math.cos(this.boostAngle)*e,this.y+=Math.sin(this.boostAngle)*e}}},{key:"startBoost",value:function(){return this.isBoosting||this.boostCooldownTimer>0||this.isRespawning?null:(this.isBoosting=!0,this.boostTimer=we.BOOST_DURATION,this.boostAngle=this.angle,this.boostCooldownTimer=we.BOOST_COOLDOWN,{type:"warpRing",x:this.x,y:this.y})}},{key:"takeDamage",value:function(){return!(!this.isRespawning&&(this.isBoosting=!1,this.lives--,this.lives<=0||(this.isRespawning=!0,this.respawnTimer=we.RESPAWN_DURATION,0)))}},{key:"isIntersecting",value:function(t){return!!this.isBoosting&&function(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,a=r*r+o*o;if(0===a)return!1;var s=Math.max(0,Math.min(1,((i.x-t.x)*r+(i.y-t.y)*o)/a)),c=t.x+s*r,l=t.y+s*o;return Math.pow(i.x-c,2)+Math.pow(i.y-l,2)<n*n}({x:this.prevX,y:this.prevY},{x:this.x,y:this.y},{x:t.x,y:t.y},(t.radius||0)+this.radius)}},{key:"draw",value:function(t,e){if(!this.isRespawning||Math.floor(10*this.respawnTimer)%2!=0){var i=1-e;i>.01&&(t.save(),t.globalAlpha=i,this.drawFollowerCircle(t),t.restore()),e>.01&&(t.save(),t.globalAlpha=e,this.drawPacman(t),this.isBoosting&&this.drawBoostTrail(t),t.restore())}}},{key:"drawPacman",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.isBoosting?Math.PI/3.5:(Math.sin(this.mouthAnimationTimer*we.MOUTH_ANIMATION_SPEED)+1)/2*(Math.PI/4)+.1;t.save(),t.globalAlpha=e.alpha||1,t.translate(e.x||this.x,e.y||this.y),t.rotate(e.angle||this.angle),t.beginPath(),t.arc(0,0,this.radius,i,-i),t.lineTo(0,0),t.closePath(),t.strokeStyle=e.color||(this.isBoosting?we.THEME.boost:we.THEME.wireframe),t.lineWidth=1.5,t.stroke(),t.restore()}},{key:"drawBoostTrail",value:function(t){for(var e=this.boostTimer/we.BOOST_DURATION,i=1;i<=3;i++){var n=i/3,r=25*n,o=this.x-Math.cos(this.boostAngle)*r,a=this.y-Math.sin(this.boostAngle)*r;this.drawPacman(t,{x:o,y:a,angle:this.boostAngle,color:we.THEME.boost,alpha:.4*(1-n)*e})}}},{key:"drawFollowerCircle",value:function(t){t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1.5,t.stroke()}}])}();function xe(t){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xe(t)}function Ae(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ke(n.key),n)}}function ke(t){var e=function(t){if("object"!=xe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=xe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xe(e)?e:e+""}var Oe=function(){return function(t,e){return e&&Ae(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.radius=n,this.isDead=!1,this.isHunter=!1},[{key:"update",value:function(t,e,i,n,r){return[]}},{key:"draw",value:function(t){}},{key:"markForRemoval",value:function(){this.isDead=!0}}])}();function Pe(t){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pe(t)}function Ce(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ie(n.key),n)}}function Ie(t){var e=function(t){if("object"!=Pe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Pe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pe(e)?e:e+""}function _e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_e=function(){return!!t})()}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},je(t)}function Re(t,e){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Re(t,e)}var Le=function(t){function e(t,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=i.x-t.x,o=i.y-t.y,a=Math.hypot(r,o),s=i.x,c=i.y,l=0,u=0;if(a>1){var h=r/a,f=o/a;s+=h*we.SCARED_GHOST_SPAWN_OFFSET,c+=f*we.SCARED_GHOST_SPAWN_OFFSET,l=h*we.SCARED_GHOST_SPAWN_PUSH_SPEED,u=f*we.SCARED_GHOST_SPAWN_PUSH_SPEED}return(n=function(t,e,i){return e=je(e),function(t,e){if(e&&("object"==Pe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_e()?Reflect.construct(e,i||[],je(t).constructor):e.apply(t,i))}(this,e,[s,c])).state="spawning",n.life=we.SCARED_GHOST_LIFETIME,n.pushVx=l,n.pushVy=u,n.spawnProgress=0,n.wanderAngle=Math.random()*Math.PI*2,n.wanderTimer=2*Math.random()+1,n.shape=we.SCARED_GHOST_SHAPES[Math.floor(Math.random()*we.SCARED_GHOST_SHAPES.length)],n.colorHue=190+80*Math.random(),n.alpha=1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Re(t,e)}(e,t),function(t,e){return e&&Ce(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"update",value:function(t,e){if(this.life-=t,"kamikaze"!==this.state&&this.life<we.SCARED_GHOST_KAMIKAZE_THRESHOLD&&"eaten"!==this.state&&(this.state="kamikaze"),"eaten"===this.state)return this.alpha-=2*t,this.alpha<=0&&this.markForRemoval(),[];if(this.life<=0)return this.markForRemoval(),[{type:"create_particles",payload:{x:this.x,y:this.y,count:25,color:we.THEME.ghosts.kamikazeEnd}},{type:"spawn_explosion",payload:{x:this.x,y:this.y}}];var i=0,n=0,r=Math.hypot(this.x-e.x,this.y-e.y);if("kamikaze"===this.state){var o=e.x-this.x,a=e.y-this.y;r>1&&(i=o/r*we.SCARED_GHOST_BASE_SPEED*we.SCARED_GHOST_KAMIKAZE_FACTOR,n=a/r*we.SCARED_GHOST_BASE_SPEED*we.SCARED_GHOST_KAMIKAZE_FACTOR)}else{if(this.wanderTimer-=t,this.wanderTimer<=0&&(this.wanderAngle=Math.random()*Math.PI*2,this.wanderTimer=2*Math.random()+1),i+=Math.cos(this.wanderAngle)*we.SCARED_GHOST_WANDER_SPEED,n+=Math.sin(this.wanderAngle)*we.SCARED_GHOST_WANDER_SPEED,"spawning"===this.state)this.spawnProgress+=t/we.SCARED_GHOST_SPAWN_DURATION,i+=this.pushVx*(1-this.spawnProgress),n+=this.pushVy*(1-this.spawnProgress),this.spawnProgress>=1&&(this.spawnProgress=1,this.state="scared");else if(r<150){var s=this.x-e.x,c=this.y-e.y;r>1&&(i+=s/r*we.SCARED_GHOST_BASE_SPEED,n+=c/r*we.SCARED_GHOST_BASE_SPEED)}var l=0,u=0,h=we.SCARED_GHOST_EDGE_AVOIDANCE_MARGIN;this.x<h?l=1:this.x>window.innerWidth-h&&(l=-1),this.y<h?u=1:this.y>window.innerHeight-h&&(u=-1),i+=l*we.SCARED_GHOST_BASE_SPEED,n+=u*we.SCARED_GHOST_BASE_SPEED}return this.x+=i*t,this.y+=n*t,[]}},{key:"onEaten",value:function(){this.state="eaten"}},{key:"draw",value:function(t){var e=this,i=void 0!==this.spawnProgress?this.spawnProgress:1;if(!(i<=0)){var n;if(t.save(),t.translate(this.x,this.y),"eaten"===this.state&&(t.globalAlpha=this.alpha),"kamikaze"===this.state){var r=Math.min(1,Math.max(0,1-this.life/we.SCARED_GHOST_KAMIKAZE_THRESHOLD)),o=this.colorHue*(1-r),a=65-20*r;n="hsla(".concat(o,", 100%, ").concat(a,"%, 0.95)"),this.life<.5&&Math.floor(20*this.life)%2==0&&(n="white")}else n="hsla(".concat(this.colorHue,", 100%, 70%, 0.9)");if(t.strokeStyle=n,t.lineWidth=1.5,t.setLineDash([3,3]),t.lineDashOffset=-performance.now()/50,t.beginPath(),t.arc(0,0,this.radius*i,Math.PI,0),this.shape.forEach(function(n){return t.lineTo(n.x*e.radius*i,n.y*e.radius*i)}),t.closePath(),t.stroke(),i>.5&&(t.beginPath(),t.arc(-this.radius*i/2.5,-this.radius*i/4,1.5*i,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.radius*i/2.5,-this.radius*i/4,1.5*i,0,2*Math.PI),t.stroke()),"kamikaze"===this.state){var s=-this.radius*i*1.6;t.save(),t.fillStyle="black",t.beginPath(),t.arc(0,s,4*i,0,2*Math.PI),t.fill(),t.strokeStyle="orange",t.lineWidth=1,t.beginPath(),t.moveTo(0+3*i,s-2*i),t.lineTo(0+8*i,s-8*i),t.stroke(),t.fillStyle="yellow",Math.floor(performance.now()/150)%2==0&&t.fillRect(0+7*i,s-9*i,2*i,2*i),t.restore()}t.restore()}}}])}(Oe);function De(t){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(t)}function Ge(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Be(n.key),n)}}function Be(t){var e=function(t){if("object"!=De(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=De(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==De(e)?e:e+""}var Ne=function(){return function(t,e){return e&&Ge(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:we.SPOOKY_PROJECTILE_SPEED;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.radius=3,this.type=r,this.isDead=!1,this.life=5,this.vx=Math.cos(n)*o,this.vy=Math.sin(n)*o,"seeking"===r&&(this.vx*=.8,this.vy*=.8),this.color="seeking"===r?we.THEME.ghosts.spooky:we.THEME.ghosts.blinky||we.THEME.wireframe},[{key:"update",value:function(t,e){if("seeking"===this.type){for(var i=e.x-this.x,n=e.y-this.y,r=Math.atan2(n,i),o=Math.atan2(this.vy,this.vx),a=r-o;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;var s=o+a*we.SPOOKY_SEEKING_TURN_RATE,c=Math.hypot(this.vx,this.vy);this.vx=Math.cos(s)*c,this.vy=Math.sin(s)*c}this.x+=this.vx*t,this.y+=this.vy*t,this.life-=t,(this.life<=0||this.x<-10||this.x>window.innerWidth+10||this.y<-10||this.y>window.innerHeight+10)&&(this.isDead=!0)}},{key:"draw",value:function(t){t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fillStyle=this.color||we.THEME.ghosts.spooky,t.fill()}},{key:"markForRemoval",value:function(){this.isDead=!0}}])}();function He(t){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(t)}function Fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function ze(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ue(n.key),n)}}function Ue(t){var e=function(t){if("object"!=He(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=He(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==He(e)?e:e+""}function We(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(We=function(){return!!t})()}function Ve(t){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ve(t)}function Ye(t,e){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ye(t,e)}var qe=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=e.getSpawnPosition(t,i),a=o.x,s=o.y,c=o.entryX,l=o.entryY;return(n=function(t,e,i){return e=Ve(e),function(t,e){if(e&&("object"==He(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,We()?Reflect.construct(e,i||[],Ve(t).constructor):e.apply(t,i))}(this,e,[a,s,r])).isHunter=!0,n.type=t,n.canvas=i,n.state="entering",n.entryPoint={x:c,y:l},n.target={x:a,y:s},n.isEnraged=!1,n.speedFactor=1,n.isAiming=!1,n.spawnTimer=0,n.lastDebug=0,n.vx=0,n.vy=0,n.scatterTarget=n.getScatterTarget(i),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ye(t,e)}(e,t),function(t,e,i){return e&&ze(t.prototype,e),i&&ze(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"getScatterTarget",value:function(t){var e=50;return"blinky"===this.type?{x:t.width-e,y:e}:"pinky"===this.type?{x:e,y:e}:"clyde"===this.type?{x:e,y:t.height-e}:"inky"===this.type?{x:t.width-e,y:t.height-e}:{x:t.width/2,y:t.height/2}}},{key:"update",value:function(t,i,n,r,o){this.spawnTimer+=t,"entering"===this.state&&this.spawnTimer>5&&(this.state="active");var a=[];if("entering"===this.state)this.target=this.entryPoint,Math.hypot(this.x-this.target.x,this.y-this.target.y)<15&&(this.state="active");else if("retreating"===this.state){var s=e.getSpawnPosition(this.type,this.canvas);this.target={x:s.x,y:s.y},Math.hypot(this.x-this.target.x,this.y-this.target.y)<15&&this.markForRemoval()}else"scatter"===n.aiState?this.target=this.scatterTarget:i&&"number"==typeof i.x?a=this.updateAI(t,i,n.mouse,n,o):(this.target=this.scatterTarget,a=[]);return this.isEnraged=!(!i||!i.isBoosting),this.moveTowardsTarget(t,n.score,r),this.enforceBounds(),a}},{key:"updateAI",value:function(t,e,i,n,r){return[]}},{key:"moveTowardsTarget",value:function(t,e,i){var n=Math.min(we.HUNTER_MAX_SPEED,we.HUNTER_BASE_SPEED+e/we.HUNTER_SCORE_SPEED_BONUS);this.isEnraged&&(n*=we.HUNTER_ENRAGE_FACTOR),n*=this.speedFactor;var r=this.target.x-this.x,o=this.target.y-this.y,a=this.calculateAvoidance(i);r+=a.x*we.AI_OBSTACLE_AVOIDANCE_FORCE,o+=a.y*we.AI_OBSTACLE_AVOIDANCE_FORCE;var s=Math.hypot(r,o);s>1&&(this.vx=r/s*n,this.vy=o/s*n,this.x+=this.vx*t,this.y+=this.vy*t)}},{key:"calculateAvoidance",value:function(t){var e={x:0,y:0};if(!t)return e;var i,n=3*this.radius,r=Math.hypot(this.vx,this.vy),o=this.x+(r>0?this.vx/r:0)*n,a=this.y+(r>0?this.vy/r:0)*n,s=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Fe(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Fe(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(o>c.left&&o<c.right&&a>c.top&&a<c.bottom){e.x=o-(c.left+c.width/2),e.y=a-(c.top+c.height/2);var l=Math.hypot(e.x,e.y);return l>0&&(e.x/=l,e.y/=l),e}}}catch(t){s.e(t)}finally{s.f()}return e}},{key:"retreat",value:function(){this.state="retreating"}},{key:"enforceBounds",value:function(){var t=20;"spooky"===this.type?(this.x<-20&&(this.x=this.canvas.width+t),this.x>this.canvas.width+t&&(this.x=-20),this.y<-20&&(this.y=this.canvas.height+t),this.y>this.canvas.height+t&&(this.y=-20)):(this.x=Math.max(t,Math.min(this.canvas.width-t,this.x)),this.y=Math.max(t,Math.min(this.canvas.height-t,this.y)))}},{key:"draw",value:function(t){this.isEnraged&&Math.floor(performance.now()/100)%2==0||(t.save(),t.translate(this.x,this.y),this.isAiming&&(t.globalAlpha=.5*Math.sin(.03*performance.now())+.5),t.strokeStyle=we.THEME.ghosts[this.type],t.lineWidth=1.5,t.beginPath(),t.arc(0,0,this.radius,Math.PI,0),t.lineTo(this.radius,this.radius),t.lineTo(this.radius/2,this.radius-this.radius/4),t.lineTo(0,this.radius),t.lineTo(-this.radius/2,this.radius-this.radius/4),t.lineTo(-this.radius,this.radius),t.closePath(),t.stroke(),this.drawEyes(t),t.restore())}},{key:"drawEyes",value:function(t){t.beginPath(),t.moveTo(-this.radius/1.5,-this.radius/3),t.lineTo(-this.radius/4,-this.radius/5),t.stroke(),t.beginPath(),t.moveTo(this.radius/1.5,-this.radius/3),t.lineTo(this.radius/4,-this.radius/5),t.stroke()}}],[{key:"getSpawnPosition",value:function(t,e){var i,n,r,o,a=Math.floor(4*Math.random());return 0===a?(i=-20,r=50,o=n=Math.random()*e.height):1===a?(i=e.width+20,n=Math.random()*e.height,r=e.width-50,o=n):2===a?(n=-20,r=i=Math.random()*e.width,o=50):(i=Math.random()*e.width,n=e.height+20,r=i,o=e.height-50),{x:i,y:n,entryX:r,entryY:o}}}])}(Oe);function Ke(t){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ke(t)}function Xe(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$e(n.key),n)}}function $e(t){var e=function(t){if("object"!=Ke(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Ke(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ke(e)?e:e+""}function Ze(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ze=function(){return!!t})()}function Je(t){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Je(t)}function Qe(t,e){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qe(t,e)}var ti=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,i){return e=Je(e),function(t,e){if(e&&("object"==Ke(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ze()?Reflect.construct(e,i||[],Je(t).constructor):e.apply(t,i))}(this,e,["blinky",t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qe(t,e)}(e,t),function(t,e){return e&&Xe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateAI",value:function(t,e,i,n,r){var o=we.BLINKY_AIM_PREDICTION,a=e.x*(1-o)+i.x*o,s=e.y*(1-o)+i.y*o;return this.target.x=a,this.target.y=s,this.speedFactor=1,Math.hypot(this.x-e.x,this.y-e.y)<we.BLINKY_LUNGE_DISTANCE&&(this.speedFactor=we.BLINKY_LUNGE_FACTOR),[]}}])}(qe);function ei(t){return ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ei(t)}function ii(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ni(n.key),n)}}function ni(t){var e=function(t){if("object"!=ei(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ei(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ei(e)?e:e+""}function ri(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ri=function(){return!!t})()}function oi(t){return oi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oi(t)}function ai(t,e){return ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ai(t,e)}var si=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,i){return e=oi(e),function(t,e){if(e&&("object"==ei(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ri()?Reflect.construct(e,i||[],oi(t).constructor):e.apply(t,i))}(this,e,["pinky",t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ai(t,e)}(e,t),function(t,e){return e&&ii(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateAI",value:function(t,e,i,n,r){return this.target.x=e.x+Math.cos(e.angle)*we.PINKY_AIM_PREDICTION_DISTANCE,this.target.y=e.y+Math.sin(e.angle)*we.PINKY_AIM_PREDICTION_DISTANCE,[]}}])}(qe);function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function li(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ui(n.key),n)}}function ui(t){var e=function(t){if("object"!=ci(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=ci(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ci(e)?e:e+""}function hi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(hi=function(){return!!t})()}function fi(t){return fi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fi(t)}function yi(t,e){return yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yi(t,e)}var di=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,i){return e=fi(e),function(t,e){if(e&&("object"==ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,hi()?Reflect.construct(e,i||[],fi(t).constructor):e.apply(t,i))}(this,e,["clyde",t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yi(t,e)}(e,t),function(t,e){return e&&li(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateAI",value:function(t,e,i,n,r){var o=Math.hypot(this.x-e.x,this.y-e.y);if(!this.isEnraged&&o<we.CLYDE_FEAR_DISTANCE)this.target.x=this.x-(e.x-this.x),this.target.y=this.y-(e.y-this.y);else{var a=we.BLINKY_AIM_PREDICTION;this.target.x=e.x*(1-a)+i.x*a,this.target.y=e.y*(1-a)+i.y*a}return[]}}])}(qe);function pi(t){return pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pi(t)}function vi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mi(n.key),n)}}function mi(t){var e=function(t){if("object"!=pi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=pi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pi(e)?e:e+""}function bi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(bi=function(){return!!t})()}function gi(t){return gi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gi(t)}function wi(t,e){return wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wi(t,e)}var Si=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,i){return e=gi(e),function(t,e){if(e&&("object"==pi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bi()?Reflect.construct(e,i||[],gi(t).constructor):e.apply(t,i))}(this,e,["inky",t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wi(t,e)}(e,t),function(t,e){return e&&vi(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateAI",value:function(t,e,i,n,r){var o=r.blinky;if(o){var a=e.x+Math.cos(e.angle)*we.INKY_BLINKY_DEPENDENCY_DISTANCE,s=e.y+Math.sin(e.angle)*we.INKY_BLINKY_DEPENDENCY_DISTANCE;this.target.x=o.x+2*(a-o.x),this.target.y=o.y+2*(s-o.y)}else{var c=we.BLINKY_AIM_PREDICTION;this.target.x=e.x*(1-c)+i.x*c,this.target.y=e.y*(1-c)+i.y*c}return[]}}])}(qe);function Mi(t){return Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mi(t)}function Ti(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ei(n.key),n)}}function Ei(t){var e=function(t){if("object"!=Mi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Mi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mi(e)?e:e+""}function xi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(xi=function(){return!!t})()}function Ai(t){return Ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ai(t)}function ki(t,e){return ki=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ki(t,e)}var Oi=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e,i){return e=Ai(e),function(t,e){if(e&&("object"==Mi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xi()?Reflect.construct(e,i||[],Ai(t).constructor):e.apply(t,i))}(this,e,["spooky",t])).fireTimer=we.SPOOKY_FIRE_RATE+2*Math.random(),i.strafeDirection=Math.random()>.5?1:-1,i.strafeTimer=2+3*Math.random(),i.isAiming=!1,i.frenzyState=null,i.burstsLeft=0,i.isBursting=!1,i.aimTimer=0,i.dashTarget=null,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ki(t,e)}(e,t),function(t,e){return e&&Ti(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"updateAI",value:function(t,e,i,n,r){var o=[],a=e.x-this.x,s=e.y-this.y,c=Math.hypot(a,s);if(this.isEnraged){this.frenzyState||(this.frenzyState="dashing",this.dashTarget=null);var l=1;switch(this.frenzyState){case"dashing":if(!this.dashTarget){var u=Math.atan2(s,a)+Math.PI/2*(Math.random()>.5?1:-1);this.dashTarget={x:this.x+150*Math.cos(u),y:this.y+150*Math.sin(u)}}this.target=this.dashTarget,l=we.SPOOKY_DASH_SPEED/we.HUNTER_BASE_SPEED,Math.hypot(this.x-this.dashTarget.x,this.y-this.dashTarget.y)<20&&(this.frenzyState="aiming",this.aimTimer=.25);break;case"aiming":if(this.aimTimer-=t,this.aimTimer<=0){var h=Math.atan2(s,a);o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:h,type:"seeking",speed:we.SPOOKY_SNIPER_SHOT_SPEED}}),this.frenzyState="cooldown",this.fireTimer=we.SPOOKY_ENRAGED_FIRE_RATE}break;case"cooldown":this.fireTimer-=t,this.fireTimer<=0&&(this.frenzyState="dashing",this.dashTarget=null)}return this.speedFactor=l,o}this.frenzyState&&(this.frenzyState=null,this.dashTarget=null),this.fireTimer-=t,this.strafeTimer-=t,this.strafeTimer<=0&&(this.strafeDirection*=-1,this.strafeTimer=3+4*Math.random());var f=c>1?a/c:0,y=c>1?s/c:0,d=e.x-f*we.SPOOKY_MIN_DISTANCE,p=e.y-y*we.SPOOKY_MIN_DISTANCE;if(this.target={x:d+-y*this.strafeDirection*40,y:p+f*this.strafeDirection*40},c<we.SPOOKY_MIN_DISTANCE-20&&(this.target.x=this.x-a,this.target.y=this.y-s),this.speedFactor=.85,this.isBursting){if(this.fireTimer<=0){var v=Math.atan2(s,a);o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:v}}),this.burstsLeft--,this.burstsLeft<=0?(this.isBursting=!1,this.fireTimer=we.SPOOKY_FIRE_RATE+Math.random()):this.fireTimer=.1}}else if(this.fireTimer<=0){if(this.isAiming=!0,this.fireTimer<-we.SPOOKY_AIM_TIME){var m=["spread","burst","seeking"][Math.floor(3*Math.random())],b=Math.atan2(s,a);switch(m){case"spread":o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:b-.2}}),o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:b}}),o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:b+.2}});break;case"burst":o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:b}}),this.isBursting=!0,this.burstsLeft=2,this.fireTimer=.1;break;case"seeking":o.push({type:"spawn_projectile",payload:{x:this.x,y:this.y,angle:b,type:"seeking"}})}this.isBursting||(this.fireTimer=we.SPOOKY_FIRE_RATE+Math.random()),this.isAiming=!1}}else this.isAiming=!1;return o}},{key:"drawEyes",value:function(t){t.beginPath(),t.arc(0,-this.radius/4,this.radius/3,0,2*Math.PI),t.stroke()}}])}(qe);function Pi(t,e,i){return e=_i(e),function(t,e){if(e&&("object"==Li(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ci()?Reflect.construct(e,i||[],_i(t).constructor):e.apply(t,i))}function Ci(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ci=function(){return!!t})()}function Ii(){return Ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=_i(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},Ii.apply(null,arguments)}function _i(t){return _i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_i(t)}function ji(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ri(t,e)}function Ri(t,e){return Ri=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ri(t,e)}function Li(t){return Li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Li(t)}function Di(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ni(n.key),n)}}function Bi(t,e,i){return e&&Gi(t.prototype,e),i&&Gi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ni(t){var e=function(t){if("object"!=Li(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Li(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Li(e)?e:e+""}var Hi=function(){return Bi(function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;Di(this,t),this.x=e,this.y=i,this.life=n,this.maxLife=n,this.isDead=!1},[{key:"update",value:function(t){this.life-=t,this.life<=0&&(this.isDead=!0)}},{key:"draw",value:function(t){}}])}(),Fi=function(t){function e(t,i,n){var r;Di(this,e),r=Pi(this,e,[t,i,.5*Math.random()+.25]);var o=Math.random()*Math.PI*2,a=120*Math.random()+60;return r.vx=Math.cos(o)*a,r.vy=Math.sin(o)*a,r.radius=1.5*Math.random()+.5,r.color=n,r}return ji(e,t),Bi(e,[{key:"update",value:function(t){!function(t,e,i){var n=Ii(_i(t.prototype),"update",i);return"function"==typeof n?function(t){return n.apply(i,t)}:n}(e,0,this)([t]),this.x+=this.vx*t,this.y+=this.vy*t}},{key:"draw",value:function(t){t.save();var e=this.life/this.maxLife;t.globalAlpha=e,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fillStyle=this.color||"rgba(255, 255, 255, 1)",t.fill(),t.restore()}}])}(Hi),zi=function(t){function e(t,i){return Di(this,e),Pi(this,e,[t,i,.4])}return ji(e,t),Bi(e,[{key:"draw",value:function(t){var e=1-this.life/this.maxLife,i=80*Math.pow(e,.5),n=1-e,r=3*n;t.save(),t.beginPath(),t.arc(this.x,this.y,i,0,2*Math.PI),t.strokeStyle="rgba(0, 255, 255, ".concat(n,")"),t.lineWidth=r,t.stroke(),t.restore()}}])}(Hi);function Ui(t){return Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ui(t)}function Wi(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Yi(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function Vi(t){return function(t){if(Array.isArray(t))return qi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Yi(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yi(t,e){if(t){if("string"==typeof t)return qi(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?qi(t,e):void 0}}function qi(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Ki(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Xi(n.key),n)}}function Xi(t){var e=function(t){if("object"!=Ui(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Ui(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ui(e)?e:e+""}var $i=function(){return function(t,e){return e&&Ki(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.reset()},[{key:"hunterCount",get:function(){return this.hunters.length}},{key:"getCollidableEntities",value:function(){return{hunters:this.hunters,scaredGhosts:this.scaredGhosts,projectiles:this.projectiles}}},{key:"add",value:function(t){this.entities.push(t),t.isHunter&&this.hunters.push(t),t instanceof Le&&this.scaredGhosts.push(t),t instanceof Ne&&this.projectiles.push(t)}},{key:"update",value:function(t,e,i,n){for(var r=[],o=this.hunters.find(function(t){return"blinky"===t.type}),a=this.entities.length-1;a>=0;a--){var s=this.entities[a],c=s.update(t,e,i,n,{blinky:o});if(c&&c.length>0&&r.push.apply(r,Vi(c)),s.isDead){var l=this.entities.splice(a,1)[0];if(l.isHunter){var u=this.hunters.indexOf(l);u>=0&&this.hunters.splice(u,1)}if(l instanceof Le){var h=this.scaredGhosts.indexOf(l);h>=0&&this.scaredGhosts.splice(h,1)}if(l instanceof Ne){var f=this.projectiles.indexOf(l);f>=0&&this.projectiles.splice(f,1)}}}return r}},{key:"draw",value:function(t){var e,i=Wi(this.entities);try{for(i.s();!(e=i.n()).done;)e.value.draw(t)}catch(t){i.e(t)}finally{i.f()}}},{key:"addEffect",value:function(t){"warpRing"===t.type&&this.add(new zi(t.x,t.y))}},{key:"spawnScaredGhost",value:function(t,e,i){this.scaredGhostSpawnTimer=this.scaredGhostSpawnTimer||0;var n=Math.hypot(i.x-e.x,i.y-e.y);this.scaredGhosts.length<we.MAX_SCARED_GHOSTS_ON_SCREEN&&n>2&&(this.scaredGhostSpawnTimer+=t)>we.SCARED_GHOST_SPAWN_INTERVAL&&(this.scaredGhostSpawnTimer=0,this.add(new Le(e,i)))}},{key:"spawnHunter",value:function(t){var e={blinky:ti,pinky:si,clyde:di,inky:Si,spooky:Oi}[t&&t.toLowerCase()];"function"==typeof e&&this.add(new e(this.canvas))}},{key:"fireProjectile",value:function(t){this.add(new Ne(t.x,t.y,t.angle,t.type,t.speed))}},{key:"createParticles",value:function(t,e,i,n){var r,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=0,s=Wi(this.entities);try{for(s.s();!(r=s.n()).done;)r.value instanceof Fi&&a++}catch(t){s.e(t)}finally{s.f()}for(var c=0;c<i&&(o||!(a>=300));c++)this.add(new Fi(t,e,n)),a++}},{key:"clearScaredGhosts",value:function(){var t,e=Vi(this.scaredGhosts),i=Wi(e);try{for(i.s();!(t=i.n()).done;)t.value.markForRemoval()}catch(t){i.e(t)}finally{i.f()}return e}},{key:"retreatAllHunters",value:function(){this.hunters.forEach(function(t){return t.retreat()})}},{key:"reset",value:function(){this.entities=[],this.hunters=[],this.scaredGhosts=[],this.projectiles=[],this.scaredGhostSpawnTimer=0}}])}();function Zi(t){return Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zi(t)}function Ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Qi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tn(n.key),n)}}function tn(t){var e=function(t){if("object"!=Zi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Zi(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zi(e)?e:e+""}var en=function(){return function(t,e){return e&&Qi(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.waveConfig=[{count:1,types:["blinky"]},{count:2,types:["blinky","pinky"]},{count:3,types:["blinky","pinky","clyde"]},{count:3,types:["blinky","pinky","inky"]},{count:4,types:["blinky","pinky","clyde","spooky"]},{count:4,types:["blinky","pinky","inky","spooky"]},{count:5,types:["blinky","pinky","clyde","inky","spooky"]}]},[{key:"getWave",value:function(t){for(var e=Math.min(t-1,this.waveConfig.length-1),i=this.waveConfig[e],n=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}(function(t){return function(t){if(Array.isArray(t))return Ji(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ji(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ji(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(i.types)),r=[],o=0;o<i.count;o++)r.push(n[o%n.length]);return r}}])}();function nn(t){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(t)}function rn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,on(n.key),n)}}function on(t){var e=function(t){if("object"!=nn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=nn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nn(e)?e:e+""}var an=function(){return function(t,e){return e&&rn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scores=[]},[{key:"reset",value:function(){this.scores=[]}},{key:"update",value:function(t){this.scores.forEach(function(e){return e.y-=30*t}),this.scores=this.scores.filter(function(e){return(e.life-=t)>0})}},{key:"draw",value:function(t,e,i,n,r){r>.01&&(this.ctx.save(),this.ctx.globalAlpha=r,this.drawHUD(t,e),this.drawScores(),this.ctx.restore()),t.isGameOver&&this.drawGameOver(e),this.drawCursorDot(i,n)}},{key:"drawHUD",value:function(t,e){this.ctx.font="bold 14px 'Share Tech Mono', monospace",this.ctx.fillStyle="white",this.ctx.textAlign="right";var i=e.x+95,n=e.y+-5,r=Math.max(20,Math.min(i,this.ctx.canvas.width-20)),o=Math.max(60,Math.min(n,this.ctx.canvas.height-20));this.ctx.fillText("SCORE: ".concat(t.score),r,o),this.ctx.fillText("WAVE: ".concat(t.wave),r,o-20);var a="● ".repeat(e.lives),s=this.ctx.measureText(a).width;this.ctx.fillText(a,r,o+20),this.drawBoostIndicator(r-s-20,o+15,e)}},{key:"drawBoostIndicator",value:function(t,e,i){if(this.ctx.beginPath(),this.ctx.arc(t,e,7,0,2*Math.PI),this.ctx.strokeStyle=i.boostCooldownTimer>0?"rgba(255, 255, 255, 0.3)":we.THEME.boost,this.ctx.lineWidth=1.5,this.ctx.stroke(),i.boostCooldownTimer>0){var n=1-i.boostCooldownTimer/we.BOOST_COOLDOWN;this.ctx.beginPath(),this.ctx.arc(t,e,7,-Math.PI/2,-Math.PI/2+2*Math.PI*n),this.ctx.strokeStyle=we.THEME.boost,this.ctx.lineWidth=2.5,this.ctx.stroke()}}},{key:"drawScores",value:function(){var t=this;this.scores.forEach(function(e){var i=Math.min(1,e.life/e.maxLife);t.ctx.font="bold ".concat(e.size||14,"px 'Share Tech Mono', monospace"),t.ctx.fillStyle="rgba(255, 255, 255, ".concat(i,")"),t.ctx.textAlign="center",t.ctx.fillText(e.text,e.x,e.y)})}},{key:"drawGameOver",value:function(t){this.ctx.font="bold 24px 'Share Tech Mono', monospace",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",t.x,t.y-20),this.ctx.font="16px 'Share Tech Mono', monospace",this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.ctx.fillText("(Click to Restart)",t.x,t.y+10)}},{key:"drawCursorDot",value:function(t,e){t&&(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,we.CURSOR_DOT_RADIUS,0,2*Math.PI),this.ctx.fillStyle=we.THEME.cursor,this.ctx.fill(),e&&(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,4*we.CURSOR_DOT_RADIUS,0,2*Math.PI),this.ctx.strokeStyle="rgba(255, 255, 255, ".concat(.5*Math.sin(.01*performance.now())+.5,")"),this.ctx.lineWidth=2,this.ctx.stroke()))}},{key:"addScorePopup",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14;this.scores.push({x:t,y:e,text:i,life:n,maxLife:n,size:r})}}])}();function sn(t){return sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sn(t)}function cn(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return ln(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ln(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function ln(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function un(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,hn(n.key),n)}}function hn(t){var e=function(t){if("object"!=sn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=sn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==sn(e)?e:e+""}var fn=function(){return function(t,e){return e&&un(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},[{key:"check",value:function(t,e){var i,n=[],r=e.getCollidableEntities(),o=r.hunters,a=r.scaredGhosts,s=r.projectiles,c=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.hypot(i,n)<(t.radius||0)+(e.radius||0)},l=cn(a);try{for(l.s();!(i=l.n()).done;){var u=i.value;c(t,u)&&("kamikaze"===u.state?n.push({type:"player_hit_hunter",enemy:u}):n.push({type:"player_eats_scared_ghost",enemy:u}))}}catch(t){l.e(t)}finally{l.f()}var h=new Set;if(t.isBoosting){var f,y=cn(o);try{for(y.s();!(f=y.n()).done;){var d=f.value;t.isIntersecting(d)&&(n.push({type:"boost_hit_hunter",enemy:d}),h.add(d))}}catch(t){y.e(t)}finally{y.f()}}if(!t.isRespawning){var p,v=cn(o);try{for(v.s();!(p=v.n()).done;){var m=p.value;h.has(m)||c(t,m)&&n.push({type:"player_hit_hunter",enemy:m})}}catch(t){v.e(t)}finally{v.f()}}if(!t.isRespawning){var b,g=cn(s);try{for(g.s();!(b=g.n()).done;){var w=b.value;c(t,w)&&(n.push({type:"player_hit_projectile",enemy:w}),w.markForRemoval())}}catch(t){g.e(t)}finally{g.f()}}return n}}])}();function yn(t){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn(t)}function dn(t){return function(t){if(Array.isArray(t))return mn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||vn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pn(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=vn(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function vn(t,e){if(t){if("string"==typeof t)return mn(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mn(t,e):void 0}}function mn(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function bn(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function gn(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?bn(Object(i),!0).forEach(function(e){wn(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bn(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function wn(t,e,i){return(e=Mn(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Sn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Mn(n.key),n)}}function Mn(t){var e=function(t){if("object"!=yn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=yn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yn(e)?e:e+""}var Tn=function(){return function(t,e){return e&&Sn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas&&window.matchMedia("(pointer: fine)").matches?(this.ctx=this.canvas.getContext("2d"),this.isActive=!0,this.animationFrameId=null,this.gameState={},this.globalAlpha=0,this.mouse={x:window.innerWidth/2,y:window.innerHeight/2},this.magneticTarget=null,this.isHoveringPowerUp=!1,this.isMouseDown=!1,this.bounceBoundaries=[],this.player=new Ee,this.entityManager=new $i(this.canvas),this.waveManager=new en,this.uiManager=new an(this.ctx),this.collisionManager=new fn,this.animate=this.animate.bind(this)):this.isActive=!1},[{key:"start",value:function(){this.isActive&&(this.resizeCanvas(),this.addEventListeners(),this.resetGame(),this.animationFrameId=requestAnimationFrame(this.animate))}},{key:"stop",value:function(){this.isActive&&(this.isActive=!1,cancelAnimationFrame(this.animationFrameId),this.gameState.waveTransitionTimer&&clearTimeout(this.gameState.waveTransitionTimer),this.removeEventListeners())}},{key:"resetGame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||(this.player.reset(),this.uiManager.reset()),this.gameState=gn(gn({},this.gameState),{},{lastTime:performance.now(),isGameOver:!1,isGameActive:!1,score:t?this.gameState.score:0,wave:t?this.gameState.wave:0,isWaveTransition:!1,waveTransitionTimer:null,shake:{intensity:0,duration:0},aiState:"scatter",aiStateTimer:we.AI_STATE_SCATTER_DURATION}),this.entityManager.reset(),t&&this.startNextWave()}},{key:"addEventListeners",value:function(){var t=this;this.handleResize=se(function(){return t.resizeCanvas()},250),this.handleScroll=se(function(){return t.handleScrollReset()},100),this.handleMouseMove=function(e){t.mouse.x=e.clientX,t.mouse.y=e.clientY},this.handleClick=function(){t.gameState.isGameOver&&t.resetGame()},this.handleMouseDown=function(e){e.preventDefault(),0===e.button&&(t.isMouseDown=!0)},this.handleMouseUp=function(e){0===e.button&&(t.isMouseDown=!1)},this.handleMouseOver=function(e){e.target.closest(".pacman-powerup")&&(t.isHoveringPowerUp=!0)},this.handleMouseOut=function(e){e.target.closest(".pacman-powerup")&&(t.isHoveringPowerUp=!1)},_.A.on("global:resize",this.handleResize),_.A.on("global:scroll",this.handleScroll),_.A.on("global:mousemove",this.handleMouseMove),_.A.on("global:click",this.handleClick),_.A.on("global:mousedown",this.handleMouseDown),_.A.on("global:mouseup",this.handleMouseUp),document.addEventListener("mouseover",this.handleMouseOver),document.addEventListener("mouseout",this.handleMouseOut)}},{key:"removeEventListeners",value:function(){_.A.off("global:resize",this.handleResize),_.A.off("global:scroll",this.handleScroll),_.A.off("global:mousemove",this.handleMouseMove),_.A.off("global:click",this.handleClick),_.A.off("global:mousedown",this.handleMouseDown),_.A.off("global:mouseup",this.handleMouseUp),document.removeEventListener("mouseover",this.handleMouseOver),document.removeEventListener("mouseout",this.handleMouseOut)}},{key:"handleScrollReset",value:function(){this.resetGame(!0)}},{key:"setBounceBoundaries",value:function(t){var e=this;this.bounceBoundaries=[],document.querySelectorAll(t).forEach(function(t){return e.bounceBoundaries.push(t.getBoundingClientRect())})}},{key:"resizeCanvas",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.setBounceBoundaries(".interactive-bounce")}},{key:"animate",value:function(t){if(this.isActive){this.animationFrameId=requestAnimationFrame(this.animate);var e=(t-(this.gameState.lastTime||t))/1e3;e>we.MAX_DELTA_TIME&&(e=we.MAX_DELTA_TIME),this.gameState.lastTime=t,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(e),this.draw()}}},{key:"update",value:function(t){var e=this,i=this.gameState.isGameActive,n=Math.hypot(this.mouse.x-this.player.x,this.mouse.y-this.player.y);this.magneticTarget?this.gameState.isGameActive=!0:this.gameState.isGameOver?this.gameState.isGameActive=!1:this.gameState.isGameActive=n>this.player.radius;var r=this.gameState.isGameActive?1:0;if(this.globalAlpha+=(r-this.globalAlpha)*we.FADE_SPEED,this.gameState.aiStateTimer-=t,this.gameState.aiStateTimer<=0&&("chase"===this.gameState.aiState?(this.gameState.aiState="scatter",this.gameState.aiStateTimer=we.AI_STATE_SCATTER_DURATION):(this.gameState.aiState="chase",this.gameState.aiStateTimer=we.AI_STATE_CHASE_DURATION)),this.uiManager&&"function"==typeof this.uiManager.update&&this.uiManager.update(t),this.gameState.isGameActive&&!i&&(0!==this.entityManager.hunterCount||this.gameState.isWaveTransition||this.startNextWave()),this.player.update(t,this.mouse,this.magneticTarget),this.isMouseDown&&this.gameState.isGameActive){var o=this.player.startBoost();o&&this.entityManager.addEffect(o)}if(!(this.globalAlpha<.01)){this.gameState.mouse={x:this.mouse.x,y:this.mouse.y};var a=this.entityManager.update(t,this.player,this.gameState,this.bounceBoundaries);this.processEntityActions(a),this.handleCollisions(),this.gameState.isGameActive&&!this.player.isRespawning&&(this.handlePowerUpCollection(),this.entityManager.spawnScaredGhost(t,this.player,this.mouse),0!==this.entityManager.hunterCount||this.gameState.isWaveTransition||(this.gameState.isWaveTransition=!0,this.gameState.waveTransitionTimer=setTimeout(function(){return e.startNextWave()},2e3)))}}},{key:"draw",value:function(){this.ctx.save(),this.applyShake(),this.ctx.globalAlpha=this.globalAlpha,this.entityManager.draw(this.ctx),this.player.draw(this.ctx,this.globalAlpha),this.ctx.globalAlpha=1,this.uiManager.draw(this.gameState,this.player,this.mouse,this.isHoveringPowerUp,this.globalAlpha),this.ctx.restore()}},{key:"processEntityActions",value:function(t){var e=this;t&&t.length&&t.forEach(function(t){if("spawn_projectile"===t.type)e.entityManager.fireProjectile(t.payload);else if("create_particles"===t.type)e.entityManager.createParticles(t.payload.x,t.payload.y,t.payload.count,t.payload.color);else if("spawn_explosion"===t.type){var i=t.payload||{},n=i.x,r=i.y,o=i.radius;e.entityManager.createParticles(n,r,30,we.THEME.ghosts.kamikazeEnd);var a=o||we.SCARED_GHOST_EXPLOSION_RADIUS;e.player&&Math.hypot(e.player.x-n,e.player.y-r)<a&&e.handlePlayerHit()}})}},{key:"startNextWave",value:function(){var t=this;this.gameState.isGameOver||(this.gameState.wave++,this.gameState.isWaveTransition=!1,this.gameState.waveTransitionTimer=null,this.waveManager.getWave(this.gameState.wave).forEach(function(e){return t.entityManager.spawnHunter(e)}),this.uiManager.addScorePopup(this.canvas.width/2,this.canvas.height/2,"WAVE ".concat(this.gameState.wave),2))}},{key:"handlePowerUpCollection",value:function(){var t=this,e=Math.hypot(this.mouse.x-this.player.x,this.mouse.y-this.player.y);this.isHoveringPowerUp&&e<this.player.radius&&(this.entityManager.clearScaredGhosts().forEach(function(e){t.gameState.score+=300,t.uiManager.addScorePopup(e.x,e.y,"+300"),t.entityManager.createParticles(e.x,e.y,15)}),this.isHoveringPowerUp=!1)}},{key:"handleCollisions",value:function(){var t,e=!1,i=pn(this.collisionManager.check(this.player,this.entityManager));try{for(i.s();!(t=i.n()).done;){var n=t.value;"player_eats_scared_ghost"===n.type?(n.enemy.onEaten(),this.gameState.score+=100,this.uiManager.addScorePopup(n.enemy.x,n.enemy.y,"+100"),this.entityManager.createParticles(n.enemy.x,n.enemy.y,10)):"boost_hit_hunter"===n.type?n.enemy&&(n.enemy.markForRemoval(),this.gameState.score+=500,this.uiManager.addScorePopup(n.enemy.x,n.enemy.y,"+500"),this.entityManager.createParticles(n.enemy.x,n.enemy.y,40),this.triggerShake(15,15)):"player_hit_hunter"!==n.type&&"player_hit_projectile"!==n.type||(e||(this.handlePlayerHit(),e=!0),n.enemy&&n.enemy.markForRemoval())}}catch(t){i.e(t)}finally{i.f()}}},{key:"handlePlayerHit",value:function(){var t=this;if(!this.player.isRespawning)if(this.triggerShake(30,30),this.entityManager.createParticles(this.player.x,this.player.y,40,null,!0),this.player.takeDamage())this.entityManager.retreatAllHunters();else{var e,i=Array.isArray(this.entityManager.hunters)?dn(this.entityManager.hunters):[],n=Array.isArray(this.entityManager.scaredGhosts)?dn(this.entityManager.scaredGhosts):[],r=pn(i);try{for(r.s();!(e=r.n()).done;){var o=e.value;o&&"number"==typeof o.x&&"number"==typeof o.y&&(this.entityManager.createParticles(o.x,o.y,25,we.THEME.ghosts.kamikazeEnd,!0),"function"==typeof o.markForRemoval&&o.markForRemoval())}}catch(t){r.e(t)}finally{r.f()}var a,s=pn(n);try{for(s.s();!(a=s.n()).done;){var c=a.value;c&&"number"==typeof c.x&&"number"==typeof c.y&&(this.entityManager.createParticles(c.x,c.y,25,we.THEME.ghosts.kamikazeEnd,!0),"function"==typeof c.markForRemoval&&c.markForRemoval())}}catch(t){s.e(t)}finally{s.f()}var l,u=pn(Array.isArray(this.entityManager.projectiles)?dn(this.entityManager.projectiles):[]);try{for(u.s();!(l=u.n()).done;){var h=l.value;h&&"function"==typeof h.markForRemoval&&h.markForRemoval()}}catch(t){u.e(t)}finally{u.f()}this.entityManager.update(0,this.player,this.gameState,this.bounceBoundaries),this.player.reset(),this.uiManager.reset(),this.gameState.isWaveTransition=!0,this.gameState.waveTransitionTimer&&clearTimeout(this.gameState.waveTransitionTimer),this.gameState.waveTransitionTimer=setTimeout(function(){t.gameState.isWaveTransition=!1;var e=Math.max(1,t.gameState.wave||1);t.waveManager.getWave(e).forEach(function(e){return t.entityManager.spawnHunter(e)}),t.uiManager.addScorePopup(t.canvas.width/2,t.canvas.height/2,"WAVE ".concat(t.gameState.wave),2)},500)}}},{key:"setMagneticTarget",value:function(t){this.magneticTarget=t}},{key:"clearMagneticTarget",value:function(t){this.magneticTarget===t&&(this.magneticTarget=null)}},{key:"triggerShake",value:function(t,e){this.gameState.shake.intensity=Math.max(this.gameState.shake.intensity,t),this.gameState.shake.duration=Math.max(this.gameState.shake.duration,e)}},{key:"applyShake",value:function(){if(this.gameState.shake.duration>0){this.gameState.shake.duration--;var t=(Math.random()-.5)*this.gameState.shake.intensity,e=(Math.random()-.5)*this.gameState.shake.intensity;this.ctx.translate(t,e)}}}])}();function En(t){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},En(t)}function xn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,An(n.key),n)}}function An(t){var e=function(t){if("object"!=En(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=En(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==En(e)?e:e+""}var kn=function(){return function(t,e){return e&&xn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas)try{this.game=new Tn(e),this.state={isActive:this.game.isActive}}catch(t){console.error("Errore fatale durante l'inizializzazione di PacmanGame:",t),this.game=null,this.state={isActive:!1}}else this.state={isActive:!1}},[{key:"init",value:function(){this.state.isActive&&this.game&&(document.body.classList.add("js-pacman-cursor-active"),this.game.start())}},{key:"destroy",value:function(){this.state.isActive&&this.game&&(document.body.classList.remove("js-pacman-cursor-active"),this.game.stop())}},{key:"enterMagneticMode",value:function(t){this.state.isActive&&this.game&&(this.game.setMagneticTarget(t),t.classList.add("is-magnet-locked"))}},{key:"exitMagneticMode",value:function(t){this.state.isActive&&this.game&&(this.game.clearMagneticTarget(t),t&&t.classList.remove("is-magnet-locked"))}}])}();function On(t){return On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},On(t)}function Pn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Cn(n.key),n)}}function Cn(t){var e=function(t){if("object"!=On(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=On(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==On(e)?e:e+""}var In=function(){return function(t,e){return e&&Pn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.isActive=!0,this.isRunning=!1,this.animationId=null,this.fontSize=14,this.columns=0,this.drops=[],this.matrixChars="01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()",this.cursor={x:0,y:0,trail:[],maxTrail:20},this.magneticTarget=null,this.initCanvas(),this.setupEventListeners()):this.isActive=!1},[{key:"initCanvas",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.columns=Math.floor(this.canvas.width/this.fontSize),this.drops=new Array(this.columns).fill(1)}},{key:"setupEventListeners",value:function(){var t=this;document.addEventListener("mousemove",function(e){if(!t.magneticTarget){var i=t.canvas.getBoundingClientRect();t.cursor.x=e.clientX-i.left,t.cursor.y=e.clientY-i.top,t.cursor.trail.push({x:t.cursor.x,y:t.cursor.y,life:1}),t.cursor.trail.length>t.cursor.maxTrail&&t.cursor.trail.shift()}}),window.addEventListener("resize",function(){t.initCanvas()})}},{key:"start",value:function(){this.isRunning||(this.isRunning=!0,this.animate())}},{key:"stop",value:function(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}},{key:"animate",value:function(){var t=this;this.isRunning&&(this.update(),this.draw(),this.animationId=requestAnimationFrame(function(){return t.animate()}))}},{key:"update",value:function(){for(var t=this,e=0;e<this.drops.length;e++)this.drops[e]*this.fontSize>this.canvas.height&&Math.random()>.975&&(this.drops[e]=0),this.drops[e]++;if(this.cursor.trail.forEach(function(e,i){e.life-=.02,e.life<=0&&t.cursor.trail.splice(i,1)}),this.magneticTarget){var i=this.magneticTarget.getBoundingClientRect(),n=this.canvas.getBoundingClientRect();this.cursor.x=i.left+i.width/2-n.left,this.cursor.y=i.top+i.height/2-n.top}}},{key:"draw",value:function(){var t=this;this.ctx.fillStyle="rgba(13, 17, 23, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#39ff14",this.ctx.font=this.fontSize+"px monospace";for(var e=0;e<this.drops.length;e++){var i=this.matrixChars[Math.floor(Math.random()*this.matrixChars.length)],n=Math.abs(e*this.fontSize-this.cursor.x),r=Math.max(.1,1-n/(this.canvas.width/2));this.ctx.globalAlpha=r,this.ctx.fillText(i,e*this.fontSize,this.drops[e]*this.fontSize)}this.ctx.globalAlpha=1,this.cursor.trail.forEach(function(e,i){var n=e.life,r=t.fontSize*(.5+.5*e.life);t.ctx.globalAlpha=n,t.ctx.fillStyle="#39ff14",t.ctx.font=r+"px monospace";var o=Math.random()>.7?"█":Math.random()>.7?"▓":"▒";t.ctx.fillText(o,e.x-r/2,e.y+r/2)}),this.ctx.globalAlpha=1,this.ctx.fillStyle="#ffffff",this.ctx.font=1.5*this.fontSize+"px monospace",this.ctx.fillText("█",this.cursor.x-.75*this.fontSize,this.cursor.y+.75*this.fontSize),this.ctx.shadowColor="#39ff14",this.ctx.shadowBlur=10,this.ctx.fillStyle="#39ff14",this.ctx.fillText("█",this.cursor.x-.75*this.fontSize,this.cursor.y+.75*this.fontSize),this.ctx.shadowBlur=0}},{key:"setMagneticTarget",value:function(t){this.magneticTarget=t}},{key:"clearMagneticTarget",value:function(t){this.magneticTarget===t&&(this.magneticTarget=null)}}])}();function _n(t){return _n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_n(t)}function jn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rn(n.key),n)}}function Rn(t){var e=function(t){if("object"!=_n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=_n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_n(e)?e:e+""}var Ln=function(){return function(t,e){return e&&jn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas)try{this.game=new In(e),this.isActive=this.game.isActive}catch(t){console.error("Errore fatale durante l'inizializzazione di GlitchGame:",t),this.game=null,this.isActive=!1}else this.isActive=!1},[{key:"init",value:function(){this.isActive&&this.game&&(document.body.classList.add("glitch-cursor-active"),this.game.start())}},{key:"destroy",value:function(){this.isActive&&this.game&&(document.body.classList.remove("glitch-cursor-active"),this.game.stop())}},{key:"enterMagneticMode",value:function(t){this.isActive&&this.game&&(this.game.setMagneticTarget(t),t.classList.add("is-magnet-locked"))}},{key:"exitMagneticMode",value:function(t){this.isActive&&this.game&&(this.game.clearMagneticTarget(t),t&&t.classList.remove("is-magnet-locked"))}}])}();function Dn(t){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dn(t)}function Gn(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Bn(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Bn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function Bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Nn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Hn(n.key),n)}}function Hn(t){var e=function(t){if("object"!=Dn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Dn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dn(e)?e:e+""}var Fn=function(){return function(t,e){return e&&Nn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas?(this.ctx=this.canvas.getContext("2d"),this.isActive=!0,this.isRunning=!1,this.animationId=null,this.cursor={x:window.innerWidth/2,y:window.innerHeight/2},this.aura={x:window.innerWidth/2,y:window.innerHeight/2},this.auraDelay=.6,this.magneticTarget=null,this.isInMagneticMode=!1,this.magneticRadius=60,this.magneticExitRadius=80,this.magneticElements=[],this.lastMagneticCheck=0,this.magneticOpacity=0,this.auraOpacity=1,this.resizeHandler=function(){i.initCanvas(),i.updateMagneticElements()},this.mouseHandler=function(t){return i.onMouseMove(t)},this.initCanvas(),this.initMagneticElements(),window.addEventListener("resize",this.resizeHandler),document.addEventListener("mousemove",this.mouseHandler)):this.isActive=!1},[{key:"initCanvas",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px"}},{key:"initMagneticElements",value:function(){this.magneticElements=Array.from(document.querySelectorAll('button, a, [role="button"], .nav-link, .interactive-bounce, .magnetic-target, input[type="submit"], input[type="button"], nav a, .navbar a')).filter(function(t){if(t.closest("#chimera-navbar"))return!1;var e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&t.offsetWidth>0&&t.offsetHeight>0&&t.getBoundingClientRect().width>0&&t.getBoundingClientRect().height>0})}},{key:"updateMagneticElements",value:function(){this.initMagneticElements()}},{key:"onMouseMove",value:function(t){var e=this.canvas.getBoundingClientRect();this.cursor.x=t.clientX-e.left,this.cursor.y=t.clientY-e.top;var i=Date.now();if(!(i-this.lastMagneticCheck<16)){this.lastMagneticCheck=i;var n,r=t.clientX,o=t.clientY,a=null,s=this.isInMagneticMode?this.magneticExitRadius:this.magneticRadius,c=Gn(this.magneticElements);try{for(c.s();!(n=c.n()).done;){var l=n.value,u=l.getBoundingClientRect(),h=u.left+u.width/2,f=u.top+u.height/2,y=Math.sqrt(Math.pow(r-h,2)+Math.pow(o-f,2));if(y<s)if(this.isInMagneticMode&&this.magneticTarget){var d=this.magneticTarget.getBoundingClientRect(),p=d.left+d.width/2,v=d.top+d.height/2;y<Math.sqrt(Math.pow(r-p,2)+Math.pow(o-v,2))-20&&(a=l,s=y)}else a=l,s=y}}catch(t){c.e(t)}finally{c.f()}if(a&&!this.isInMagneticMode)this.enterMagneticMode(a);else if(!a&&this.isInMagneticMode){var m,b=!0,g=Gn(this.magneticElements);try{for(g.s();!(m=g.n()).done;){var w=m.value.getBoundingClientRect(),S=w.left+w.width/2,M=w.top+w.height/2;if(Math.sqrt(Math.pow(r-S,2)+Math.pow(o-M,2))<this.magneticExitRadius){b=!1;break}}}catch(t){g.e(t)}finally{g.f()}b&&this.exitMagneticMode()}else this.isInMagneticMode&&a&&a!==this.magneticTarget&&(this.exitMagneticMode(),this.enterMagneticMode(a));if(this.isInMagneticMode&&this.magneticTarget){var T=this.magneticTarget.getBoundingClientRect(),E=T.left+T.width/2-this.canvas.getBoundingClientRect().left,x=T.top+T.height/2-this.canvas.getBoundingClientRect().top;"undefined"!=typeof gsap?gsap.to(this.aura,{duration:.4,x:E,y:x,ease:"back.out(1.2)"}):(this.aura.x=E,this.aura.y=x)}else"undefined"!=typeof gsap?gsap.to(this.aura,{duration:.8,x:this.cursor.x,y:this.cursor.y,ease:"power2.out"}):(this.aura.x=this.cursor.x,this.aura.y=this.cursor.y)}}},{key:"start",value:function(){!this.isRunning&&this.isActive&&(this.isRunning=!0,this.animate())}},{key:"stop",value:function(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId),this.animationId=null}},{key:"animate",value:function(){var t=this;this.isRunning&&(this.update(),this.draw(),this.animationId=requestAnimationFrame(function(){return t.animate()}))}},{key:"update",value:function(){}},{key:"draw",value:function(){var t=this.ctx;if(t.clearRect(0,0,this.canvas.width,this.canvas.height),this.isInMagneticMode&&this.magneticTarget){var e=this.magneticTarget.getBoundingClientRect(),i=e.left-4,n=e.top-4,r=e.width+8,o=e.height+8;t.beginPath(),t.strokeStyle="rgba(255, 255, 255, ".concat(.8*this.magneticOpacity,")"),t.lineWidth=2,t.lineJoin="round",t.lineCap="round",t.moveTo(i+6,n),t.lineTo(i+r-6,n),t.quadraticCurveTo(i+r,n,i+r,n+6),t.lineTo(i+r,n+o-6),t.quadraticCurveTo(i+r,n+o,i+r-6,n+o),t.lineTo(i+6,n+o),t.quadraticCurveTo(i,n+o,i,n+o-6),t.lineTo(i,n+6),t.quadraticCurveTo(i,n,i+6,n),t.closePath(),t.stroke()}t.beginPath(),t.strokeStyle="rgba(255, 255, 255, ".concat(.4*this.auraOpacity,")"),t.lineWidth=1.5,t.arc(this.aura.x,this.aura.y,18,0,2*Math.PI),t.stroke(),t.beginPath(),t.fillStyle="#FFFFFF",t.shadowColor="rgba(255, 255, 255, 0.5)",t.shadowBlur=3,t.arc(this.cursor.x,this.cursor.y,3,0,2*Math.PI),t.fill(),t.shadowBlur=0}},{key:"enterMagneticMode",value:function(t){this.magneticTarget!==t&&(this.magneticTarget=t,this.isInMagneticMode=!0,"undefined"!=typeof gsap?gsap.to(this,{duration:.3,magneticOpacity:1,auraOpacity:0,ease:"power2.out"}):(this.magneticOpacity=1,this.auraOpacity=0))}},{key:"exitMagneticMode",value:function(){this.magneticTarget,this.magneticTarget=null,this.isInMagneticMode=!1,"undefined"!=typeof gsap?gsap.to(this,{duration:.4,magneticOpacity:0,auraOpacity:1,ease:"power2.out"}):(this.magneticOpacity=0,this.auraOpacity=1)}},{key:"setMagneticTarget",value:function(t){t&&t!==this.magneticTarget&&(this.exitMagneticMode(),this.enterMagneticMode(t))}},{key:"clearMagneticTarget",value:function(t){t===this.magneticTarget&&this.exitMagneticMode()}},{key:"destroy",value:function(){this.stop(),window.removeEventListener("resize",this.resizeHandler),document.removeEventListener("mousemove",this.mouseHandler),this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}])}();function zn(t){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zn(t)}function Un(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wn(n.key),n)}}function Wn(t){var e=function(t){if("object"!=zn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=zn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zn(e)?e:e+""}var Vn=function(){return function(t,e){return e&&Un(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.canvas)try{this.game=new Fn(e),this.state={isActive:this.game.isActive}}catch(t){console.error("Errore durante l'inizializzazione di SimpleGame:",t),this.game=null,this.state={isActive:!1}}else this.state={isActive:!1}},[{key:"init",value:function(){this.state.isActive&&this.game&&(document.body.classList.add("js-simple-cursor-active"),this.game.start())}},{key:"destroy",value:function(){this.state.isActive&&this.game&&(document.body.classList.remove("js-simple-cursor-active"),this.game.destroy())}},{key:"enterMagneticMode",value:function(t){this.game&&this.game.setMagneticTarget&&this.game.setMagneticTarget(t)}},{key:"exitMagneticMode",value:function(t){this.game&&this.game.clearMagneticTarget&&this.game.clearMagneticTarget(t)}}])}(),Yn=null;function qn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(window.innerWidth<768||"ontouchstart"in window||navigator.maxTouchPoints>0)return{instance:null,name:"Default",activate:function(){}};var e,i,n,r,o,a,s,c=t.deferActivation,l=void 0!==c&&c,u=t.cursorName,h=void 0===u?null:u;Yn&&"function"==typeof Yn.destroy&&Yn.destroy(),e=document.getElementById("pacman-cursor-canvas"),i=document.getElementById("asteroids-cursor-canvas"),n=document.getElementById("glitch-cursor-canvas"),e&&(e.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="none");var f=!1;if("Pacman"===h?(r=kn,o="pacman-cursor-canvas",s="Pacman"):"Asteroids"===h?(r=ge,o="asteroids-cursor-canvas",s="Asteroids"):"Glitch"===h?(r=Ln,o="glitch-cursor-canvas",s="Glitch"):"Simple"===h?(r=Vn,o="simple-cursor-canvas",s="Simple"):(s="Default",o=null,r=null),a=document.getElementById(o))try{Yn=new r(o);var y="Pacman"===s?!(Yn&&Yn.state&&!1===Yn.state.isActive):!(Yn&&!1===Yn.isActive),d=function(){f||(f=!0,y?(a.style.display="block","Pacman"===s?document.body.classList.add("js-pacman-cursor-active"):"Glitch"===s?document.body.classList.add("js-glitch-cursor-active"):"Simple"===s?document.body.classList.add("js-simple-cursor-active"):document.body.classList.add("custom-cursor-active"),Yn&&"function"==typeof Yn.init&&Yn.init()):a.style.display="none")};return l||d(),{instance:y?Yn:null,name:s,activate:d}}catch(t){return console.error("[CursorManager] Impossibile creare l'istanza di ".concat(r.name,":"),t),a.style.display="none",{instance:null,name:s,activate:function(){}}}return{instance:null,name:s,activate:function(){}}}function Kn(t){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kn(t)}function Xn(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return $n(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):($n(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,$n(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,$n(h,"constructor",l),$n(l,"constructor",c),c.displayName="GeneratorFunction",$n(l,r,"GeneratorFunction"),$n(h),$n(h,r,"Generator"),$n(h,n,function(){return this}),$n(h,"toString",function(){return"[object Generator]"}),(Xn=function(){return{w:o,m:f}})()}function $n(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}$n=function(t,e,i,n){function o(e,i){$n(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},$n(t,e,i,n)}function Zn(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function Jn(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){Zn(o,n,r,a,s,"next",t)}function s(t){Zn(o,n,r,a,s,"throw",t)}a(void 0)})}}function Qn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tr(n.key),n)}}function tr(t){var e=function(t){if("object"!=Kn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Kn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kn(e)?e:e+""}var er=function(t){return new Promise(function(e){return setTimeout(e,t)})},ir=function(){return function(t,e){return e&&Qn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.navbar=document.getElementById("chimera-navbar"),this.navbar?(this.elements={brand:this.navbar.querySelector(".navbar-brand"),navLinks:this.navbar.querySelectorAll(".nav-link"),navItems:this.navbar.querySelectorAll(".nav-item"),clock:this.navbar.querySelector("#system-clock"),highScoreDisplay:this.navbar.querySelector("#high-score-display span"),creditsDisplay:this.navbar.querySelector("#credits-display"),creditsValue:this.navbar.querySelector("#credits-display span"),logCpu:this.navbar.querySelector("#log-cpu"),logMem:this.navbar.querySelector("#log-mem"),logGpu:this.navbar.querySelector("#log-gpu"),logNet:this.navbar.querySelector("#log-net"),analysisConsole:this.navbar.querySelector("#analysis-console")},this.elements.brand&&this.elements.navLinks.length&&this.elements.clock&&this.elements.analysisConsole||console.error("Errore critico: uno o più elementi fondamentali della navbar non sono stati trovati. L'interfaccia potrebbe non funzionare correttamente."),this.scramblers={},this.state={isBooting:!0,highScore:0,credits:0,analysisTimeout:null,scrollTimeout:null},this._konamiHandler=null,this._scrollHandler=null):console.error("FATAL: Elemento #chimera-navbar non trovato.")},[{key:"init",value:(e=Jn(Xn().m(function t(){return Xn().w(function(t){for(;;)switch(t.n){case 0:if(this.navbar){t.n=1;break}return t.a(2);case 1:return this.setupScramblers(),this.bindEvents(),this.initEasterEggs(),this.startSystemTasks(),t.n=2,this.runBootSequence();case 2:return t.a(2)}},t,this)})),function(){return e.apply(this,arguments)})},{key:"setupScramblers",value:function(){this.elements.analysisConsole&&(this.scramblers.analysis=new a(this.elements.analysisConsole))}},{key:"initEasterEggs",value:function(){var t=this,e=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"],i=0;this._konamiHandler=function(n){var r=n.key,o=e[i];if(r.toLowerCase()===o.toLowerCase()){if(++i>=e.length){i=0,t.scramblers.analysis&&t.scramblers.analysis.setText("CHEAT MODE: PACMAN ENGAGED").catch(function(){});try{qn({deferActivation:!1,cursorName:"Pacman"})}catch(t){console.warn("Konami: unable to init Pacman cursor",t)}}}else i=0},_.A.on("global:keydown",this._konamiHandler)}},{key:"bindEvents",value:function(){var t=this;this.elements.navLinks.forEach(function(e){e.addEventListener("click",function(i){if(i.preventDefault(),!t.state.isBooting){var n=e.getAttribute("href");try{var r=document.querySelector(n);r&&r.scrollIntoView({behavior:"smooth"})}catch(t){console.error("Selettore non valido: ".concat(n),t)}}}),e.addEventListener("mousedown",function(){e.classList.add("is-pressed")}),e.addEventListener("mouseup",function(){e.classList.remove("is-pressed")}),e.addEventListener("mouseleave",function(){e.classList.remove("is-pressed")})}),this.elements.creditsDisplay&&this.elements.creditsDisplay.addEventListener("click",function(){if(t.state.credits<99){t.state.credits++,t.updateCredits();try{var e=document.getElementById("coin-audio");e&&(e.currentTime=0,e.play().catch(function(){}))}catch(t){}}}),this._scrollHandler=function(){t.state.scrollTimeout&&clearTimeout(t.state.scrollTimeout),t.state.scrollTimeout=setTimeout(function(){return t.updateActiveLink()},50)},_.A.on("global:scroll",this._scrollHandler);var e=function(){return t.updateActiveLink()};window.addEventListener("scroll",e,{passive:!0}),this._directScrollHandler=e}},{key:"startSystemTasks",value:function(){this.startClock(),this.startHighScore(),this.startSystemLog(),this.startAnalysisConsole(),this.updateCredits()}},{key:"runBootSequence",value:(t=Jn(Xn().m(function t(){var e,i;return Xn().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,er(200);case 1:return this.navbar.classList.add("is-visible"),t.n=2,er(800);case 2:if(!this.elements.brand){t.n=3;break}return e=new a(this.elements.brand),i=this.elements.brand.dataset.text||"A.P.I.S. TERMINAL",t.n=3,e.setText(i);case 3:return Array.from(this.elements.navItems).forEach(function(t){t.style.opacity="1",t.style.transform="translateY(0)"}),t.n=4,er(100);case 4:this.navbar.classList.remove("is-booting"),this.state.isBooting=!1,this.updateActiveLink();case 5:return t.a(2)}},t,this)})),function(){return t.apply(this,arguments)})},{key:"updateActiveLink",value:function(){if(!this.state.isBooting){var t=null,e=window.innerHeight/2,i=window.scrollY,n=1/0;this.elements.navLinks.forEach(function(r){var o=r.getAttribute("href");if(o&&"#"!==o)try{var a=document.querySelector(o);if(a){var s=a.getBoundingClientRect(),c=i+s.top+s.height/2,l=Math.abs(i+e-c);l<n&&(n=l,t=o)}}catch(t){console.warn("Errore nel calcolo della sezione per ".concat(o,":"),t)}}),this.elements.navLinks.forEach(function(e){var i=e.getAttribute("href")===t,n=e.classList.contains("is-active");i!==n&&setTimeout(function(){e.classList.toggle("is-active",i)},50)})}}},{key:"startClock",value:function(){var t=this;if(this.elements.clock)var e=Date.now(),i=setInterval(function(){if(document.body.contains(t.elements.clock)){var n=Date.now()-e,r=Math.floor(n/1e3%60).toString().padStart(2,"0"),o=Math.floor(n/6e4%60).toString().padStart(2,"0"),a=Math.floor(n/36e5).toString().padStart(2,"0"),s='<span class="separator">:</span>';t.elements.clock.innerHTML="UPTIME: ".concat(a).concat(s).concat(o).concat(s).concat(r)}else clearInterval(i)},1e3)}},{key:"startHighScore",value:function(){var t=this;if(this.elements.highScoreDisplay)var e=setInterval(function(){document.body.contains(t.elements.highScoreDisplay)?(t.state.highScore+=Math.floor(15*Math.random()),t.elements.highScoreDisplay.textContent=t.state.highScore.toString().padStart(6,"0")):clearInterval(e)},1500)}},{key:"updateCredits",value:function(){if(this.elements.creditsValue){this.elements.creditsValue.textContent=this.state.credits;var t=this.elements.creditsDisplay;t.classList.toggle("insert-coin",0===this.state.credits),t.title=0===this.state.credits?"Click to insert coin!":""}}},{key:"startSystemLog",value:function(){var t=this.elements,e=t.logCpu,i=t.logMem,n=t.logGpu,r=t.logNet;if(e&&i&&n&&r)var o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=Math.round(Math.max(0,Math.min(100,t))/100*e);return"[".concat("|".repeat(i)).concat(".".repeat(e-i),"]")},a=function(t){return t>(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?100:85)?"status-critical":t>50?"status-warning":"status-nominal"},s=setInterval(function(){if(document.body.contains(e)){var t=Math.floor(99*Math.random())+1;e.className=a(t),e.innerHTML="CPU: ".concat(o(t),' <span class="').concat(a(t),'">').concat(t,"%</span>");var c=Math.floor(90*Math.random())+10;i.className=a(c),i.innerHTML="MEM: ".concat(o(c),' <span class="').concat(a(c),'">').concat(c,"%</span>");var l=Math.floor(99*Math.random())+1;n.className=a(l),n.innerHTML="GPU: ".concat(o(l),' <span class="').concat(a(l),'">').concat(l,"%</span>");var u=Math.floor(150*Math.random())+8;r.className=a(u,!0),r.innerHTML="NET: ".concat(o(u/2,10),' <span class="').concat(a(u,!0),'">').concat(u,"ms</span>")}else clearInterval(s)},2e3)}},{key:"startAnalysisConsole",value:function(){var t=this;if(this.scramblers.analysis){var e=["SCANNING FOR VIRUSES...","CHECKING SYSTEM INTEGRITY...","COMPILING SHADERS...","DEFRAGMENTING MEMORY...","CALIBRATING GPU CLOCKS...","SYSTEM STATUS: NOMINAL"],i=0,n=function(){var r=Jn(Xn().m(function r(){return Xn().w(function(r){for(;;)switch(r.n){case 0:if(document.body.contains(t.elements.analysisConsole)){r.n=1;break}return r.a(2);case 1:return r.n=2,t.scramblers.analysis.setText(e[i]);case 2:i=(i+1)%e.length,t.state.analysisTimeout=setTimeout(n,4e3);case 3:return r.a(2)}},r)}));return function(){return r.apply(this,arguments)}}();clearTimeout(this.state.analysisTimeout),this.state.analysisTimeout=setTimeout(n,4e3)}}},{key:"destroy",value:function(){this._konamiHandler&&_.A.off("global:keydown",this._konamiHandler),this._scrollHandler&&_.A.off("global:scroll",this._scrollHandler),this._directScrollHandler&&window.removeEventListener("scroll",this._directScrollHandler)}}]);var t,e}();function nr(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return rr(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(rr(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,rr(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,rr(h,"constructor",l),rr(l,"constructor",c),c.displayName="GeneratorFunction",rr(l,r,"GeneratorFunction"),rr(h),rr(h,r,"Generator"),rr(h,n,function(){return this}),rr(h,"toString",function(){return"[object Generator]"}),(nr=function(){return{w:o,m:f}})()}function rr(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}rr=function(t,e,i,n){function o(e,i){rr(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},rr(t,e,i,n)}function or(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}var ar=function(t){var e=document.createElement("video");e.loop=!0,e.muted=!0,e.playsInline=!0,e.preload="none";var i=document.createElement("source");return i.src=t,i.type="video/mp4",e.appendChild(i),e};function sr(t){var e=new IntersectionObserver(function(t,e){t.forEach(function(t){if(t.isIntersecting){var i=t.target.querySelector(".comparison-slider");if(i&&!i.dataset.videosLoaded){i.dataset.videosLoaded="true";var n=i.dataset.videoBeforeMp4,r=i.dataset.videoAfterMp4;n&&n.trim()&&i.querySelector(".video-background").appendChild(ar(n)),r&&r.trim()&&i.querySelector(".video-foreground").appendChild(ar(r)),i.querySelectorAll("video").forEach(function(t){return t.load()})}e.unobserve(t.target)}})},{threshold:.1});t.querySelectorAll(".project-card").forEach(function(t){return e.observe(t)})}function cr(t){t.querySelectorAll(".comparison-slider").forEach(function(t){t.addEventListener("click",function(t){return t.preventDefault()});var e,i=t.querySelector(".video-foreground"),n=t.querySelector(".slider-handle"),r=50,o=50,a=null,s=function(){o+=.15*(r-o),i.style.clipPath="polygon(0 0, ".concat(o,"% 0, ").concat(o,"% 100%, 0 100%)"),n.style.left="".concat(o,"%"),e=requestAnimationFrame(s)};t.addEventListener("mousemove",function(e){r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth*100}),t.addEventListener("mouseleave",function(){r=50});var c=t.closest(".project-card");c.addEventListener("mouseenter",function(){clearTimeout(a),t.querySelectorAll("video").forEach(function(t){return t.play().catch(function(){})}),cancelAnimationFrame(e),s()}),c.addEventListener("mouseleave",function(){t.querySelectorAll("video").forEach(function(t){return t.pause()}),a=setTimeout(function(){return cancelAnimationFrame(e)},300)})})}function lr(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).prefersReducedMotion,i=void 0!==e&&e;t.querySelectorAll(".project-card").forEach(function(t){var e=t.querySelector(".comparison-slider"),n=t.querySelector(".poster-image"),r=t.querySelector(".card-inner");if(e&&n&&r){var o=!1,a=null;t.addEventListener("click",function(s){o?(a&&clearTimeout(a),o=!1,i||t.classList.remove("is-hovered"),e.style.opacity=0,e.style.pointerEvents="none",n.style.opacity=1,i||gsap.to(r,{rotationY:0,rotationX:0,scale:1,translateZ:0,"--thrust-opacity":0,"--thrust-length":1,"--thrust-spread":1,ease:"back.out(1.2)",duration:.6}),e.querySelectorAll("video").forEach(function(t){return t.pause()})):(s.preventDefault(),s.stopPropagation(),o=!0,e.style.opacity=1,e.style.pointerEvents="auto",n.style.opacity=0,i||(t.classList.add("is-hovered"),gsap.to(r,{scale:1.04,translateZ:32,"--thrust-opacity":.8,"--thrust-length":1.25,"--thrust-spread":1.15,duration:.45,ease:"back.out(1.25)"})),e.querySelectorAll("video").forEach(function(t){return t.play().catch(function(){})}),a&&clearTimeout(a),a=setTimeout(function(){o&&(o=!1,i||t.classList.remove("is-hovered"),e.style.opacity=0,e.style.pointerEvents="none",n.style.opacity=1,i||gsap.to(r,{rotationY:0,rotationX:0,scale:1,translateZ:0,"--thrust-opacity":0,"--thrust-length":1,"--thrust-spread":1,ease:"power3.out",duration:.6}),e.querySelectorAll("video").forEach(function(t){return t.pause()}))},6e3))}),t.addEventListener("mouseleave",function(){o&&(a&&clearTimeout(a),o=!1,i||t.classList.remove("is-hovered"),e.style.opacity=0,e.style.pointerEvents="none",n.style.opacity=1,i||gsap.to(r,{rotationY:0,rotationX:0,scale:1,translateZ:0,"--thrust-opacity":0,"--thrust-length":1,"--thrust-spread":1,ease:"power3.out",duration:.6}),e.querySelectorAll("video").forEach(function(t){return t.pause()}))})}})}function ur(t){var e=document.createElement("div");e.className="project-tooltip",document.body.appendChild(e),t.querySelectorAll(".project-card").forEach(function(t){var i=t.dataset.tools;i&&(t.addEventListener("mouseenter",function(){e.innerHTML="// STRUMENTI: ".concat(i),e.classList.add("visible")}),t.addEventListener("mouseleave",function(){e.classList.remove("visible")}))}),window.addEventListener("mousemove",function(t){gsap.to(e,{x:t.clientX+15,y:t.clientY+15,duration:.4,ease:"power3.out"})})}function hr(t){window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(prefers-reduced-motion: reduce)").matches||t.querySelectorAll(".project-card").forEach(function(t){var e=t.querySelector(".card-inner");t.addEventListener("mousemove",function(i){var n=t.getBoundingClientRect(),r=(i.clientX-n.left)/n.width-.5,o=(i.clientY-n.top)/n.height-.5;gsap.to(e,{rotationY:8*r*2,rotationX:8*-o*2,ease:"power1.out",duration:.8})}),t.addEventListener("mouseenter",function(){gsap.to(e,{scale:1.08,translateZ:60,"--thrust-opacity":.85,"--thrust-length":1.35,"--thrust-spread":1.2,duration:.55,ease:"back.out(1.35)"}),t.classList.add("is-hovered")}),t.addEventListener("mouseleave",function(){gsap.to(e,{rotationY:0,rotationX:0,scale:1,translateZ:0,"--thrust-opacity":0,"--thrust-length":1,"--thrust-spread":1,ease:"back.out(1.2)",duration:.7}),t.classList.remove("is-hovered")})})}function fr(){return yr.apply(this,arguments)}function yr(){var t;return t=nr().m(function t(){var e,i,n,r,o,a;return nr().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.querySelector(".project-grid")){t.n=1;break}return console.error("Elemento '.project-grid' non trovato. Impossibile inizializzare la galleria."),t.a(2,[]);case 1:if(!e.hasAttribute("data-initialized")){t.n=2;break}return t.a(2,[]);case 2:return e.setAttribute("data-initialized","true"),t.p=3,t.n=4,fetch("assets/projects.json");case 4:if((i=t.v).ok){t.n=5;break}throw new Error("Errore HTTP: ".concat(i.status," - ").concat(i.statusText));case 5:return t.n=6,i.json();case 6:return n=t.v,e.innerHTML=n.map(function(t){return'\n            <a href="#" data-project-id="'.concat(t.id,'" class="project-card reveal" data-tools="').concat(t.tools.join(", "),'">\n                <div class="card-inner">\n                    <div class="card-header">\n                        <span class="file-name">PROGETTO_').concat(t.id.toUpperCase(),'.case</span>\n                        <span class="file-size">').concat(t.fileSize,'</span>\n                    </div>\n                    <div class="card-visual">\n                        ').concat(t.poster?'<img src="'.concat(t.poster,'" alt="Poster: ').concat(t.title,'" class="poster-image" loading="lazy">'):"",'\n                        <div class="comparison-slider" data-video-before-mp4="').concat(t.videos.before.mp4,'" data-video-after-mp4="').concat(t.videos.after.mp4,'">\n                            <div class="video-container video-background"></div>\n                            <div class="video-container video-foreground"></div>\n                            <div class="slider-handle"><div class="slider-arrow"></div></div>\n                        </div>\n                        <div class="interactive-cue"></div>\n                    </div>\n                    <div class="card-footer">\n                        <span class="file-date">MODIFICATO: ').concat(t.date,'</span>\n                        <span class="file-action">APRI DOSSIER &rarr;</span>\n                    </div>\n                </div>\n            </a>')}).join(""),sr(e),r=window.matchMedia("(pointer: coarse)").matches,o=window.matchMedia("(prefers-reduced-motion: reduce)").matches,r?(e.classList.add("touch-friendly"),lr(e,{prefersReducedMotion:o})):cr(e),ur(e),r||o||hr(e),t.a(2,n);case 7:return t.p=7,a=t.v,console.error("Errore durante il caricamento o la creazione della galleria progetti:",a),e.innerHTML='<div class="error-message">\n            <p><strong>ERRORE DI CONNESSIONE</strong></p>\n            <p>Impossibile caricare i dati dei progetti. Riprova più tardi.</p>\n            <p class="error-details">Dettagli: '.concat(a.message,"</p>\n        </div>"),t.a(2,[])}},t,null,[[3,7]])}),yr=function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){or(o,n,r,a,s,"next",t)}function s(t){or(o,n,r,a,s,"throw",t)}a(void 0)})},yr.apply(this,arguments)}var dr=i(175);function pr(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return vr(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?vr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function vr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function mr(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return br(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(br(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,br(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,br(h,"constructor",l),br(l,"constructor",c),c.displayName="GeneratorFunction",br(l,r,"GeneratorFunction"),br(h),br(h,r,"Generator"),br(h,n,function(){return this}),br(h,"toString",function(){return"[object Generator]"}),(mr=function(){return{w:o,m:f}})()}function br(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}br=function(t,e,i,n){function o(e,i){br(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},br(t,e,i,n)}function gr(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function wr(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){gr(o,n,r,a,s,"next",t)}function s(t){gr(o,n,r,a,s,"throw",t)}a(void 0)})}}function Sr(){!function(){var t=document.querySelector("#hero p");if(t){var e=["> Accesso autorizzato...","> Caricamento database progetti...","> Benvenuto, Operatore."],i=new a(t),n=0,r=function(){n<e.length&&(i.setText(e[n]).then(function(){setTimeout(r,800)}),n++)};setTimeout(r,1e3)}}(),function(){var t=new IntersectionObserver(function(t,e){t.forEach(function(t){t.isIntersecting&&(t.target.classList.add("visible"),e.unobserve(t.target))})},{threshold:.15,rootMargin:"0px 0px -50px 0px"}),e=Array.from(document.querySelectorAll(".reveal:not(#hero p):not(.dossier-item):not(.title-3d)"));e.forEach(function(e){return t.observe(e)});var i=function(){e.forEach(function(e){if(!e.classList.contains("visible")){var i=e.getBoundingClientRect();i.top<window.innerHeight&&i.bottom>0&&(e.classList.add("visible"),t.unobserve(e))}})};i(),window.addEventListener("load",i,{once:!0}),window.addEventListener("scroll",i,{once:!0,passive:!0})}(),function(){var t=document.querySelector(".dossier-list");if(t){var e=new IntersectionObserver(function(){var e=wr(mr().m(function e(i,n){var r,o,s,c,l,u;return mr().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!i[0].isIntersecting){e.n=8;break}r=t.querySelectorAll(".dossier-item"),o=function(){var t=wr(mr().m(function t(e){var i,n;return mr().w(function(t){for(;;)switch(t.n){case 0:if(i=e.querySelector("dd")){t.n=1;break}return t.a(2);case 1:return n=new a(i),e.style.opacity=1,t.n=2,n.setText(i.textContent);case 2:return t.n=3,new Promise(function(t){return setTimeout(t,100)});case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),s=pr(r),e.p=1,s.s();case 2:if((c=s.n()).done){e.n=4;break}return l=c.value,e.n=3,o(l);case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,u=e.v,s.e(u);case 6:return e.p=6,s.f(),e.f(6);case 7:n.unobserve(t);case 8:return e.a(2)}},e,null,[[1,5,6,7]])}));return function(t,i){return e.apply(this,arguments)}}(),{threshold:.5});e.observe(t)}}(),function(){var t=document.getElementById("profile-picture-canvas");if(t){var e=t.parentElement;e&&new IntersectionObserver(function(i,n){i.forEach(function(i){if(i.isIntersecting){var r=e.clientWidth;t.width=r,t.height=r/.8;try{new dr.x(t,"assets/img/Foto_profilo.jpg").init()}catch(t){console.error("Errore GlitchImage:",t)}n.unobserve(i.target)}})},{threshold:.01}).observe(e)}}()}function Mr(){var t=document.getElementById("clock");function e(){var e=new Date,i=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");t.textContent="".concat(i,":").concat(n,":").concat(r)}t&&(e(),setInterval(e,1e3))}function Tr(t){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tr(t)}function Er(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return xr(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?xr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Ar(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,kr(n.key),n)}}function kr(t){var e=function(t){if("object"!=Tr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Tr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tr(e)?e:e+""}var Or=function(){return function(t,e){return e&&Ar(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.instance)return t.instance;this.telemetryElements=new Map,this.scramblers=new Map,this.prefersReducedMotion="function"==typeof window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,t.instance=this},[{key:"register",value:function(t){if(t&&t.dataset.telemetryId){var e=t.dataset.telemetryId;this.telemetryElements.set(e,t),this.prefersReducedMotion||this.scramblers.set(e,new a(t))}}},{key:"update",value:function(t,e){var i=this.telemetryElements.get(t);if(i){var n=this.scramblers.get(t);n?n.setText(e):i.textContent=e}}},{key:"batchUpdate",value:function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var n=Er(i[e],2),r=n[0],o=n[1];this.update(r,o)}}}])}();function Pr(t){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pr(t)}function Cr(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function o(i,n,r,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return Ir(l,"_invoke",function(i,n,r){var o,s,c,l=0,u=r||[],h=!1,f={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,i){return o=e,s=0,c=t,f.n=i,a}};function y(i,n){for(s=i,c=n,e=0;!h&&l&&!r&&e<u.length;e++){var r,o=u[e],y=f.p,d=o[2];i>3?(r=d===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=y&&((r=i<2&&y<o[1])?(s=0,f.v=n,f.n=o[1]):y<d&&(r=i<3||o[0]>n||n>d)&&(o[4]=i,o[5]=n,f.n=d,s=0))}if(r||i>1)return a;throw h=!0,n}return function(r,u,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&y(u,d),s=u,c=d;(e=s<2?t:c)||!h;){o||(s?s<3?(s>1&&(f.n=-1),y(s,c)):f.n=c:f.v=c);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(h=f.n<0)?c:i.call(n,f))!==a)break}catch(e){o=t,s=1,c=e}finally{l=1}}return{value:e,done:h}}}(i,r,o),!0),l}var a={};function s(){}function c(){}function l(){}e=Object.getPrototypeOf;var u=[][n]?e(e([][n]())):(Ir(e={},n,function(){return this}),e),h=l.prototype=s.prototype=Object.create(u);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Ir(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return c.prototype=l,Ir(h,"constructor",l),Ir(l,"constructor",c),c.displayName="GeneratorFunction",Ir(l,r,"GeneratorFunction"),Ir(h),Ir(h,r,"Generator"),Ir(h,n,function(){return this}),Ir(h,"toString",function(){return"[object Generator]"}),(Cr=function(){return{w:o,m:f}})()}function Ir(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Ir=function(t,e,i,n){function o(e,i){Ir(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},Ir(t,e,i,n)}function _r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return jr(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?jr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function Rr(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function Lr(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){Rr(o,n,r,a,s,"next",t)}function s(t){Rr(o,n,r,a,s,"throw",t)}a(void 0)})}}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gr(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nr(n.key),n)}}function Br(t,e,i){return e&&Gr(t.prototype,e),i&&Gr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nr(t){var e=function(t){if("object"!=Pr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Pr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pr(e)?e:e+""}new Or;var Hr=function(){return Br(function t(){Dr(this,t),this.webglManager=null,this.interactionManager=new u,this.router=null,this.projectData=[],this.crtBackground=null,this.activeCursor=null,this.terminalCursor=null,this.cursorName=null,this.isRecallingPreloader=!1,this.boundPreloaderRecall=this.onPreloaderRecall.bind(this),this.navbar=null,this.chatWidget=null,this.WebGLManager=null,this.GlobalCRTBackground=null,window.App=this},[{key:"init",value:(o=Lr(Cr().m(function t(){var e,i,n,r,o,a,s;return Cr().w(function(t){for(;;)switch(t.n){case 0:return document.body.classList.add("no-scroll"),t.n=1,Promise.all([this.loadWebGLComponents(),this.loadAIChatWidget()]);case 1:return e=t.v,i=_r(e,2),n=i[0],r=i[1],this.WebGLManager=n.WebGLManager,this.GlobalCRTBackground=n.GlobalCRTBackground,this.crtBackground=new this.GlobalCRTBackground("global-background-canvas"),o=qn({deferActivation:!0,cursorName:"Simple"}),this.cursorName=(null==o?void 0:o.name)||null,t.n=2,this.runPreloader(o.name);case 2:if(o.activate)try{o.activate()}catch(t){console.error("Cursor activation failed:",t)}o.instance&&(this.activeCursor=o.instance,this.interactionManager.setActiveCursor(this.activeCursor)),this.webglManager=new this.WebGLManager(document.getElementById("transition-canvas")),this.router=new T(this.webglManager),this.terminalCursor=new $,this.terminalCursor.init();try{(a=new ir).init(),this.navbar=a}catch(t){console.error("🔥 Errore critico durante l'inizializzazione di ChimeraNavbar:",t)}return Mr(),t.n=3,fr();case 3:return this.projectData=t.v,this.activeCursor&&"Asteroids"===this.cursorName&&this.activeCursor.game.setBounceBoundaries("img, .project-card, .interactive-bounce"),this.router.setProjectData(this.projectData),this.interactionManager.initGlobalInteractions(),Sr(),this.chatWidget=new r.default,this.chatWidget.init(),document.body.classList.add("js-enabled"),this.bindGlobalEvents(),s=this.webglManager.createTransition(),t.n=4,s.play();case 4:document.body.classList.remove("is-loading"),h("main-content"),setTimeout(function(){document.body.classList.remove("no-scroll")},1500);case 5:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"runPreloader",value:(r=Lr(Cr().m(function t(e){var n,r,o,a;return Cr().w(function(t){for(;;)switch(t.p=t.n){case 0:return(n=new $).init(),t.p=1,t.n=2,Promise.resolve().then(i.bind(i,437));case 2:r=t.v,o=new r.LoadingManager;try{new r.TextureLoader(o).load("assets/img/Foto_profilo.jpg")}catch(t){}return t.n=3,Y(o,!0,n,e);case 3:t.n=5;break;case 4:return t.p=4,a=t.v,console.error("Errore nel caricamento di THREE per il preloader:",a),t.n=5,Y(null,!0,n,e);case 5:return t.p=5,n.destroy(),t.f(5);case 6:return t.a(2)}},t,null,[[1,4,5,6]])})),function(t){return r.apply(this,arguments)})},{key:"bindGlobalEvents",value:function(){var t=this;_.A.on("global:click",function(){var e=Lr(Cr().m(function e(i){var n,r;return Cr().w(function(e){for(;;)switch(e.n){case 0:if(!(n=i.target.closest(".project-card"))){e.n=2;break}return i.preventDefault(),r=n.dataset.projectId,e.n=1,t.router.navigateToCaseHistory(r);case 1:case 3:return e.a(2);case 2:if(!i.target.closest("#close-case-history")){e.n=3;break}return i.preventDefault(),e.n=3,t.router.navigateHome()}},e)}));return function(t){return e.apply(this,arguments)}}()),window.addEventListener("apis:preloader:recall",this.boundPreloaderRecall)}},{key:"onPreloaderRecall",value:(n=Lr(Cr().m(function t(){var e,n,r,o;return Cr().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isRecallingPreloader){t.n=1;break}return t.a(2);case 1:return this.isRecallingPreloader=!0,this.terminalCursor&&this.terminalCursor.setVisibility(!1),(e=new $).init(),t.p=2,t.n=3,Promise.resolve().then(i.bind(i,437));case 3:return n=t.v,r=new n.LoadingManager,t.n=4,Y(r,!0,e,this.cursorName||"Pacman");case 4:t.n=6;break;case 5:return t.p=5,o=t.v,console.error("Errore nel caricamento di THREE per il richiamo del preloader:",o),t.n=6,Y(null,!0,e,this.cursorName||"Pacman");case 6:return t.p=6,e.destroy(),window.dispatchEvent(new CustomEvent("apis:preloader:complete",{detail:{source:"navbar"}})),this.isRecallingPreloader=!1,this.terminalCursor&&this.terminalCursor.setVisibility(!0),t.f(6);case 7:return t.a(2)}},t,this,[[2,5,6,7]])})),function(){return n.apply(this,arguments)})},{key:"loadWebGLComponents",value:(e=Lr(Cr().m(function t(){var e,n,r,o,a;return Cr().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Promise.all([Promise.all([i.e(233),i.e(254)]).then(i.bind(i,405)),Promise.all([i.e(254),i.e(625)]).then(i.bind(i,625))]);case 1:return e=t.v,n=_r(e,2),r=n[0],o=n[1],t.a(2,{WebGLManager:r.WebGLManager,GlobalCRTBackground:o.GlobalCRTBackground});case 2:return t.p=2,a=t.v,console.error("Errore nel caricamento dei componenti WebGL:",a),t.a(2,{WebGLManager:function(){return Br(function t(){Dr(this,t)},[{key:"createTransition",value:function(){return{play:function(){return Promise.resolve()}}}}])}(),GlobalCRTBackground:Br(function t(){Dr(this,t)})})}},t,null,[[0,2]])})),function(){return e.apply(this,arguments)})},{key:"loadAIChatWidget",value:(t=Lr(Cr().m(function t(){var e,n;return Cr().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Promise.all([i.e(760),i.e(57)]).then(i.bind(i,597));case 1:return e=t.v,t.a(2,e);case 2:return t.p=2,n=t.v,console.error("Errore nel caricamento del widget AI Chat:",n),t.a(2,{default:function(){return Br(function t(){Dr(this,t)},[{key:"init",value:function(){console.log("AI Chat disabilitato per ottimizzazione bundle")}}])}()})}},t,null,[[0,2]])})),function(){return t.apply(this,arguments)})}]);var t,e,n,r,o}();function Fr(t){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(t)}function zr(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ur(n.key),n)}}function Ur(t){var e=function(t){if("object"!=Fr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Fr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fr(e)?e:e+""}var Wr=function(){return function(t,e){return e&&zr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isInitialized=!1},[{key:"init",value:function(){this.isInitialized||(console.log("[GlobalEventManager] Initializing global event listeners..."),[{target:window,event:"resize",newEvent:"global:resize"},{target:window,event:"scroll",newEvent:"global:scroll",options:{passive:!0}},{target:window,event:"mousemove",newEvent:"global:mousemove",options:{passive:!0}},{target:window,event:"mousedown",newEvent:"global:mousedown"},{target:window,event:"mouseup",newEvent:"global:mouseup"},{target:window,event:"keydown",newEvent:"global:keydown"},{target:window,event:"load",newEvent:"global:load"},{target:document,event:"click",newEvent:"global:click"},{target:document,event:"DOMContentLoaded",newEvent:"global:domcontentloaded"}].forEach(function(t){var e=t.target,i=t.event,n=t.newEvent,r=t.options;e.addEventListener(i,function(t){_.A.emit(n,t)},r||{})}),this.isInitialized=!0,console.log("[GlobalEventManager] Global event listeners initialized."))}}])}(),Vr=new Wr;function Yr(t){return Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yr(t)}function qr(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Kr(n.key),n)}}function Kr(t){var e=function(t){if("object"!=Yr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Yr(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yr(e)?e:e+""}var Xr=function(){return function(t,e,i){return i&&qr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},0,[{key:"sanitize",value:function(t){if(!t||"string"!=typeof t)return"";var e=document.createElement("div");e.innerHTML=t;for(var i=function(t){if(["script","style","iframe","object","embed","form","input","button","link","meta"].includes(t.tagName.toLowerCase()))t.remove();else{for(var e=["onload","onerror","onclick","onmouseover","onmouseout","onkeydown","onkeyup","onkeypress","onchange","onsubmit","onreset","onselect","onblur","onfocus","onabort","onbeforeunload","onhashchange","onloadstart","onprogress","onerror","onabort","onload","onemptied","onstalled","onsuspend","oncanplay","oncanplaythrough","onplaying","onpause","onseeked","onseeking","ontimeupdate","onended","onvolumechange","onwaiting","onshow","ontoggle","onbeforeprint","onafterprint","onbeforeunload","onunload","onpageshow","onpagehide","onpopstate","onstorage","ononline","onoffline","onmessage","onopen","onmessage","onerror","onclose","src","href"],n=function(){var i=o[r];e.some(function(t){return i.name.toLowerCase().includes(t)})&&t.removeAttribute(i.name)},r=0,o=Array.from(t.attributes);r<o.length;r++)n();for(var a=0,s=Array.from(t.children);a<s.length;a++){var c=s[a];i(c)}}},n=0,r=Array.from(e.children);n<r.length;n++){var o=r[n];i(o)}return e.innerHTML}}])}();window.HTMLSanitizer=Xr,Vr.init(),_.A.on("global:domcontentloaded",function(){(new Hr).init().catch(function(t){console.error("🔥 Errore critico durante l'inizializzazione dell'App:",t),document.body.classList.remove("is-loading");var e=document.getElementById("main-content");e&&e.classList.add("active")})}),_.A.on("global:load",function(){if(document.body.classList.contains("is-loading")){document.body.classList.remove("is-loading");var t=document.getElementById("main-content");t&&t.classList.add("active")}})}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return n[t](i,i.exports,o),i.exports}o.m=n,t=[],o.O=(e,i,n,r)=>{if(!i){var a=1/0;for(u=0;u<t.length;u++){for(var[i,n,r]=t[u],s=!0,c=0;c<i.length;c++)(!1&r||a>=r)&&Object.keys(o.O).every(t=>o.O[t](i[c]))?i.splice(c--,1):(s=!1,r<a&&(a=r));if(s){t.splice(u--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[i,n,r]},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((e,i)=>(o.f[i](t,e),e),[])),o.u=t=>(760===t?"ai-chat":t)+"."+{57:"aef7de42c2acd6e939bb",625:"ffebd3182938a791304d",760:"d9c7198fbb3278dbdecb"}[t]+".js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e={},i="portfolio-v8:",o.l=(t,n,r,a)=>{if(e[t])e[t].push(n);else{var s,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var h=l[u];if(h.getAttribute("src")==t||h.getAttribute("data-webpack")==i+r){s=h;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",i+r),s.src=t),e[t]=[n];var f=(i,n)=>{s.onerror=s.onload=null,clearTimeout(y);var r=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach(t=>t(n)),i)return i(n)},y=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),c&&document.head.appendChild(s)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={792:0};o.f.j=(e,i)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise((i,r)=>n=t[e]=[i,r]);i.push(n[2]=r);var a=o.p+o.u(e),s=new Error;o.l(a,i=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,n[1](s)}},"chunk-"+e,e)}},o.O.j=e=>0===t[e];var e=(e,i)=>{var n,r,[a,s,c]=i,l=0;if(a.some(e=>0!==t[e])){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(c)var u=c(o)}for(e&&e(i);l<a.length;l++)r=a[l],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return o.O(u)},i=self.webpackChunkportfolio_v8=self.webpackChunkportfolio_v8||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a=o.O(void 0,[233,254],()=>o(612));a=o.O(a)})();