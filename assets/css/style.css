/* assets/css/style.css */

/*
    NOTA PER LO SVILUPPATORE:
    Per garantire la massima compatibilità con tutti i browser, si raccomanda
    di processare questo file con un "autoprefixer" durante la fase di build.
    Questo strumento aggiungerà automaticamente i prefissi dei fornitori
    (es. -webkit-, -moz-) dove necessario.
*/

/* 1. Fondamenta: Variabili, reset e tipografia */
@import url("modules/base.css");

/* 2. Layout: Struttura delle sezioni principali */
@import url("modules/layout.css");

/* 3. Componenti: Stili per elementi riutilizzabili */
@import url("modules/preloader.css");
@import url("modules/navbar.css");
@import url("modules/projects.css");
@import url("modules/components.css");

/* 4. Interazioni: Animazioni e classi di stato (gestite via JS) */
@import url("modules/hero-intro.css");
@import url("modules/interactions.css");

/* 5. Moduli Specifici: Cursori custom */
@import url("modules/asteroids-cursor.css");
@import url("modules/pacman-cursor.css");
@import url("modules/terminal-cursor.css"); 
@import url("modules/tutorial-terminal.css"); 

/* ==========================================================================
   PIRAMIDE Z-INDEX GLOBALE (SOLUZIONE DEFINITIVA)
   ========================================================================== */

/* Livello 0: Sfondo CRT (dietro a tutto) */
#global-background-canvas {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1; 
    pointer-events: none;
}

/* Livello 1: Contenuto Principale (deve essere visibile) */
main {
    position: relative; /* Necessario per z-index */
    z-index: 1; /* Livello di base per il contenuto */
}

/* Livello 2: Effetto Grana/Titoli 3D (sopra al contenuto, sotto la UI) */
#title-3d-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2; /* Sopra a <main> (kept low so UI sits above) */
    pointer-events: none;
}

/* Ensure decorative fullscreen canvases don't cover content */
#global-background-canvas,
#hero-background-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

#global-background-canvas { z-index: -2; }
#hero-background-canvas { z-index: -1; }

/* Semantic canvas classes (use ranges for roles) */
.canvas-decorative { pointer-events: none; z-index: -1; }
.canvas-overlay { pointer-events: none; z-index: 10000; }
.canvas-cursor { pointer-events: none; z-index: 11000; }
.canvas-navbar {
    display: none;
}

.legacy-navbar {
    display: block;
}

body.navbar-legacy-active .legacy-navbar {
    display: block;
}

body.navbar-legacy-active .canvas-navbar {
    display: none;
}

/* Regola "paracadute" per l'overlay di transizione */
/* Forza la sparizione dell'overlay quando il caricamento è finito. */
body:not(.is-loading) #page-transition-overlay {
    display: none !important;
    pointer-events: none !important;
}

/* ==========================================================
   Accessibilità e Media Query Globali
   ========================================================== */

/* Ensure section titles (3d) and important content appear above decorative canvases */
.title-3d,
.title-3d * {
    position: relative;
    z-index: 10100;
}

/* Wrapper e canvas per titoli 3D */
.title-3d {
    display: block;
    min-height: 120px; /* Force minimum height for debugging */
}
.title-3d-canvas-wrap {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 96px;
    display: block;
    overflow: visible;
}
.title-3d-canvas-wrap canvas {
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    display: block;
    pointer-events: none;
    min-height: 120px; /* Force minimum height for debugging */
}

/* Fallback testuale - visivamente nascosto ma accessibile ai reader */
.title-3d-fallback {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/* On small screens, disable the WebGL title and show text fallback */
/* Temporarily disabled for debugging */
/*
@media (max-width: 700px) {
    .title-3d-canvas-wrap canvas { display: none !important; }
    .title-3d-fallback { position: static !important; width: auto !important; height: auto !important; margin: 0 !important; clip: auto !important; overflow: visible !important; white-space: normal !important; }
}
*/

/* Blocca lo scroll quando il body ha la classe no-scroll */
.no-scroll {
    overflow: hidden !important;
    height: 100vh !important;
}

@media (max-width: 900px) {
    #magnetic-cursor {
        display: none;
    }

    body,
    body.js-cursor-active {
        cursor: auto;
    }

    .canvas-navbar {
        display: none;
    }

    .legacy-navbar {
        display: block;
    }

    .about-grid,
    .contact-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .nav-menu {
        display: none;
    }
    .hamburger {
        display: block;
    }
}

@media (prefers-reduced-motion: reduce) {
    html {
        scroll-behavior: auto;
    }

    * {
        animation: none !important;
        transition: none !important;
    }

    .reveal,
    #main-content {
        opacity: 1;
        transform: none;
    }

    .glitch::before,
    .glitch::after {
        display: none;
    }
}


/* --- CORREZIONI CURSORE ASTEROIDS (AGGIUNTO QUI) --- */

/* 
  Impedisce la selezione del testo (evidenziazione blu)
  e nasconde il cursore di sistema quando i cursori custom sono attivi.
*/
body.custom-cursor-active, 
body.custom-cursor-active * {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    cursor: none;
}

/*
  Aggiunge un feedback visivo chiaro per l'elemento
  a cui il cursore si è "agganciato" in modalità magnetica.
*/
.is-magnet-locked {
    outline: 2px solid rgba(0, 255, 255, 0.7);
    outline-offset: 4px;
    transform: scale(1.03);
    transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                outline-color 0.2s ease-out,
                outline-offset 0.2s ease-out;
}

/* --- NASCONDI ELEMENTI HERO DURANTE IL CARICAMENTO --- */

/*
  Impedisce che il contenuto della home (testi/arrow) appaia prima che il preloader copra lo schermo.
  Il glitch deve apparire solo dopo che il preloader è finito.
*/
body.is-loading .hero-content {
    display: none !important;
}

body.is-loading .scroll-down {
    display: none !important;
}

/*
  Assicurati che gli pseudo-elementi del glitch non appaiano durante il caricamento
*/
body.is-loading .glitch::before,
body.is-loading .glitch::after {
    display: none !important;
}
